!function(){function t(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},i={},a=n.parcelRequirea635;null==a&&(a=function(t){if(t in r)return r[t].exports;if(t in i){var e=i[t];delete i[t];var n={id:t,exports:{}};return r[t]=n,e.call(n.exports,n,n.exports),n.exports}var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a},a.register=function(t,e){i[t]=e},n.parcelRequirea635=a),a.register("iE7OH",(function(e,n){var r,i;t(e.exports,"register",(function(){return r}),(function(t){return r=t})),t(e.exports,"resolve",(function(){return i}),(function(t){return i=t}));var a={};r=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)a[e[n]]=t[e[n]]},i=function(t){var e=a[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),a.register("aNJCr",(function(e,n){var r;t(e.exports,"getBundleURL",(function(){return r}),(function(t){return r=t}));var i={};function a(t){return(""+t).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}r=function(t){var e=i[t];return e||(e=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return a(t[2])}return"/"}(),i[t]=e),e}})),a("iE7OH").register(JSON.parse('{"7EiNB":"index.c3d00fbe.js","aEnLw":"studio017.24ccf04d.jpg"}'));var o={};function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function c(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function h(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function p(t,e,n){return(p=d()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function v(t,e,n){return p.apply(null,arguments)}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,n){return e&&f(t.prototype,e),n&&f(t,n),t}function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t){return _(t)}function w(t,e,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n||t):i.value}})(t,e,n)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}function C(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||C(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function k(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||C(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function P(t,e){return!e||"object"!=((n=e)&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?s(t):e;var n}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g(t);if(e){var i=g(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return P(this,n)}}
/*! Tweakpane 3.0.7 (c) 2016 cocopon, licensed under the MIT license. */!function(t,e){"object"==typeof o?e(o):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Tweakpane={})}(void 0,(function(t){"use strict";var e=function(){function t(e){u(this,t);var n=E(e.split("-")),r=n[0],i=n[1],a=r.split(".");this.major=parseInt(a[0],10),this.minor=parseInt(a[1],10),this.patch=parseInt(a[2],10),this.prerelease=null!=i?i:null}return m(t,[{key:"toString",value:function(){var t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}]),t}(),n=function(){function t(e){u(this,t),this.controller_=e}return m(t,[{key:"disabled",get:function(){return this.controller_.viewProps.get("disabled")},set:function(t){this.controller_.viewProps.set("disabled",t)}},{key:"hidden",get:function(){return this.controller_.viewProps.get("hidden")},set:function(t){this.controller_.viewProps.set("hidden",t)}},{key:"dispose",value:function(){this.controller_.viewProps.set("disposed",!0)}}]),t}(),r=function t(e){u(this,t),this.target=e},i=function(t){x(n,t);var e=T(n);function n(t,r,i,a){var o;return u(this,n),(o=e.call(this,t)).value=r,o.presetKey=i,o.last=null==a||a,o}return n}(r),a=function(t){x(n,t);var e=T(n);function n(t,r,i){var a;return u(this,n),(a=e.call(this,t)).value=r,a.presetKey=i,a}return n}(r),o=function(t){x(n,t);var e=T(n);function n(t,r){var i;return u(this,n),(i=e.call(this,t)).expanded=r,i}return n}(r);function l(t){return null==t}function c(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var h={alreadydisposed:function(){return"View has been already disposed"},invalidparams:function(t){return"Invalid parameters for '".concat(t.name,"'")},nomatchingcontroller:function(t){return"No matching controller for '".concat(t.key,"'")},nomatchingview:function(t){return"No matching view for '".concat(JSON.stringify(t.params),"'")},notbindable:function(){return"Value is not bindable"},propertynotfound:function(t){return"Property '".concat(t.name,"' not found")},shouldneverhappen:function(){return"This error should never happen"}},d=function(){function t(e){var n;u(this,t),this.message=null!==(n=h[e.type](e.context))&&void 0!==n?n:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}return m(t,null,[{key:"alreadyDisposed",value:function(){return new t({type:"alreadydisposed"})}},{key:"notBindable",value:function(){return new t({type:"notbindable"})}},{key:"propertyNotFound",value:function(e){return new t({type:"propertynotfound",context:{name:e}})}},{key:"shouldNeverHappen",value:function(){return new t({type:"shouldneverhappen"})}}]),t}(),p=function(){function t(e,n,r){u(this,t),this.obj_=e,this.key_=n,this.presetKey_=null!=r?r:n}return m(t,[{key:"key",get:function(){return this.key_}},{key:"presetKey",get:function(){return this.presetKey_}},{key:"read",value:function(){return this.obj_[this.key_]}},{key:"write",value:function(t){this.obj_[this.key_]=t}},{key:"writeProperty",value:function(e,n){var r=this.read();if(!t.isBindable(r))throw d.notBindable();if(!(e in r))throw d.propertyNotFound(e);r[e]=n}}],[{key:"isBindable",value:function(t){return null!==t&&"object"==typeof t}}]),t}(),f=function(t){x(n,t);var e=T(n);function n(){return u(this,n),e.apply(this,arguments)}return m(n,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(t){this.controller_.props.set("label",t)}},{key:"title",get:function(){var t;return null!==(t=this.controller_.valueController.props.get("title"))&&void 0!==t?t:""},set:function(t){this.controller_.valueController.props.set("title",t)}},{key:"on",value:function(t,e){var n=this,i=e.bind(this);return this.controller_.valueController.emitter.on(t,(function(){i(new r(n))})),this}}]),n}(n),_=function(){function t(){u(this,t),this.observers_={}}return m(t,[{key:"on",value:function(t,e){var n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this}},{key:"off",value:function(t,e){var n=this.observers_[t];return n&&(this.observers_[t]=n.filter((function(t){return t.handler!==e}))),this}},{key:"emit",value:function(t,e){var n=this.observers_[t];n&&n.forEach((function(t){t.handler(e)}))}}]),t}(),y="tp";function C(t){return function(e,n){return[y,"-",t,"v",e?"_".concat(e):"",n?"-".concat(n):""].join("")}}function P(t){return t.rawValue}function M(t,e){var n,r;t.emitter.on("change",(n=P,r=e,function(t){return r(n(t))})),e(t.rawValue)}function A(t,e,n){M(t.value(e),n)}function S(t,e){return function(n){!function(t,e,n){n?t.classList.add(e):t.classList.remove(e)}(t,e,n)}}function R(t,e){M(t,(function(t){e.textContent=null!=t?t:""}))}var F=C("btn"),B=function t(e,n){u(this,t),this.element=e.createElement("div"),this.element.classList.add(F()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("button");r.classList.add(F("b")),n.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;var i=e.createElement("div");i.classList.add(F("t")),R(n.props.value("title"),i),this.buttonElement.appendChild(i)},V=function(){function t(e,n){u(this,t),this.emitter=new _,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new B(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}return m(t,[{key:"onClick_",value:function(){this.emitter.emit("click",{sender:this})}}]),t}(),L=function(){function t(e,n){var r;u(this,t),this.constraint_=null==n?void 0:n.constraint,this.equals_=null!==(r=null==n?void 0:n.equals)&&void 0!==r?r:function(t,e){return t===e},this.emitter=new _,this.rawValue_=e}return m(t,[{key:"constraint",get:function(){return this.constraint_}},{key:"rawValue",get:function(){return this.rawValue_},set:function(t){this.setRawValue(t,{forceEmit:!1,last:!0})}},{key:"setRawValue",value:function(t,e){var n=null!=e?e:{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(t):t;(!this.equals_(this.rawValue_,r)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:n,rawValue:r,sender:this}))}}]),t}(),D=function(){function t(e){u(this,t),this.emitter=new _,this.value_=e}return m(t,[{key:"rawValue",get:function(){return this.value_},set:function(t){this.setRawValue(t,{forceEmit:!1,last:!0})}},{key:"setRawValue",value:function(t,e){var n=null!=e?e:{forceEmit:!1,last:!0};(this.value_!==t||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}}]),t}();function U(t,e){var n=null==e?void 0:e.constraint,r=null==e?void 0:e.equals;return n||r?new L(t,e):new D(t)}var I=function(){function t(e){var n=this,r=function(t){var e=n;n.valMap_[t].emitter.on("change",(function(){e.emitter.emit("change",{key:t,sender:e})}))};for(var i in u(this,t),this.emitter=new _,this.valMap_=e,this.valMap_)r(i)}return m(t,[{key:"get",value:function(t){return this.valMap_[t].rawValue}},{key:"set",value:function(t,e){this.valMap_[t].rawValue=e}},{key:"value",value:function(t){return this.valMap_[t]}}],[{key:"createCore",value:function(t){return Object.keys(t).reduce((function(e,n){return Object.assign(e,b({},n,U(t[n])))}),{})}},{key:"fromObject",value:function(e){return new t(this.createCore(e))}}]),t}();function O(t){return function(e){return function(n){if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};var r=t(n);return void 0!==r?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}}function N(t){return{custom:function(e){return O(e)(t)},boolean:O((function(t){return"boolean"==typeof t?t:void 0}))(t),number:O((function(t){return"number"==typeof t?t:void 0}))(t),string:O((function(t){return"string"==typeof t?t:void 0}))(t),function:O((function(t){return"function"==typeof t?t:void 0}))(t),constant:function(e){return O((function(t){return t===e?e:void 0}))(t)},raw:O((function(t){return t}))(t),object:function(e){return O((function(t){var n;if(null!==(n=t)&&"object"==typeof n)return function(t,e){return Object.keys(e).reduce((function(n,r){if(void 0!==n){var i=(0,e[r])(t[r]);return i.succeeded?Object.assign(Object.assign({},n),b({},r,i.value)):void 0}}),{})}(t,e)}))(t)},array:function(e){return O((function(t){var n;if(Array.isArray(t))return n=e,t.reduce((function(t,e){if(void 0!==t){var r=n(e);if(r.succeeded&&void 0!==r.value)return k(t).concat([r.value])}}),[])}))(t)}}}var z={optional:N(!0),required:N(!1)};function j(t,e){var n=z.required.object(e)(t);return n.succeeded?n.value:void 0}var H=C(""),K={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"},G=function(){function t(e){var n=this;u(this,t),this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;var r=this.view.element;this.blade.value("positions").emitter.on("change",(function(){["veryfirst","first","last","verylast"].forEach((function(t){r.classList.remove(H(void 0,K[t]))})),n.blade.get("positions").forEach((function(t){r.classList.add(H(void 0,K[t]))}))})),this.viewProps.handleDispose((function(){!function(t){t&&t.parentElement&&t.parentElement.removeChild(t)}(r)}))}return m(t,[{key:"parent",get:function(){return this.parent_}}]),t}(),W="http://www.w3.org/2000/svg";function q(t){t.offsetHeight}function X(t){return void 0!==t.ontouchstart}function Y(){return new Function("return this")().document}var $={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Q(t,e){var n=t.createElementNS(W,"svg");return n.innerHTML=$[e],n}function Z(t,e,n){t.insertBefore(e,t.children[n])}function J(t){t.parentElement&&t.parentElement.removeChild(t)}function tt(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function et(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}var nt=C("lbl");var rt=function t(e,n){var r=this;u(this,t),this.element=e.createElement("div"),this.element.classList.add(nt()),n.viewProps.bindClassModifiers(this.element);var i=e.createElement("div");i.classList.add(nt("l")),A(n.props,"label",(function(t){l(t)?r.element.classList.add(nt(void 0,"nol")):(r.element.classList.remove(nt(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){var n=t.createDocumentFragment();return e.split("\n").map((function(e){return t.createTextNode(e)})).forEach((function(e,r){r>0&&n.appendChild(t.createElement("br")),n.appendChild(e)})),n}(e,t)))})),this.element.appendChild(i),this.labelElement=i;var a=e.createElement("div");a.classList.add(nt("v")),this.element.appendChild(a),this.valueElement=a},it=function(t){x(n,t);var e=T(n);function n(t,r){var i;u(this,n);var a=r.valueController.viewProps;return(i=e.call(this,Object.assign(Object.assign({},r),{view:new rt(t,{props:r.props,viewProps:a}),viewProps:a}))).props=r.props,i.valueController=r.valueController,i.view.valueElement.appendChild(i.valueController.view.element),i}return n}(G),at={id:"button",type:"blade",accept:function(t){var e=z,n=j(t,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return n?{params:n}:null},controller:function(t){return new it(t.document,{blade:t.blade,props:I.fromObject({label:t.params.label}),valueController:new V(t.document,{props:I.fromObject({title:t.params.title}),viewProps:t.viewProps})})},api:function(t){return t.controller instanceof it&&t.controller.valueController instanceof V?new f(t.controller):null}},ot=function(t){x(n,t);var e=T(n);function n(t){var r;return u(this,n),(r=e.call(this,t)).value=t.value,r}return n}(G);function st(){return new I({positions:U([],{equals:c})})}var ut=function(t){x(n,t);var e=T(n);function n(t){return u(this,n),e.call(this,t)}return m(n,[{key:"styleExpanded",get:function(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}},{key:"styleHeight",get:function(){if(!this.styleExpanded)return"0";var t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!l(t)?"".concat(t,"px"):"auto"}},{key:"bindExpandedClass",value:function(t,e){var n=this;A(this,"expanded",(function(){n.styleExpanded?t.classList.add(e):t.classList.remove(e)}))}}],[{key:"create",value:function(t){var e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null};return new n(I.createCore(e))}}]),n}(I);function lt(t,e){e.style.height=t.styleHeight}function ct(t,e){t.value("expanded").emitter.on("beforechange",(function(){var n,r,i,a,o,s;t.set("completed",!1),l(t.get("expandedHeight"))&&t.set("expandedHeight",(n=t,s=0,a=function(){n.set("expandedHeight",null),n.set("temporaryExpanded",!0),q(r),s=r.clientHeight,n.set("temporaryExpanded",null),q(r)},o=(i=r=e).style.transition,i.style.transition="none",a(),i.style.transition=o,s)),t.set("shouldFixHeight",!0),q(e)})),t.emitter.on("change",(function(){lt(t,e)})),lt(t,e),e.addEventListener("transitionend",(function(e){"height"===e.propertyName&&(t.set("shouldFixHeight",!1),t.set("expandedHeight",null),t.set("completed",!0))}))}var ht=function(t){x(n,t);var e=T(n);function n(t,r){var i;return u(this,n),(i=e.call(this,t)).rackApi_=r,i}return n}(n);var dt=function(){function t(e){u(this,t),this.emitter=new _,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}return m(t,[{key:"items",get:function(){return this.items_}},{key:"allItems",value:function(){return Array.from(this.cache_)}},{key:"find",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,a=this.allItems()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;if(t(o))return o}}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}return null}},{key:"includes",value:function(t){return this.cache_.has(t)}},{key:"add",value:function(t,e){if(this.includes(t))throw d.shouldNeverHappen();var n=void 0!==e?e:this.items_.length;this.items_.splice(n,0,t),this.cache_.add(t);var r=this.extract_(t);if(r){var i=this;r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach((function(t){i.cache_.add(t)}))}this.emitter.emit("add",{index:n,item:t,root:this,target:this})}},{key:"remove",value:function(t){var e=this.items_.indexOf(t);if(!(e<0)){this.items_.splice(e,1),this.cache_.delete(t);var n=this.extract_(t);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}}},{key:"onSubListAdd_",value:function(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}},{key:"onSubListRemove_",value:function(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}]),t}(),pt=function(t){x(n,t);var e=T(n);function n(t){var r;return u(this,n),(r=e.call(this,t)).onBindingChange_=r.onBindingChange_.bind(s(r)),r.emitter_=new _,r.controller_.binding.emitter.on("change",r.onBindingChange_),r}return m(n,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(t){this.controller_.props.set("label",t)}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}},{key:"refresh",value:function(){this.controller_.binding.read()}},{key:"onBindingChange_",value:function(t){var e=t.sender.target.read();this.emitter_.emit("change",{event:new i(this,e,this.controller_.binding.target.presetKey,t.options.last)})}}]),n}(n),vt=function(t){x(n,t);var e=T(n);function n(t,r){var i;return u(this,n),(i=e.call(this,t,r)).binding=r.binding,i}return n}(it),ft=function(t){x(n,t);var e=T(n);function n(t){var r;return u(this,n),(r=e.call(this,t)).onBindingUpdate_=r.onBindingUpdate_.bind(s(r)),r.emitter_=new _,r.controller_.binding.emitter.on("update",r.onBindingUpdate_),r}return m(n,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(t){this.controller_.props.set("label",t)}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}},{key:"refresh",value:function(){this.controller_.binding.read()}},{key:"onBindingUpdate_",value:function(t){var e=t.sender.target.read();this.emitter_.emit("update",{event:new a(this,e,this.controller_.binding.target.presetKey)})}}]),n}(n),mt=function(t){x(n,t);var e=T(n);function n(t,r){var i;return u(this,n),(i=e.call(this,t,r)).binding=r.binding,i.viewProps.bindDisabled(i.binding.ticker),i.viewProps.handleDispose((function(){i.binding.dispose()})),i}return n}(it);function bt(t){return t instanceof wt?t.apiSet_:t instanceof ht?t.rackApi_.apiSet_:null}function _t(t,e){var n=t.find((function(t){return t.controller_===e}));if(!n)throw d.shouldNeverHappen();return n}function gt(t,e,n){if(!p.isBindable(t))throw d.notBindable();return new p(t,e,n)}var wt=function(t){x(n,t);var e=T(n);function n(t,r){var i;u(this,n),(i=e.call(this,t)).onRackAdd_=i.onRackAdd_.bind(s(i)),i.onRackRemove_=i.onRackRemove_.bind(s(i)),i.onRackInputChange_=i.onRackInputChange_.bind(s(i)),i.onRackMonitorUpdate_=i.onRackMonitorUpdate_.bind(s(i)),i.emitter_=new _,i.apiSet_=new dt(bt),i.pool_=r;var a=i.controller_.rack;return a.emitter.on("add",i.onRackAdd_),a.emitter.on("remove",i.onRackRemove_),a.emitter.on("inputchange",i.onRackInputChange_),a.emitter.on("monitorupdate",i.onRackMonitorUpdate_),a.children.forEach((function(t){i.setUpApi_(t)})),i}return m(n,[{key:"children",get:function(){var t=this;return this.controller_.rack.children.map((function(e){return _t(t.apiSet_,e)}))}},{key:"addInput",value:function(t,e,n){var r=n||{},i=this.controller_.view.element.ownerDocument,a=this.pool_.createInput(i,gt(t,e,r.presetKey),r),o=new pt(a);return this.add(o,r.index)}},{key:"addMonitor",value:function(t,e,n){var r=n||{},i=this.controller_.view.element.ownerDocument,a=this.pool_.createMonitor(i,gt(t,e),r),o=new ft(a);return this.add(o,r.index)}},{key:"addFolder",value:function(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}},{key:"addButton",value:function(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}},{key:"addSeparator",value:function(t){return function(t,e){var n=e||{};return t.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}(this,t)}},{key:"addTab",value:function(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}},{key:"add",value:function(t,e){this.controller_.rack.add(t.controller_,e);var n=this.apiSet_.find((function(e){return e.controller_===t.controller_}));return n&&this.apiSet_.remove(n),this.apiSet_.add(t),t}},{key:"remove",value:function(t){this.controller_.rack.remove(t.controller_)}},{key:"addBlade",value:function(t){var e=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(e,t),r=this.pool_.createBladeApi(n);return this.add(r,t.index)}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}},{key:"setUpApi_",value:function(t){this.apiSet_.find((function(e){return e.controller_===t}))||this.apiSet_.add(this.pool_.createBladeApi(t))}},{key:"onRackAdd_",value:function(t){this.setUpApi_(t.bladeController)}},{key:"onRackRemove_",value:function(t){if(t.isRoot){var e=_t(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}},{key:"onRackInputChange_",value:function(t){var e=t.bladeController;if(e instanceof vt){var n=_t(this.apiSet_,e),r=e.binding;this.emitter_.emit("change",{event:new i(n,r.target.read(),r.target.presetKey,t.options.last)})}else if(e instanceof ot){var a=_t(this.apiSet_,e);this.emitter_.emit("change",{event:new i(a,e.value.rawValue,void 0,t.options.last)})}}},{key:"onRackMonitorUpdate_",value:function(t){if(!(t.bladeController instanceof mt))throw d.shouldNeverHappen();var e=_t(this.apiSet_,t.bladeController),n=t.bladeController.binding;this.emitter_.emit("update",{event:new a(e,n.target.read(),n.target.presetKey)})}}]),n}(n),yt=function(t){x(n,t);var e=T(n);function n(t,r){var i;return u(this,n),(i=e.call(this,t,new wt(t.rackController,r))).emitter_=new _,i.controller_.foldable.value("expanded").emitter.on("change",(function(t){i.emitter_.emit("fold",{event:new o(s(i),t.sender.rawValue)})})),i.rackApi_.on("change",(function(t){i.emitter_.emit("change",{event:t})})),i.rackApi_.on("update",(function(t){i.emitter_.emit("update",{event:t})})),i}return m(n,[{key:"expanded",get:function(){return this.controller_.foldable.get("expanded")},set:function(t){this.controller_.foldable.set("expanded",t)}},{key:"title",get:function(){return this.controller_.props.get("title")},set:function(t){this.controller_.props.set("title",t)}},{key:"children",get:function(){return this.rackApi_.children}},{key:"addInput",value:function(t,e,n){return this.rackApi_.addInput(t,e,n)}},{key:"addMonitor",value:function(t,e,n){return this.rackApi_.addMonitor(t,e,n)}},{key:"addFolder",value:function(t){return this.rackApi_.addFolder(t)}},{key:"addButton",value:function(t){return this.rackApi_.addButton(t)}},{key:"addSeparator",value:function(t){return this.rackApi_.addSeparator(t)}},{key:"addTab",value:function(t){return this.rackApi_.addTab(t)}},{key:"add",value:function(t,e){return this.rackApi_.add(t,e)}},{key:"remove",value:function(t){this.rackApi_.remove(t)}},{key:"addBlade",value:function(t){return this.rackApi_.addBlade(t)}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}}]),n}(ht),xt=function(t){x(n,t);var e=T(n);function n(t){var r;return u(this,n),(r=e.call(this,{blade:t.blade,view:t.view,viewProps:t.rackController.viewProps})).rackController=t.rackController,r}return n}(G),Ct=function t(e,n){u(this,t);var r=C(n.viewName);this.element=e.createElement("div"),this.element.classList.add(r()),n.viewProps.bindClassModifiers(this.element)};function Et(t){return t instanceof Tt?t.rack:t instanceof xt?t.rackController.rack:null}function kt(t){var e=Et(t);return e?e.bcSet_:null}var Pt=function(){function t(e){var n;u(this,t),this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new _,this.blade_=null!=e?e:null,null===(n=this.blade_)||void 0===n||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new dt(kt),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}return m(t,[{key:"children",get:function(){return this.bcSet_.items}},{key:"add",value:function(t,e){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,e)}},{key:"remove",value:function(t){t.parent_=null,this.bcSet_.remove(t)}},{key:"find",value:function(t){return this.bcSet_.allItems().filter((function(e){return e instanceof t}))}},{key:"onSetAdd_",value:function(t){this.updatePositions_();var e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),e){var n=t.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof vt)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof mt)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof ot)n.value.emitter.on("change",this.onChildValueChange_);else{var r=Et(n);if(r){var i=r.emitter;i.on("layout",this.onDescendantLayout_),i.on("inputchange",this.onDescendantInputChange_),i.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}}},{key:"onSetRemove_",value:function(t){this.updatePositions_();var e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),e){var n=t.item;if(n instanceof vt)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof mt)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof ot)n.value.emitter.off("change",this.onChildValueChange_);else{var r=Et(n);if(r){var i=r.emitter;i.off("layout",this.onDescendantLayout_),i.off("inputchange",this.onDescendantInputChange_),i.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}}},{key:"updatePositions_",value:function(){var t=this,e=this.bcSet_.items.filter((function(t){return!t.viewProps.get("hidden")})),n=e[0],r=e[e.length-1];this.bcSet_.items.forEach((function(e){var i=[];e===n&&(i.push("first"),t.blade_&&!t.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),e===r&&(i.push("last"),t.blade_&&!t.blade_.get("positions").includes("verylast")||i.push("verylast")),e.blade.set("positions",i)}))}},{key:"onChildPositionsChange_",value:function(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onChildViewPropsChange_",value:function(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onChildDispose_",value:function(){var t=this;this.bcSet_.items.filter((function(t){return t.viewProps.get("disposed")})).forEach((function(e){t.bcSet_.remove(e)}))}},{key:"onChildInputChange_",value:function(t){var e=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r instanceof vt&&r.binding===e)return r}return null}(this.find(vt),t.sender);if(!e)throw d.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}},{key:"onChildMonitorUpdate_",value:function(t){var e=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r instanceof mt&&r.binding===e)return r}return null}(this.find(mt),t.sender);if(!e)throw d.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}},{key:"onChildValueChange_",value:function(t){var e=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r instanceof ot&&r.value===e)return r}return null}(this.find(ot),t.sender);if(!e)throw d.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}},{key:"onDescendantLayout_",value:function(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onDescendantInputChange_",value:function(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}},{key:"onDescendantMonitorUpdate_",value:function(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}},{key:"onBladePositionsChange_",value:function(){this.updatePositions_()}}]),t}(),Tt=function(t){x(n,t);var e=T(n);function n(t,r){var i;u(this,n),(i=e.call(this,Object.assign(Object.assign({},r),{view:new Ct(t,{viewName:"brk",viewProps:r.viewProps})}))).onRackAdd_=i.onRackAdd_.bind(s(i)),i.onRackRemove_=i.onRackRemove_.bind(s(i));var a=new Pt(r.root?void 0:r.blade);return a.emitter.on("add",i.onRackAdd_),a.emitter.on("remove",i.onRackRemove_),i.rack=a,i.viewProps.handleDispose((function(){for(var t=i.rack.children.length-1;t>=0;t--){i.rack.children[t].viewProps.set("disposed",!0)}})),i}return m(n,[{key:"onRackAdd_",value:function(t){t.isRoot&&Z(this.view.element,t.bladeController.view.element,t.index)}},{key:"onRackRemove_",value:function(t){t.isRoot&&J(t.bladeController.view.element)}}]),n}(G),Mt=C("cnt"),At=function t(e,n){var r=this;u(this,t),this.className_=C(n.viewName||"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Mt()),n.viewProps.bindClassModifiers(this.element),this.foldable_=n.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),A(this.foldable_,"completed",S(this.element,this.className_(void 0,"cpl")));var i=e.createElement("button");i.classList.add(this.className_("b")),A(n.props,"title",(function(t){l(t)?r.element.classList.add(r.className_(void 0,"not")):r.element.classList.remove(r.className_(void 0,"not"))})),n.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;var a=e.createElement("div");a.classList.add(this.className_("t")),R(n.props.value("title"),a),this.buttonElement.appendChild(a),this.titleElement=a;var o=e.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);var s=n.containerElement;s.classList.add(this.className_("c")),this.element.appendChild(s),this.containerElement=s},St=function(t){x(n,t);var e=T(n);function n(t,r){var i,a;u(this,n);var o=ut.create(null===(a=r.expanded)||void 0===a||a),l=new Tt(t,{blade:r.blade,root:r.root,viewProps:r.viewProps});return(i=e.call(this,Object.assign(Object.assign({},r),{rackController:l,view:new At(t,{containerElement:l.view.element,foldable:o,props:r.props,viewName:r.root?"rot":void 0,viewProps:r.viewProps})}))).onTitleClick_=i.onTitleClick_.bind(s(i)),i.props=r.props,i.foldable=o,ct(i.foldable,i.view.containerElement),i.view.buttonElement.addEventListener("click",i.onTitleClick_),i}return m(n,[{key:"document",get:function(){return this.view.element.ownerDocument}},{key:"onTitleClick_",value:function(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}]),n}(xt),Rt={id:"folder",type:"blade",accept:function(t){var e=z,n=j(t,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return n?{params:n}:null},controller:function(t){return new St(t.document,{blade:t.blade,expanded:t.params.expanded,props:I.fromObject({title:t.params.title}),viewProps:t.viewProps})},api:function(t){return t.controller instanceof St?new yt(t.controller,t.pool):null}},Ft=function(t){x(n,t);var e=T(n);function n(t,r){var i;u(this,n);var a=r.valueController.viewProps;return(i=e.call(this,Object.assign(Object.assign({},r),{value:r.valueController.value,view:new rt(t,{props:r.props,viewProps:a}),viewProps:a}))).props=r.props,i.valueController=r.valueController,i.view.valueElement.appendChild(i.valueController.view.element),i}return n}(ot),Bt=function(t){x(n,t);var e=T(n);function n(){return u(this,n),e.apply(this,arguments)}return n}(n),Vt=C("spr"),Lt=function t(e,n){u(this,t),this.element=e.createElement("div"),this.element.classList.add(Vt()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("hr");r.classList.add(Vt("r")),this.element.appendChild(r)},Dt=function(t){x(n,t);var e=T(n);function n(t,r){return u(this,n),e.call(this,Object.assign(Object.assign({},r),{view:new Lt(t,{viewProps:r.viewProps})}))}return n}(G),Ut={id:"separator",type:"blade",accept:function(t){var e=j(t,{view:z.required.constant("separator")});return e?{params:e}:null},controller:function(t){return new Dt(t.document,{blade:t.blade,viewProps:t.viewProps})},api:function(t){return t.controller instanceof Dt?new Bt(t.controller):null}},It=C("");function Ot(t,e){return S(t,It(void 0,e))}var Nt=function(t){x(n,t);var e=T(n);function n(t){return u(this,n),e.call(this,t)}return m(n,[{key:"bindClassModifiers",value:function(t){A(this,"disabled",Ot(t,"disabled")),A(this,"hidden",Ot(t,"hidden"))}},{key:"bindDisabled",value:function(t){A(this,"disabled",(function(e){t.disabled=e}))}},{key:"bindTabIndex",value:function(t){A(this,"disabled",(function(e){t.tabIndex=e?-1:0}))}},{key:"handleDispose",value:function(t){this.value("disposed").emitter.on("change",(function(e){e&&t()}))}}],[{key:"create",value:function(t){var e,r,i=null!=t?t:{},a={disabled:null!==(e=i.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(r=i.hidden)&&void 0!==r&&r};return new n(I.createCore(a))}}]),n}(I),zt=C("tbi"),jt=function t(e,n){var r=this;u(this,t),this.element=e.createElement("div"),this.element.classList.add(zt()),n.viewProps.bindClassModifiers(this.element),A(n.props,"selected",(function(t){t?r.element.classList.add(zt(void 0,"sel")):r.element.classList.remove(zt(void 0,"sel"))}));var i=e.createElement("button");i.classList.add(zt("b")),n.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;var a=e.createElement("div");a.classList.add(zt("t")),R(n.props.value("title"),a),this.buttonElement.appendChild(a),this.titleElement=a},Ht=function(){function t(e,n){u(this,t),this.emitter=new _,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new jt(e,{props:n.props,viewProps:n.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}return m(t,[{key:"onClick_",value:function(){this.emitter.emit("click",{sender:this})}}]),t}(),Kt=function(){function t(e,n){var r=this;u(this,t),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ht(e,{props:n.itemProps,viewProps:Nt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Tt(e,{blade:st(),viewProps:Nt.create()}),this.props=n.props,A(this.props,"selected",(function(t){r.itemController.props.set("selected",t),r.contentController.viewProps.set("hidden",!t)}))}return m(t,[{key:"itemController",get:function(){return this.ic_}},{key:"contentController",get:function(){return this.cc_}},{key:"onItemClick_",value:function(){this.props.set("selected",!0)}}]),t}(),Gt=function(){function t(e,n){u(this,t),this.controller_=e,this.rackApi_=n}return m(t,[{key:"title",get:function(){var t;return null!==(t=this.controller_.itemController.props.get("title"))&&void 0!==t?t:""},set:function(t){this.controller_.itemController.props.set("title",t)}},{key:"selected",get:function(){return this.controller_.props.get("selected")},set:function(t){this.controller_.props.set("selected",t)}},{key:"children",get:function(){return this.rackApi_.children}},{key:"addButton",value:function(t){return this.rackApi_.addButton(t)}},{key:"addFolder",value:function(t){return this.rackApi_.addFolder(t)}},{key:"addSeparator",value:function(t){return this.rackApi_.addSeparator(t)}},{key:"addTab",value:function(t){return this.rackApi_.addTab(t)}},{key:"add",value:function(t,e){this.rackApi_.add(t,e)}},{key:"remove",value:function(t){this.rackApi_.remove(t)}},{key:"addInput",value:function(t,e,n){return this.rackApi_.addInput(t,e,n)}},{key:"addMonitor",value:function(t,e,n){return this.rackApi_.addMonitor(t,e,n)}},{key:"addBlade",value:function(t){return this.rackApi_.addBlade(t)}}]),t}(),Wt=function(t){x(n,t);var e=T(n);function n(t,r){var i;return u(this,n),(i=e.call(this,t,new wt(t.rackController,r))).onPageAdd_=i.onPageAdd_.bind(s(i)),i.onPageRemove_=i.onPageRemove_.bind(s(i)),i.emitter_=new _,i.pageApiMap_=new Map,i.rackApi_.on("change",(function(t){i.emitter_.emit("change",{event:t})})),i.rackApi_.on("update",(function(t){i.emitter_.emit("update",{event:t})})),i.controller_.pageSet.emitter.on("add",i.onPageAdd_),i.controller_.pageSet.emitter.on("remove",i.onPageRemove_),i.controller_.pageSet.items.forEach((function(t){i.setUpPageApi_(t)})),i}return m(n,[{key:"pages",get:function(){var t=this;return this.controller_.pageSet.items.map((function(e){var n=t.pageApiMap_.get(e);if(!n)throw d.shouldNeverHappen();return n}))}},{key:"addPage",value:function(t){var e=this.controller_.view.element.ownerDocument,n=new Kt(e,{itemProps:I.fromObject({selected:!1,title:t.title}),props:I.fromObject({selected:!1})});this.controller_.add(n,t.index);var r=this.pageApiMap_.get(n);if(!r)throw d.shouldNeverHappen();return r}},{key:"removePage",value:function(t){this.controller_.remove(t)}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}},{key:"setUpPageApi_",value:function(t){var e=this.rackApi_.apiSet_.find((function(e){return e.controller_===t.contentController}));if(!e)throw d.shouldNeverHappen();var n=new Gt(t,e);this.pageApiMap_.set(t,n)}},{key:"onPageAdd_",value:function(t){this.setUpPageApi_(t.item)}},{key:"onPageRemove_",value:function(t){if(!this.pageApiMap_.get(t.item))throw d.shouldNeverHappen();this.pageApiMap_.delete(t.item)}}]),n}(ht),qt=C("tab"),Xt=function t(e,n){u(this,t),this.element=e.createElement("div"),this.element.classList.add(qt(),Mt()),n.viewProps.bindClassModifiers(this.element),M(n.empty,S(this.element,qt(void 0,"nop")));var r=e.createElement("div");r.classList.add(qt("i")),this.element.appendChild(r),this.itemsElement=r;var i=n.contentsElement;i.classList.add(qt("c")),this.element.appendChild(i),this.contentsElement=i},Yt=function(t){x(n,t);var e=T(n);function n(t,r){var i;u(this,n);var a=new Tt(t,{blade:r.blade,viewProps:r.viewProps}),o=U(!0);return(i=e.call(this,{blade:r.blade,rackController:a,view:new Xt(t,{contentsElement:a.view.element,empty:o,viewProps:r.viewProps})})).onPageAdd_=i.onPageAdd_.bind(s(i)),i.onPageRemove_=i.onPageRemove_.bind(s(i)),i.onPageSelectedChange_=i.onPageSelectedChange_.bind(s(i)),i.pageSet_=new dt((function(){return null})),i.pageSet_.emitter.on("add",i.onPageAdd_),i.pageSet_.emitter.on("remove",i.onPageRemove_),i.empty_=o,i.applyPages_(),i}return m(n,[{key:"pageSet",get:function(){return this.pageSet_}},{key:"add",value:function(t,e){this.pageSet_.add(t,null!=e?e:this.pageSet_.items.length)}},{key:"remove",value:function(t){this.pageSet_.remove(this.pageSet_.items[t])}},{key:"applyPages_",value:function(){this.keepSelection_(),this.empty_.rawValue=0===this.pageSet_.items.length}},{key:"onPageAdd_",value:function(t){var e=t.item;Z(this.view.itemsElement,e.itemController.view.element,t.index),this.rackController.rack.add(e.contentController,t.index),e.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}},{key:"onPageRemove_",value:function(t){var e=t.item;J(e.itemController.view.element),this.rackController.rack.remove(e.contentController),e.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}},{key:"keepSelection_",value:function(){if(0!==this.pageSet_.items.length){var t=this.pageSet_.items.findIndex((function(t){return t.props.get("selected")}));t<0?this.pageSet_.items.forEach((function(t,e){t.props.set("selected",0===e)})):this.pageSet_.items.forEach((function(e,n){e.props.set("selected",n===t)}))}}},{key:"onPageSelectedChange_",value:function(t){if(t.rawValue){var e=this.pageSet_.items.findIndex((function(e){return e.props.value("selected")===t.sender}));this.pageSet_.items.forEach((function(t,n){t.props.set("selected",n===e)}))}else this.keepSelection_()}}]),n}(xt),$t={id:"tab",type:"blade",accept:function(t){var e=z,n=j(t,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller:function(t){var e=new Yt(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((function(n){var r=new Kt(t.document,{itemProps:I.fromObject({selected:!1,title:n.title}),props:I.fromObject({selected:!1})});e.add(r)})),e},api:function(t){return t.controller instanceof Yt?new Wt(t.controller,t.pool):null}};function Qt(t,e){var n=t.accept(e.params);if(!n)return null;var r=z.optional.boolean(e.params.disabled).value,i=z.optional.boolean(e.params.hidden).value;return t.controller({blade:st(),document:e.document,params:Object.assign(Object.assign({},n.params),{disabled:r,hidden:i}),viewProps:Nt.create({disabled:r,hidden:i})})}var Zt=function(){function t(){u(this,t),this.disabled=!1,this.emitter=new _}return m(t,[{key:"dispose",value:function(){}},{key:"tick",value:function(){this.disabled||this.emitter.emit("tick",{sender:this})}}]),t}(),Jt=function(){function t(e,n){u(this,t),this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new _,this.interval_=n,this.setTimer_()}return m(t,[{key:"disabled",get:function(){return this.disabled_},set:function(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}},{key:"dispose",value:function(){this.clearTimer_()}},{key:"clearTimer_",value:function(){if(null!==this.timerId_){var t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}}},{key:"setTimer_",value:function(){if(this.clearTimer_(),!(this.interval_<=0)){var t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}}},{key:"onTick_",value:function(){this.disabled_||this.emitter.emit("tick",{sender:this})}}]),t}(),te=function(){function t(e){u(this,t),this.constraints=e}return m(t,[{key:"constrain",value:function(t){return this.constraints.reduce((function(t,e){return e.constrain(t)}),t)}}]),t}();function ee(t,e){if(t instanceof e)return t;if(t instanceof te){var n=t.constraints.reduce((function(t,n){return t||(n instanceof e?n:null)}),null);if(n)return n}return null}var ne=function(){function t(e){u(this,t),this.options=e}return m(t,[{key:"constrain",value:function(t){var e=this.options;return 0===e.length||e.filter((function(e){return e.value===t})).length>0?t:e[0].value}}]),t}(),re=function(){function t(e){u(this,t),this.maxValue=e.max,this.minValue=e.min}return m(t,[{key:"constrain",value:function(t){var e=t;return l(this.minValue)||(e=Math.max(e,this.minValue)),l(this.maxValue)||(e=Math.min(e,this.maxValue)),e}}]),t}(),ie=function(){function t(e){u(this,t),this.step=e}return m(t,[{key:"constrain",value:function(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}}]),t}(),ae=C("lst"),oe=function(){function t(e,n){u(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.props_=n.props,this.element=e.createElement("div"),this.element.classList.add(ae()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("select");r.classList.add(ae("s")),A(this.props_,"options",(function(t){tt(r),t.forEach((function(t,n){var i=e.createElement("option");i.dataset.index=String(n),i.textContent=t.text,i.value=String(t.value),r.appendChild(i)}))})),n.viewProps.bindDisabled(r),this.element.appendChild(r),this.selectElement=r;var i=e.createElement("div");i.classList.add(ae("m")),i.appendChild(Q(e,"dropdown")),this.element.appendChild(i),n.value.emitter.on("change",this.onValueChange_),this.value_=n.value,this.update_()}return m(t,[{key:"update_",value:function(){this.selectElement.value=String(this.value_.rawValue)}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),se=function(){function t(e,n){u(this,t),this.onSelectChange_=this.onSelectChange_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new oe(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}return m(t,[{key:"onSelectChange_",value:function(t){var e=t.currentTarget.selectedOptions.item(0);if(e){var n=Number(e.dataset.index);this.value.rawValue=this.props.get("options")[n].value}}}]),t}(),ue=C("pop"),le=function t(e,n){u(this,t),this.element=e.createElement("div"),this.element.classList.add(ue()),n.viewProps.bindClassModifiers(this.element),M(n.shows,S(this.element,ue(void 0,"v")))},ce=function t(e,n){u(this,t),this.shows=U(!1),this.viewProps=n.viewProps,this.view=new le(e,{shows:this.shows,viewProps:this.viewProps})},he=C("txt"),de=function(){function t(e,n){u(this,t),this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(he()),n.viewProps.bindClassModifiers(this.element),this.props_=n.props,this.props_.emitter.on("change",this.onChange_);var r=e.createElement("input");r.classList.add(he("i")),r.type="text",n.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,n.value.emitter.on("change",this.onChange_),this.value_=n.value,this.refresh()}return m(t,[{key:"refresh",value:function(){var t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}},{key:"onChange_",value:function(){this.refresh()}}]),t}(),pe=function(){function t(e,n){u(this,t),this.onInputChange_=this.onInputChange_.bind(this),this.parser_=n.parser,this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new de(e,{props:n.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return m(t,[{key:"onInputChange_",value:function(t){var e=t.currentTarget.value,n=this.parser_(e);l(n)||(this.value.rawValue=n),this.view.refresh()}}]),t}();function ve(t){return"false"!==t&&!!t}function fe(t){return function(t){return String(t)}(t)}var me=function(){function t(e){u(this,t),this.text=e}return m(t,[{key:"evaluate",value:function(){return Number(this.text)}},{key:"toString",value:function(){return this.text}}]),t}(),be={"**":function(t,e){return Math.pow(t,e)},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"&":function(t,e){return t&e},"^":function(t,e){return t^e},"|":function(t,e){return t|e}},_e=function(){function t(e,n,r){u(this,t),this.left=n,this.operator=e,this.right=r}return m(t,[{key:"evaluate",value:function(){var t=be[this.operator];if(!t)throw new Error("unexpected binary operator: '".concat(this.operator));return t(this.left.evaluate(),this.right.evaluate())}},{key:"toString",value:function(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}]),t}(),ge={"+":function(t){return t},"-":function(t){return-t},"~":function(t){return~t}},we=function(){function t(e,n){u(this,t),this.operator=e,this.expression=n}return m(t,[{key:"evaluate",value:function(){var t=ge[this.operator];if(!t)throw new Error("unexpected unary operator: '".concat(this.operator));return t(this.expression.evaluate())}},{key:"toString",value:function(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}]),t}();function ye(t){return function(e,n){for(var r=0;r<t.length;r++){var i=t[r](e,n);if(""!==i)return i}return""}}function xe(t,e){var n,r=t.substr(e).match(/^\s+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Ce(t,e){var n,r=t.substr(e).match(/^[0-9]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Ee(t,e){var n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";var r=function(t,e){var n=Ce(t,e);if(""!==n)return n;var r=t.substr(e,1);if("-"!==r&&"+"!==r)return"";var i=Ce(t,e+=1);return""===i?"":r+i}(t,e);return""===r?"":n+r}function ke(t,e){var n=t.substr(e,1);if("0"===n)return n;var r=function(t,e){var n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}(t,e);return e+=r.length,""===r?"":r+Ce(t,e)}var Pe=ye([function(t,e){var n=ke(t,e);if(e+=n.length,""===n)return"";var r=t.substr(e,1);if(e+=r.length,"."!==r)return"";var i=Ce(t,e);return n+r+i+Ee(t,e+=i.length)},function(t,e){var n=t.substr(e,1);if(e+=n.length,"."!==n)return"";var r=Ce(t,e);return e+=r.length,""===r?"":n+r+Ee(t,e)},function(t,e){var n=ke(t,e);return e+=n.length,""===n?"":n+Ee(t,e)}]);var Te=ye([function(t,e){var n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";var r=function(t,e){var n,r=t.substr(e).match(/^[01]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r},function(t,e){var n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";var r=function(t,e){var n,r=t.substr(e).match(/^[0-7]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r},function(t,e){var n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";var r=function(t,e){var n,r=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=r&&r[0])&&void 0!==n?n:""}(t,e);return""===r?"":n+r}]),Me=ye([Te,Pe]);function Ae(t,e){return function(t,e){var n=Me(t,e);return e+=n.length,""===n?null:{evaluable:new me(n),cursor:e}}(t,e)||function(t,e){var n=t.substr(e,1);if(e+=n.length,"("!==n)return null;var r=Fe(t,e);if(!r)return null;e=r.cursor,e+=xe(t,e).length;var i=t.substr(e,1);return e+=i.length,")"!==i?null:{evaluable:r.evaluable,cursor:e}}(t,e)}function Se(t,e,n){n+=xe(e,n).length;var r=t.filter((function(t){return e.startsWith(t,n)}))[0];return r?(n+=r.length,{cursor:n+=xe(e,n).length,operator:r}):null}var Re=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((function(t,e){return function(t,e){return function(n,r){var i=t(n,r);if(!i)return null;r=i.cursor;for(var a=i.evaluable;;){var o=Se(e,n,r);if(!o)break;r=o.cursor;var s=t(n,r);if(!s)return null;r=s.cursor,a=new _e(o.operator,a,s.evaluable)}return a?{cursor:r,evaluable:a}:null}}(t,e)}),(function t(e,n){var r=Ae(e,n);if(r)return r;var i=e.substr(n,1);if(n+=i.length,"+"!==i&&"-"!==i&&"~"!==i)return null;var a=t(e,n);return a?{cursor:n=a.cursor,evaluable:new we(i,a.evaluable)}:null}));function Fe(t,e){return e+=xe(t,e).length,Re(t,e)}function Be(t){var e,n=function(t){var e=Fe(t,0);return e?e.cursor+xe(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function Ve(t){if("number"==typeof t)return t;if("string"==typeof t){var e=Be(t);if(!l(e))return e}return 0}function Le(t){return String(t)}function De(t){return function(e){return e.toFixed(Math.max(Math.min(t,20),0))}}var Ue=De(0);function Ie(t){return Ue(t)+"%"}function Oe(t){return String(t)}function Ne(t){return t}function ze(t,e){for(;t.length<e;)t.push(void 0)}function je(t){var e=[];return ze(e,t),U(e)}function He(t){var e=t.primary,n=t.secondary,r=t.forward,i=t.backward,a=!1;function o(t){a||(a=!0,t(),a=!1)}e.emitter.on("change",(function(t){o((function(){n.setRawValue(r(e,n),t.options)}))})),n.emitter.on("change",(function(t){o((function(){e.setRawValue(i(e,n),t.options)})),o((function(){n.setRawValue(r(e,n),t.options)}))})),o((function(){n.setRawValue(r(e,n),{forceEmit:!1,last:!0})}))}function Ke(t,e){var n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function Ge(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function We(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function qe(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function Xe(t,e){var n=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:t.pageX-((n&&n.scrollX||0)+r.left),y:t.pageY-((n&&n.scrollY||0)+r.top)}}var Ye=function(){function t(e){u(this,t),this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new _,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}return m(t,[{key:"computePosition_",value:function(t){var e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}},{key:"onMouseDown_",value:function(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();var n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Xe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}},{key:"onDocumentMouseMove_",value:function(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Xe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}},{key:"onDocumentMouseUp_",value:function(t){var e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Xe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}},{key:"onTouchStart_",value:function(t){t.preventDefault();var e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}},{key:"onTouchMove_",value:function(t){var e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}},{key:"onTouchEnd_",value:function(t){var e,n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey})}}]),t}();function $e(t,e,n,r,i){return r+(t-e)/(n-e)*(i-r)}function Qe(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ze(t,e,n){return Math.min(Math.max(t,e),n)}function Je(t,e){return(t%e+e)%e}var tn=C("txt"),en=function(){function t(e,n){u(this,t),this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(tn(),tn(void 0,"num")),n.arrayPosition&&this.element.classList.add(tn(void 0,n.arrayPosition)),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("input");r.classList.add(tn("i")),r.type="text",n.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=n.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(tn()),this.inputElement.classList.add(tn("i"));var i=e.createElement("div");i.classList.add(tn("k")),this.element.appendChild(i),this.knobElement=i;var a=e.createElementNS(W,"svg");a.classList.add(tn("g")),this.knobElement.appendChild(a);var o=e.createElementNS(W,"path");o.classList.add(tn("gb")),a.appendChild(o),this.guideBodyElem_=o;var s=e.createElementNS(W,"path");s.classList.add(tn("gh")),a.appendChild(s),this.guideHeadElem_=s;var l=e.createElement("div");l.classList.add(C("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.refresh()}return m(t,[{key:"onDraggingChange_",value:function(t){if(null!==t.rawValue){this.element.classList.add(tn(void 0,"drg"));var e=t.rawValue/this.props_.get("draggingScale"),n=e+(e>0?-1:e<0?1:0),r=Ze(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",["M ".concat(n+r,",0 L").concat(n,",4 L").concat(n+r,",8"),"M ".concat(e,",-1 L").concat(e,",9")].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d","M 0,4 L".concat(e,",4"));var i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left="".concat(e,"px")}else this.element.classList.remove(tn(void 0,"drg"))}},{key:"refresh",value:function(){var t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}},{key:"onChange_",value:function(){this.refresh()}}]),t}(),nn=function(){function t(e,n){u(this,t),this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=n.baseStep,this.parser_=n.parser,this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.dragging_=U(null),this.view=new en(e,{arrayPosition:n.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);var r=new Ye(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}return m(t,[{key:"onInputChange_",value:function(t){var e=t.currentTarget.value,n=this.parser_(e);l(n)||(this.value.rawValue=n),this.view.refresh()}},{key:"onInputKeyDown_",value:function(t){var e=Ke(this.baseStep_,Ge(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}},{key:"onInputKeyUp_",value:function(t){0!==Ke(this.baseStep_,Ge(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},{key:"onPointerDown_",value:function(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}},{key:"computeDraggingValue_",value:function(t){if(!t.point)return null;var e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}},{key:"onPointerMove_",value:function(t){var e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}},{key:"onPointerUp_",value:function(t){var e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}]),t}(),rn=C("sld"),an=function(){function t(e,n){u(this,t),this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(rn()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("div");r.classList.add(rn("t")),n.viewProps.bindTabIndex(r),this.element.appendChild(r),this.trackElement=r;var i=e.createElement("div");i.classList.add(rn("k")),this.trackElement.appendChild(i),this.knobElement=i,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.update_()}return m(t,[{key:"update_",value:function(){var t=Ze($e(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width="".concat(t,"%")}},{key:"onChange_",value:function(){this.update_()}}]),t}(),on=function(){function t(e,n){u(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=n.baseStep,this.value=n.value,this.viewProps=n.viewProps,this.props=n.props,this.view=new an(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ye(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}return m(t,[{key:"handlePointerEvent_",value:function(t,e){t.point&&this.value.setRawValue($e(Ze(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}},{key:"onPointerDownOrMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){var e=Ke(this.baseStep_,We(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}},{key:"onKeyUp_",value:function(t){0!==Ke(this.baseStep_,We(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),sn=C("sldtxt"),un=function t(e,n){u(this,t),this.element=e.createElement("div"),this.element.classList.add(sn());var r=e.createElement("div");r.classList.add(sn("s")),this.sliderView_=n.sliderView,r.appendChild(this.sliderView_.element),this.element.appendChild(r);var i=e.createElement("div");i.classList.add(sn("t")),this.textView_=n.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)},ln=function(){function t(e,n){u(this,t),this.value=n.value,this.viewProps=n.viewProps,this.sliderC_=new on(e,{baseStep:n.baseStep,props:n.sliderProps,value:n.value,viewProps:this.viewProps}),this.textC_=new nn(e,{baseStep:n.baseStep,parser:n.parser,props:n.textProps,value:n.value,viewProps:n.viewProps}),this.view=new un(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}return m(t,[{key:"sliderController",get:function(){return this.sliderC_}},{key:"textController",get:function(){return this.textC_}}]),t}();function cn(t,e){t.write(e)}function hn(t){var e=z;return Array.isArray(t)?e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(t).value:"object"==typeof t?e.required.raw(t).value:void 0}function dn(t){if("inline"===t||"popup"===t)return t}function pn(t){var e=z;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(t).value}function vn(t){if(Array.isArray(t))return t;var e=[];return Object.keys(t).forEach((function(n){e.push({text:n,value:t[n]})})),e}function fn(t){return l(t)?null:new ne(vn(t))}function mn(t){var e=t?ee(t,ne):null;return e?e.options:null}function bn(t,e){var n=t&&ee(t,ie);return n?Qe(n.step):Math.max(Qe(e),2)}function _n(t){var e=function(t){var e=t?ee(t,ie):null;return e?e.step:null}(t);return null!=e?e:1}function gn(t,e){var n,r=t&&ee(t,ie),i=Math.abs(null!==(n=null==r?void 0:r.step)&&void 0!==n?n:e);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}var wn=C("ckb"),yn=function(){function t(e,n){u(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(wn()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("label");r.classList.add(wn("l")),this.element.appendChild(r);var i=e.createElement("input");i.classList.add(wn("i")),i.type="checkbox",r.appendChild(i),this.inputElement=i,n.viewProps.bindDisabled(this.inputElement);var a=e.createElement("div");a.classList.add(wn("w")),r.appendChild(a);var o=Q(e,"check");a.appendChild(o),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}return m(t,[{key:"update_",value:function(){this.inputElement.checked=this.value.rawValue}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),xn=function(){function t(e,n){u(this,t),this.onInputChange_=this.onInputChange_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new yn(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return m(t,[{key:"onInputChange_",value:function(t){var e=t.currentTarget;this.value.rawValue=e.checked}}]),t}();var Cn={id:"input-bool",type:"input",accept:function(t,e){if("boolean"!=typeof t)return null;var n=j(e,{options:z.optional.custom(hn)});return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return ve},constraint:function(t){return e=t.params,n=[],(r=fn(e.options))&&n.push(r),new te(n);var e,n,r},writer:function(t){return cn}},controller:function(t){var e,n=t.document,r=t.value,i=t.constraint;return i&&ee(i,ne)?new se(n,{props:I.fromObject({options:null!==(e=mn(i))&&void 0!==e?e:[]}),value:r,viewProps:t.viewProps}):new xn(n,{value:r,viewProps:t.viewProps})}},En=C("col"),kn=function t(e,n){u(this,t),this.element=e.createElement("div"),this.element.classList.add(En()),n.foldable.bindExpandedClass(this.element,En(void 0,"expanded")),A(n.foldable,"completed",S(this.element,En(void 0,"cpl")));var r=e.createElement("div");r.classList.add(En("h")),this.element.appendChild(r);var i=e.createElement("div");i.classList.add(En("s")),r.appendChild(i),this.swatchElement=i;var a=e.createElement("div");if(a.classList.add(En("t")),r.appendChild(a),this.textElement=a,"inline"===n.pickerLayout){var o=e.createElement("div");o.classList.add(En("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null};function Pn(t,e,n){var r,i,a,o,s,u,l,c,h,d=Je(t,360),p=Ze(e/100,0,1),v=Ze(n/100,0,1),f=v*p,m=f*(1-Math.abs(d/60%2-1)),b=v-f;return d>=0&&d<60?(r=(o=[f,m,0])[0],i=o[1],a=o[2]):d>=60&&d<120?(r=(s=[m,f,0])[0],i=s[1],a=s[2]):d>=120&&d<180?(r=(u=[0,f,m])[0],i=u[1],a=u[2]):d>=180&&d<240?(r=(l=[0,m,f])[0],i=l[1],a=l[2]):d>=240&&d<300?(r=(c=[m,0,f])[0],i=c[1],a=c[2]):(r=(h=[f,0,m])[0],i=h[1],a=h[2]),[255*(r+b),255*(i+b),255*(a+b)]}function Tn(t){return[t[0],t[1],t[2]]}function Mn(t,e){return[t[0],t[1],t[2],e]}var An={hsl:{hsl:function(t,e,n){return[t,e,n]},hsv:function(t,e,n){var r=n+e*(100-Math.abs(2*n-100))/200;return[t,0!==r?e*(100-Math.abs(2*n-100))/r:0,n+e*(100-Math.abs(2*n-100))/200]},rgb:function(t,e,n){var r,i,a,o,s,u,l,c,h,d=(t%360+360)%360,p=Ze(e/100,0,1),v=Ze(n/100,0,1),f=(1-Math.abs(2*v-1))*p,m=f*(1-Math.abs(d/60%2-1)),b=v-f/2;return d>=0&&d<60?(r=(o=[f,m,0])[0],i=o[1],a=o[2]):d>=60&&d<120?(r=(s=[m,f,0])[0],i=s[1],a=s[2]):d>=120&&d<180?(r=(u=[0,f,m])[0],i=u[1],a=u[2]):d>=180&&d<240?(r=(l=[0,m,f])[0],i=l[1],a=l[2]):d>=240&&d<300?(r=(c=[m,0,f])[0],i=c[1],a=c[2]):(r=(h=[f,0,m])[0],i=h[1],a=h[2]),[255*(r+b),255*(i+b),255*(a+b)]}},hsv:{hsl:function(t,e,n){var r=100-Math.abs(n*(200-e)/100-100);return[t,0!==r?e*n/r:0,n*(200-e)/200]},hsv:function(t,e,n){return[t,e,n]},rgb:Pn},rgb:{hsl:function(t,e,n){var r=Ze(t/255,0,1),i=Ze(e/255,0,1),a=Ze(n/255,0,1),o=Math.max(r,i,a),s=Math.min(r,i,a),u=o-s,l=0,c=0,h=(s+o)/2;return 0!==u&&(c=u/(1-Math.abs(o+s-1)),l=(l=r===o?(i-a)/u:i===o?2+(a-r)/u:4+(r-i)/u)/6+(l<0?1:0)),[360*l,100*c,100*h]},hsv:function(t,e,n){var r=Ze(t/255,0,1),i=Ze(e/255,0,1),a=Ze(n/255,0,1),o=Math.max(r,i,a),s=o-Math.min(r,i,a);return[0===s?0:o===r?((i-a)/s%6+6)%6*60:o===i?60*((a-r)/s+2):60*((r-i)/s+4),100*(0===o?0:s/o),100*o]},rgb:function(t,e,n){return[t,e,n]}}};var Sn={hsl:function(t){var e;return[Je(t[0],360),Ze(t[1],0,100),Ze(t[2],0,100),Ze(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},hsv:function(t){var e;return[Je(t[0],360),Ze(t[1],0,100),Ze(t[2],0,100),Ze(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},rgb:function(t){var e;return[Ze(t[0],0,255),Ze(t[1],0,255),Ze(t[2],0,255),Ze(null!==(e=t[3])&&void 0!==e?e:1,0,1)]}};function Rn(t,e){return"object"==typeof t&&!l(t)&&(e in t&&"number"==typeof t[e])}var Fn=function(){function t(e,n){u(this,t),this.mode_=n,this.comps_=Sn[n](e)}return m(t,[{key:"mode",get:function(){return this.mode_}},{key:"getComponents",value:function(t){return Mn((e=Tn(this.comps_),n=this.mode_,r=t||this.mode_,(i=An[n])[r].apply(i,k(e))),this.comps_[3]);var e,n,r,i}},{key:"toRgbaObject",value:function(){var t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}],[{key:"black",value:function(){return new t([0,0,0],"rgb")}},{key:"fromObject",value:function(e){return new t("a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b],"rgb")}},{key:"toRgbaObject",value:function(t){return t.toRgbaObject()}},{key:"isRgbColorObject",value:function(t){return Rn(t,"r")&&Rn(t,"g")&&Rn(t,"b")}},{key:"isRgbaColorObject",value:function(t){return this.isRgbColorObject(t)&&Rn(t,"a")}},{key:"isColorObject",value:function(t){return this.isRgbColorObject(t)}},{key:"equals",value:function(t,e){if(t.mode_!==e.mode_)return!1;for(var n=t.comps_,r=e.comps_,i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}}]),t}(),Bn=C("colp"),Vn=function(){function t(e,n){u(this,t),this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Bn());var r=e.createElement("div");r.classList.add(Bn("hsv"));var i=e.createElement("div");i.classList.add(Bn("sv")),this.svPaletteView_=n.svPaletteView,i.appendChild(this.svPaletteView_.element),r.appendChild(i);var a=e.createElement("div");a.classList.add(Bn("h")),this.hPaletteView_=n.hPaletteView,a.appendChild(this.hPaletteView_.element),r.appendChild(a),this.element.appendChild(r);var o=e.createElement("div");if(o.classList.add(Bn("rgb")),this.textView_=n.textView,o.appendChild(this.textView_.element),this.element.appendChild(o),n.alphaViews){this.alphaViews_={palette:n.alphaViews.palette,text:n.alphaViews.text};var s=e.createElement("div");s.classList.add(Bn("a"));var l=e.createElement("div");l.classList.add(Bn("ap")),l.appendChild(this.alphaViews_.palette.element),s.appendChild(l);var c=e.createElement("div");c.classList.add(Bn("at")),c.appendChild(this.alphaViews_.text.element),s.appendChild(c),this.element.appendChild(s)}}return m(t,[{key:"allFocusableElements",get:function(){var t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement].concat(k(this.textView_.textViews.map((function(t){return t.inputElement}))));return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}]),t}();function Ln(t){var e=z;return j(t,{alpha:e.optional.boolean,expanded:e.optional.boolean,picker:e.optional.custom(dn)})}function Dn(t){return t?.1:1}function Un(t,e){var n=t.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*e,e):Math.min(parseFloat(t),e)}var In={deg:function(t){return t},grad:function(t){return 360*t/400},rad:function(t){return 360*t/(2*Math.PI)},turn:function(t){return 360*t}};function On(t){var e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);var n=parseFloat(e[1]),r=e[2];return In[r](n)}var Nn={"func.rgb":function(t){var e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[Un(e[1],255),Un(e[2],255),Un(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new Fn(n,"rgb")},"func.rgba":function(t){var e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[Un(e[1],255),Un(e[2],255),Un(e[3],255),Un(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new Fn(n,"rgb")},"func.hsl":function(t){var e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[On(e[1]),Un(e[2],100),Un(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new Fn(n,"hsl")},"func.hsla":function(t){var e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[On(e[1]),Un(e[2],100),Un(e[3],100),Un(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new Fn(n,"hsl")},"hex.rgb":function(t){var e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new Fn([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)],"rgb");var n=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new Fn([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb"):null},"hex.rgba":function(t){var e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new Fn([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),$e(parseInt(e[4]+e[4],16),0,255,0,1)],"rgb");var n=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new Fn([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),$e(parseInt(n[4],16),0,255,0,1)],"rgb"):null}};function zn(t){return Object.keys(Nn).reduce((function(e,n){return e||((0,Nn[n])(t)?n:null)}),null)}var jn=function(t){var e=zn(t);return e?Nn[e](t):null};function Hn(t){return"func.hsla"===t||"func.rgba"===t||"hex.rgba"===t}function Kn(t){if("string"==typeof t){var e=jn(t);if(e)return e}return Fn.black()}function Gn(t){var e=Ze(Math.floor(t),0,255).toString(16);return 1===e.length?"0".concat(e):e}function Wn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",n=Tn(t.getComponents("rgb")).map(Gn).join("");return"".concat(e).concat(n)}function qn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",n=t.getComponents("rgb"),r=[n[0],n[1],n[2],255*n[3]].map(Gn).join("");return"".concat(e).concat(r)}function Xn(t){var e=De(0),n=Tn(t.getComponents("rgb")).map((function(t){return e(t)}));return"rgb(".concat(n.join(", "),")")}function Yn(t){var e=De(2),n=De(0),r=t.getComponents("rgb").map((function(t,r){return(3===r?e:n)(t)}));return"rgba(".concat(r.join(", "),")")}var $n={"func.hsl":function(t){var e=[De(0),Ie,Ie],n=Tn(t.getComponents("hsl")).map((function(t,n){return e[n](t)}));return"hsl(".concat(n.join(", "),")")},"func.hsla":function(t){var e=[De(0),Ie,Ie,De(2)],n=t.getComponents("hsl").map((function(t,n){return e[n](t)}));return"hsla(".concat(n.join(", "),")")},"func.rgb":Xn,"func.rgba":Yn,"hex.rgb":Wn,"hex.rgba":qn};function Qn(t){return $n[t]}var Zn=C("apl"),Jn=function(){function t(e,n){u(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Zn()),n.viewProps.bindTabIndex(this.element);var r=e.createElement("div");r.classList.add(Zn("b")),this.element.appendChild(r);var i=e.createElement("div");i.classList.add(Zn("c")),r.appendChild(i),this.colorElem_=i;var a=e.createElement("div");a.classList.add(Zn("m")),this.element.appendChild(a),this.markerElem_=a;var o=e.createElement("div");o.classList.add(Zn("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}return m(t,[{key:"update_",value:function(){var t=this.value.rawValue,e=t.getComponents("rgb"),n=new Fn([e[0],e[1],e[2],0],"rgb"),r=new Fn([e[0],e[1],e[2],255],"rgb"),i=["to right",Yn(n),Yn(r)];this.colorElem_.style.background="linear-gradient(".concat(i.join(","),")"),this.previewElem_.style.backgroundColor=Yn(t);var a=$e(e[3],0,1,0,100);this.markerElem_.style.left="".concat(a,"%")}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),tr=function(){function t(e,n){u(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Jn(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ye(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}return m(t,[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=t.point.x/t.bounds.width,r=E(this.value.rawValue.getComponents("hsv")),i=r[0],a=r[1],o=r[2];this.value.setRawValue(new Fn([i,a,o,n],"hsv"),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){var e=Ke(Dn(!0),We(t));if(0!==e){var n=E(this.value.rawValue.getComponents("hsv")),r=n[0],i=n[1],a=n[2],o=n[3];this.value.setRawValue(new Fn([r,i,a,o+e],"hsv"),{forceEmit:!1,last:!1})}}},{key:"onKeyUp_",value:function(t){0!==Ke(Dn(!0),We(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),er=C("coltxt");var nr=function(){function t(e,n){var r=this;u(this,t),this.element=e.createElement("div"),this.element.classList.add(er());var i=e.createElement("div");i.classList.add(er("m")),this.modeElem_=function(t){var e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((function(e,n){var r=t.createElement("option");return r.textContent=n.text,r.value=n.value,e.appendChild(r),e}),t.createDocumentFragment())),e}(e),this.modeElem_.classList.add(er("ms")),i.appendChild(this.modeSelectElement);var a=e.createElement("div");a.classList.add(er("mm")),a.appendChild(Q(e,"dropdown")),i.appendChild(a),this.element.appendChild(i);var o=e.createElement("div");o.classList.add(er("w")),this.element.appendChild(o),this.textsElem_=o,this.textViews_=n.textViews,this.applyTextViews_(),M(n.colorMode,(function(t){r.modeElem_.value=t}))}return m(t,[{key:"modeSelectElement",get:function(){return this.modeElem_}},{key:"textViews",get:function(){return this.textViews_},set:function(t){this.textViews_=t,this.applyTextViews_()}},{key:"applyTextViews_",value:function(){var t=this;tt(this.textsElem_);var e=this.element.ownerDocument;this.textViews_.forEach((function(n){var r=e.createElement("div");r.classList.add(er("c")),r.appendChild(n.element),t.textsElem_.appendChild(r)}))}}]),t}(),rr=De(0),ir={rgb:function(){return new re({min:0,max:255})},hsl:function(t){return new re(0===t?{min:0,max:360}:{min:0,max:100})},hsv:function(t){return new re(0===t?{min:0,max:360}:{min:0,max:100})}};function ar(t,e,n){return new nn(t,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:Dn(!1),parser:e.parser,props:I.fromObject({draggingScale:1,formatter:rr}),value:U(0,{constraint:ir[e.colorMode](n)}),viewProps:e.viewProps})}var or=function(){function t(e,n){u(this,t),this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=n.parser,this.value=n.value,this.viewProps=n.viewProps,this.colorMode=U(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new nr(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}return m(t,[{key:"createComponentControllers_",value:function(t){var e=this,n={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},r=[ar(t,n,0),ar(t,n,1),ar(t,n,2)];return r.forEach((function(t,n){var r=e;He({primary:e.value,secondary:t.value,forward:function(t){return t.rawValue.getComponents(r.colorMode.rawValue)[n]},backward:function(t,e){var i=r.colorMode.rawValue,a=t.rawValue.getComponents(i);return a[n]=e.rawValue,new Fn(Mn(Tn(a),a[3]),i)}})})),r}},{key:"onModeSelectChange_",value:function(t){var e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}]),t}(),sr=C("hpl"),ur=function(){function t(e,n){u(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(sr()),n.viewProps.bindTabIndex(this.element);var r=e.createElement("div");r.classList.add(sr("c")),this.element.appendChild(r);var i=e.createElement("div");i.classList.add(sr("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}return m(t,[{key:"update_",value:function(){var t=E(this.value.rawValue.getComponents("hsv"))[0];this.markerElem_.style.backgroundColor=Xn(new Fn([t,100,100],"hsv"));var e=$e(t,0,360,0,100);this.markerElem_.style.left="".concat(e,"%")}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),lr=function(){function t(e,n){u(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new ur(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ye(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}return m(t,[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=$e(t.point.x,0,t.bounds.width,0,360),r=E(this.value.rawValue.getComponents("hsv")),i=r[1],a=r[2],o=r[3];this.value.setRawValue(new Fn([n,i,a,o],"hsv"),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){var e=Ke(Dn(!1),We(t));if(0!==e){var n=E(this.value.rawValue.getComponents("hsv")),r=n[0],i=n[1],a=n[2],o=n[3];this.value.setRawValue(new Fn([r+e,i,a,o],"hsv"),{forceEmit:!1,last:!1})}}},{key:"onKeyUp_",value:function(t){0!==Ke(Dn(!1),We(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),cr=C("svp"),hr=function(){function t(e,n){u(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(cr()),n.viewProps.bindTabIndex(this.element);var r=e.createElement("canvas");r.height=64,r.width=64,r.classList.add(cr("c")),this.element.appendChild(r),this.canvasElement=r;var i=e.createElement("div");i.classList.add(cr("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}return m(t,[{key:"update_",value:function(){var t,e,n=(t=this.canvasElement,(e=t.ownerDocument.defaultView)&&"document"in e?t.getContext("2d"):null);if(n){for(var r=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,a=this.canvasElement.height,o=n.getImageData(0,0,i,a),s=o.data,u=0;u<a;u++)for(var l=0;l<i;l++){var c=$e(l,0,i,0,100),h=$e(u,0,a,100,0),d=Pn(r[0],c,h),p=4*(u*i+l);s[p]=d[0],s[p+1]=d[1],s[p+2]=d[2],s[p+3]=255}n.putImageData(o,0,0);var v=$e(r[1],0,100,0,100);this.markerElem_.style.left="".concat(v,"%");var f=$e(r[2],0,100,100,0);this.markerElem_.style.top="".concat(f,"%")}}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),dr=function(){function t(e,n){u(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new hr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ye(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}return m(t,[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=$e(t.point.x,0,t.bounds.width,0,100),r=$e(t.point.y,0,t.bounds.height,100,0),i=E(this.value.rawValue.getComponents("hsv")),a=i[0],o=i[3];this.value.setRawValue(new Fn([a,n,r,o],"hsv"),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(t){qe(t.key)&&t.preventDefault();var e=E(this.value.rawValue.getComponents("hsv")),n=e[0],r=e[1],i=e[2],a=e[3],o=Dn(!1),s=Ke(o,We(t)),u=Ke(o,Ge(t));0===s&&0===u||this.value.setRawValue(new Fn([n,r+s,i+u,a],"hsv"),{forceEmit:!1,last:!1})}},{key:"onKeyUp_",value:function(t){var e=Dn(!1),n=Ke(e,We(t)),r=Ke(e,Ge(t));0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),pr=function(){function t(e,n){u(this,t),this.value=n.value,this.viewProps=n.viewProps,this.hPaletteC_=new lr(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new dr(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=n.supportsAlpha?{palette:new tr(e,{value:this.value,viewProps:this.viewProps}),text:new nn(e,{parser:Be,baseStep:.1,props:I.fromObject({draggingScale:.01,formatter:De(2)}),value:U(0,{constraint:new re({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&He({primary:this.value,secondary:this.alphaIcs_.text.value,forward:function(t){return t.rawValue.getComponents()[3]},backward:function(t,e){var n=t.rawValue.getComponents();return n[3]=e.rawValue,new Fn(n,t.rawValue.mode)}}),this.textC_=new or(e,{parser:Be,value:this.value,viewProps:this.viewProps}),this.view=new Vn(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:n.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}return m(t,[{key:"textController",get:function(){return this.textC_}}]),t}(),vr=C("colsw"),fr=function(){function t(e,n){u(this,t),this.onValueChange_=this.onValueChange_.bind(this),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.element=e.createElement("div"),this.element.classList.add(vr()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("div");r.classList.add(vr("sw")),this.element.appendChild(r),this.swatchElem_=r;var i=e.createElement("button");i.classList.add(vr("b")),n.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}return m(t,[{key:"update_",value:function(){var t=this.value.rawValue;this.swatchElem_.style.backgroundColor=qn(t)}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),mr=function t(e,n){u(this,t),this.value=n.value,this.viewProps=n.viewProps,this.view=new fr(e,{value:this.value,viewProps:this.viewProps})},br=function(){function t(e,n){var r=this;u(this,t),this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=ut.create(n.expanded),this.swatchC_=new mr(e,{value:this.value,viewProps:this.viewProps});var i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new pe(e,{parser:n.parser,props:I.fromObject({formatter:n.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new kn(e,{foldable:this.foldable_,pickerLayout:n.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===n.pickerLayout?new ce(e,{viewProps:this.viewProps}):null;var a=new pr(e,{supportsAlpha:n.supportsAlpha,value:this.value,viewProps:this.viewProps});a.view.allFocusableElements.forEach((function(t){t.addEventListener("blur",r.onPopupChildBlur_),t.addEventListener("keydown",r.onPopupChildKeydown_)})),this.pickerC_=a,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(a.view.element),He({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:function(t){return t.rawValue},backward:function(t,e){return e.rawValue}})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ct(this.foldable_,this.view.pickerElement))}return m(t,[{key:"textController",get:function(){return this.textC_}},{key:"onButtonBlur_",value:function(t){if(this.popC_){var e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}}},{key:"onButtonClick_",value:function(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}},{key:"onPopupChildBlur_",value:function(t){if(this.popC_){var e=this.popC_.view.element,n=et(t);n&&e.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!X(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}}},{key:"onPopupChildKeydown_",value:function(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}]),t}();function _r(t){return Fn.isColorObject(t)?Fn.fromObject(t):Fn.black()}function gr(t){return Tn(t.getComponents("rgb")).reduce((function(t,e){return t<<8|255&Math.floor(e)}),0)}function wr(t){return t.getComponents("rgb").reduce((function(t,e,n){return t<<8|255&Math.floor(3===n?255*e:e)}),0)>>>0}function yr(t){return"number"!=typeof t?Fn.black():new Fn([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function xr(t){return"number"!=typeof t?Fn.black():new Fn([(e=t)>>24&255,e>>16&255,e>>8&255,$e(255&e,0,255,0,1)],"rgb");var e}function Cr(t,e){var n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b),t.writeProperty("a",n.a)}function Er(t,e){var n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b)}function kr(t){return"alpha"in t&&!0===t.alpha}function Pr(t){return t?function(t){return qn(t,"0x")}:function(t){return Wn(t,"0x")}}var Tr={id:"input-color-number",type:"input",accept:function(t,e){if("number"!=typeof t)return null;if(!("view"in e))return null;if("color"!==e.view)return null;var n=Ln(e);return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return kr(t.params)?xr:yr},equals:Fn.equals,writer:function(t){return e=kr(t.params),n=e?wr:gr,function(t,e){cn(t,n(e))};var e,n}},controller:function(t){var e=kr(t.params),n="expanded"in t.params?t.params.expanded:void 0,r="picker"in t.params?t.params.picker:void 0;return new br(t.document,{expanded:null!=n&&n,formatter:Pr(e),parser:jn,pickerLayout:null!=r?r:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}};var Mr={id:"input-color-object",type:"input",accept:function(t,e){if(!Fn.isColorObject(t))return null;var n=Ln(e);return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return _r},equals:Fn.equals,writer:function(t){return e=t.initialValue,Fn.isRgbaColorObject(e)?Cr:Er;var e}},controller:function(t){var e=Fn.isRgbaColorObject(t.initialValue),n="expanded"in t.params?t.params.expanded:void 0,r="picker"in t.params?t.params.picker:void 0,i=e?qn:Wn;return new br(t.document,{expanded:null!=n&&n,formatter:i,parser:jn,pickerLayout:null!=r?r:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}},Ar={id:"input-color-string",type:"input",accept:function(t,e){if("string"!=typeof t)return null;if("view"in e&&"text"===e.view)return null;if(!zn(t))return null;var n=Ln(e);return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return Kn},equals:Fn.equals,writer:function(t){var e=zn(t.initialValue);if(!e)throw d.shouldNeverHappen();return function(t){var e=Qn(t);return function(t,n){cn(t,e(n))}}(e)}},controller:function(t){var e=zn(t.initialValue);if(!e)throw d.shouldNeverHappen();var n=Qn(e),r="expanded"in t.params?t.params.expanded:void 0,i="picker"in t.params?t.params.picker:void 0;return new br(t.document,{expanded:null!=r&&r,formatter:n,parser:jn,pickerLayout:null!=i?i:"popup",supportsAlpha:Hn(e),value:t.value,viewProps:t.viewProps})}},Sr=function(){function t(e){u(this,t),this.components=e.components,this.asm_=e.assembly}return m(t,[{key:"constrain",value:function(t){var e=this,n=this.asm_.toComponents(t).map((function(t,n){var r,i;return null!==(i=null===(r=e.components[n])||void 0===r?void 0:r.constrain(t))&&void 0!==i?i:t}));return this.asm_.fromComponents(n)}}]),t}(),Rr=C("pndtxt"),Fr=function t(e,n){var r=this;u(this,t),this.textViews=n.textViews,this.element=e.createElement("div"),this.element.classList.add(Rr()),this.textViews.forEach((function(t){var n=e.createElement("div");n.classList.add(Rr("a")),n.appendChild(t.element),r.element.appendChild(n)}))};var Br=function t(e,n){var r=this;u(this,t),this.value=n.value,this.viewProps=n.viewProps,this.acs_=n.axes.map((function(t,r){return function(t,e,n){return new nn(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,parser:e.parser,props:e.axes[n].textProps,value:U(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}(e,n,r)})),this.acs_.forEach((function(t,e){He({primary:r.value,secondary:t.value,forward:function(t){return n.assembly.toComponents(t.rawValue)[e]},backward:function(t,r){var i=n.assembly.toComponents(t.rawValue);return i[e]=r.rawValue,n.assembly.fromComponents(i)}})})),this.view=new Fr(e,{textViews:this.acs_.map((function(t){return t.view}))})};function Vr(t){var e=[],n=function(t){return"step"in t&&!l(t.step)?new ie(t.step):null}(t);n&&e.push(n);var r=function(t){return"max"in t&&!l(t.max)||"min"in t&&!l(t.min)?new re({max:t.max,min:t.min}):null}(t);r&&e.push(r);var i=fn(t.options);return i&&e.push(i),new te(e)}function Lr(t){var e=E(function(t){var e=t?ee(t,re):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}(t)),n=e[0],r=e[1];return[null!=n?n:0,null!=r?r:100]}var Dr={id:"input-number",type:"input",accept:function(t,e){if("number"!=typeof t)return null;var n=z,r=j(e,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(hn),step:n.optional.number});return r?{initialValue:t,params:r}:null},binding:{reader:function(t){return Ve},constraint:function(t){return Vr(t.params)},writer:function(t){return cn}},controller:function(t){var e,n,r=t.value,i=t.constraint;if(i&&ee(i,ne))return new se(t.document,{props:I.fromObject({options:null!==(e=mn(i))&&void 0!==e?e:[]}),value:r,viewProps:t.viewProps});var a=null!==(n="format"in t.params?t.params.format:void 0)&&void 0!==n?n:De(bn(i,r.rawValue));if(i&&ee(i,re)){var o=E(Lr(i)),s=o[0],u=o[1];return new ln(t.document,{baseStep:_n(i),parser:Be,sliderProps:I.fromObject({maxValue:u,minValue:s}),textProps:I.fromObject({draggingScale:gn(i,r.rawValue),formatter:a}),value:r,viewProps:t.viewProps})}return new nn(t.document,{baseStep:_n(i),parser:Be,props:I.fromObject({draggingScale:gn(i,r.rawValue),formatter:a}),value:r,viewProps:t.viewProps})}},Ur=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;u(this,t),this.x=e,this.y=n}return m(t,[{key:"getComponents",value:function(){return[this.x,this.y]}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}}],[{key:"isObject",value:function(t){if(l(t))return!1;var e=t.x,n=t.y;return"number"==typeof e&&"number"==typeof n}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y}}]),t}(),Ir={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return v(Ur,k(t))}},Or=C("p2d"),Nr=function t(e,n){u(this,t),this.element=e.createElement("div"),this.element.classList.add(Or()),n.viewProps.bindClassModifiers(this.element),M(n.expanded,S(this.element,Or(void 0,"expanded")));var r=e.createElement("div");r.classList.add(Or("h")),this.element.appendChild(r);var i=e.createElement("button");i.classList.add(Or("b")),i.appendChild(Q(e,"p2dpad")),n.viewProps.bindDisabled(i),r.appendChild(i),this.buttonElement=i;var a=e.createElement("div");if(a.classList.add(Or("t")),r.appendChild(a),this.textElement=a,"inline"===n.pickerLayout){var o=e.createElement("div");o.classList.add(Or("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null},zr=C("p2dp"),jr=function(){function t(e,n){u(this,t),this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=n.invertsY,this.maxValue_=n.maxValue,this.element=e.createElement("div"),this.element.classList.add(zr()),"popup"===n.layout&&this.element.classList.add(zr(void 0,"p"));var r=e.createElement("div");r.classList.add(zr("p")),n.viewProps.bindTabIndex(r),this.element.appendChild(r),this.padElement=r;var i=e.createElementNS(W,"svg");i.classList.add(zr("g")),this.padElement.appendChild(i),this.svgElem_=i;var a=e.createElementNS(W,"line");a.classList.add(zr("ax")),a.setAttributeNS(null,"x1","0"),a.setAttributeNS(null,"y1","50%"),a.setAttributeNS(null,"x2","100%"),a.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(a);var o=e.createElementNS(W,"line");o.classList.add(zr("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);var s=e.createElementNS(W,"line");s.classList.add(zr("l")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(s),this.lineElem_=s;var l=e.createElement("div");l.classList.add(zr("m")),this.padElement.appendChild(l),this.markerElem_=l,n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}return m(t,[{key:"allFocusableElements",get:function(){return[this.padElement]}},{key:"update_",value:function(){var t=E(this.value.rawValue.getComponents()),e=t[0],n=t[1],r=this.maxValue_,i=$e(e,-r,+r,0,100),a=$e(n,-r,+r,0,100),o=this.invertsY_?100-a:a;this.lineElem_.setAttributeNS(null,"x2","".concat(i,"%")),this.lineElem_.setAttributeNS(null,"y2","".concat(o,"%")),this.markerElem_.style.left="".concat(i,"%"),this.markerElem_.style.top="".concat(o,"%")}},{key:"onValueChange_",value:function(){this.update_()}},{key:"onFoldableChange_",value:function(){this.update_()}}]),t}();function Hr(t,e,n){return[Ke(e[0],We(t)),Ke(e[1],Ge(t))*(n?1:-1)]}var Kr=function(){function t(e,n){u(this,t),this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.baseSteps_=n.baseSteps,this.maxValue_=n.maxValue,this.invertsY_=n.invertsY,this.view=new jr(e,{invertsY:this.invertsY_,layout:n.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ye(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}return m(t,[{key:"handlePointerEvent_",value:function(t,e){if(t.point){var n=this.maxValue_,r=$e(t.point.x,0,t.bounds.width,-n,+n),i=$e(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new Ur(r,i),e)}}},{key:"onPointerDown_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}},{key:"onPadKeyDown_",value:function(t){qe(t.key)&&t.preventDefault();var e=E(Hr(t,this.baseSteps_,this.invertsY_)),n=e[0],r=e[1];0===n&&0===r||this.value.setRawValue(new Ur(this.value.rawValue.x+n,this.value.rawValue.y+r),{forceEmit:!1,last:!1})}},{key:"onPadKeyUp_",value:function(t){var e=E(Hr(t,this.baseSteps_,this.invertsY_)),n=e[0],r=e[1];0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),Gr=function(){function t(e,n){var r,i,a=this;u(this,t),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=ut.create(n.expanded),this.popC_="popup"===n.pickerLayout?new ce(e,{viewProps:this.viewProps}):null;var o=new Kr(e,{baseSteps:[n.axes[0].baseStep,n.axes[1].baseStep],invertsY:n.invertsY,layout:n.pickerLayout,maxValue:n.maxValue,value:this.value,viewProps:this.viewProps});o.view.allFocusableElements.forEach((function(t){t.addEventListener("blur",a.onPopupChildBlur_),t.addEventListener("keydown",a.onPopupChildKeydown_)})),this.pickerC_=o,this.textC_=new Br(e,{assembly:Ir,axes:n.axes,parser:n.parser,value:this.value,viewProps:this.viewProps}),this.view=new Nr(e,{expanded:this.foldable_.value("expanded"),pickerLayout:n.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),He({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:function(t){return t.rawValue},backward:function(t,e){return e.rawValue}})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ct(this.foldable_,this.view.pickerElement))}return m(t,[{key:"onPadButtonBlur_",value:function(t){if(this.popC_){var e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}}},{key:"onPadButtonClick_",value:function(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}},{key:"onPopupChildBlur_",value:function(t){if(this.popC_){var e=this.popC_.view.element,n=et(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!X(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}}},{key:"onPopupChildKeydown_",value:function(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}]),t}();function Wr(t){return Ur.isObject(t)?new Ur(t.x,t.y):new Ur}function qr(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Xr(t){if(t){var e=[];return l(t.step)||e.push(new ie(t.step)),l(t.max)&&l(t.min)||e.push(new re({max:t.max,min:t.min})),new te(e)}}function Yr(t,e){var n=t&&ee(t,re);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));var r=_n(t);return Math.max(10*Math.abs(r),10*Math.abs(e))}function $r(t,e){return{baseStep:_n(e),constraint:e,textProps:I.fromObject({draggingScale:gn(e,t),formatter:De(bn(e,t))})}}function Qr(t){if(!("y"in t))return!1;var e=t.y;return!!e&&("inverted"in e&&!!e.inverted)}var Zr={id:"input-point2d",type:"input",accept:function(t,e){if(!Ur.isObject(t))return null;var n=z,r=j(e,{expanded:n.optional.boolean,picker:n.optional.custom(dn),x:n.optional.custom(pn),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return r?{initialValue:t,params:r}:null},binding:{reader:function(t){return Wr},constraint:function(t){return e=t.params,new Sr({assembly:Ir,components:[Xr("x"in e?e.x:void 0),Xr("y"in e?e.y:void 0)]});var e},equals:Ur.equals,writer:function(t){return qr}},controller:function(t){var e=t.document,n=t.value,r=t.constraint;if(!(r instanceof Sr))throw d.shouldNeverHappen();var i,a,o,s,u,l,c="expanded"in t.params?t.params.expanded:void 0,h="picker"in t.params?t.params.picker:void 0;return new Gr(e,{axes:[$r(n.rawValue.x,r.components[0]),$r(n.rawValue.y,r.components[1])],expanded:null!=c&&c,invertsY:Qr(t.params),maxValue:(i=n.rawValue,a=r,o=a instanceof Sr?a.components[0]:void 0,s=a instanceof Sr?a.components[1]:void 0,u=Yr(o,i.x),l=Yr(s,i.y),Math.max(u,l)),parser:Be,pickerLayout:null!=h?h:"popup",value:n,viewProps:t.viewProps})}},Jr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;u(this,t),this.x=e,this.y=n,this.z=r}return m(t,[{key:"getComponents",value:function(){return[this.x,this.y,this.z]}},{key:"toObject",value:function(){return{x:this.x,y:this.y,z:this.z}}}],[{key:"isObject",value:function(t){if(l(t))return!1;var e=t.x,n=t.y,r=t.z;return"number"==typeof e&&"number"==typeof n&&"number"==typeof r}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}}]),t}(),ti={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return v(Jr,k(t))}};function ei(t){return Jr.isObject(t)?new Jr(t.x,t.y,t.z):new Jr}function ni(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}function ri(t){if(t){var e=[];return l(t.step)||e.push(new ie(t.step)),l(t.max)&&l(t.min)||e.push(new re({max:t.max,min:t.min})),new te(e)}}function ii(t,e){return{baseStep:_n(e),constraint:e,textProps:I.fromObject({draggingScale:gn(e,t),formatter:De(bn(e,t))})}}var ai={id:"input-point3d",type:"input",accept:function(t,e){if(!Jr.isObject(t))return null;var n=z,r=j(e,{x:n.optional.custom(pn),y:n.optional.custom(pn),z:n.optional.custom(pn)});return r?{initialValue:t,params:r}:null},binding:{reader:function(t){return ei},constraint:function(t){return e=t.params,new Sr({assembly:ti,components:[ri("x"in e?e.x:void 0),ri("y"in e?e.y:void 0),ri("z"in e?e.z:void 0)]});var e},equals:Jr.equals,writer:function(t){return ni}},controller:function(t){var e=t.value,n=t.constraint;if(!(n instanceof Sr))throw d.shouldNeverHappen();return new Br(t.document,{assembly:ti,axes:[ii(e.rawValue.x,n.components[0]),ii(e.rawValue.y,n.components[1]),ii(e.rawValue.z,n.components[2])],parser:Be,value:e,viewProps:t.viewProps})}},oi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;u(this,t),this.x=e,this.y=n,this.z=r,this.w=i}return m(t,[{key:"getComponents",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"toObject",value:function(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}],[{key:"isObject",value:function(t){if(l(t))return!1;var e=t.x,n=t.y,r=t.z,i=t.w;return"number"==typeof e&&"number"==typeof n&&"number"==typeof r&&"number"==typeof i}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}}]),t}(),si={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return v(oi,k(t))}};function ui(t){return oi.isObject(t)?new oi(t.x,t.y,t.z,t.w):new oi}function li(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}function ci(t){if(t){var e=[];return l(t.step)||e.push(new ie(t.step)),l(t.max)&&l(t.min)||e.push(new re({max:t.max,min:t.min})),new te(e)}}var hi={id:"input-point4d",type:"input",accept:function(t,e){if(!oi.isObject(t))return null;var n=z,r=j(e,{x:n.optional.custom(pn),y:n.optional.custom(pn),z:n.optional.custom(pn),w:n.optional.custom(pn)});return r?{initialValue:t,params:r}:null},binding:{reader:function(t){return ui},constraint:function(t){return e=t.params,new Sr({assembly:si,components:[ci("x"in e?e.x:void 0),ci("y"in e?e.y:void 0),ci("z"in e?e.z:void 0),ci("w"in e?e.w:void 0)]});var e},equals:oi.equals,writer:function(t){return li}},controller:function(t){var e=t.value,n=t.constraint;if(!(n instanceof Sr))throw d.shouldNeverHappen();return new Br(t.document,{assembly:si,axes:e.rawValue.getComponents().map((function(t,e){return r=t,{baseStep:_n(i=n.components[e]),constraint:i,textProps:I.fromObject({draggingScale:gn(i,r),formatter:De(bn(i,r))})};var r,i})),parser:Be,value:e,viewProps:t.viewProps})}};var di={id:"input-string",type:"input",accept:function(t,e){if("string"!=typeof t)return null;var n=j(e,{options:z.optional.custom(hn)});return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return Oe},constraint:function(t){return e=t.params,n=[],(r=fn(e.options))&&n.push(r),new te(n);var e,n,r},writer:function(t){return cn}},controller:function(t){var e,n=t.document,r=t.value,i=t.constraint;return i&&ee(i,ne)?new se(n,{props:I.fromObject({options:null!==(e=mn(i))&&void 0!==e?e:[]}),value:r,viewProps:t.viewProps}):new pe(n,{parser:function(t){return t},props:I.fromObject({formatter:Ne}),value:r,viewProps:t.viewProps})}},pi={defaultInterval:200,defaultLineCount:3},vi=C("mll"),fi=function(){function t(e,n){u(this,t),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=e.createElement("div"),this.element.classList.add(vi()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("textarea");r.classList.add(vi("i")),r.style.height="calc(var(--bld-us) * ".concat(n.lineCount,")"),r.readOnly=!0,n.viewProps.bindDisabled(r),this.element.appendChild(r),this.textareaElem_=r,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}return m(t,[{key:"update_",value:function(){var t=this,e=this.textareaElem_,n=e.scrollTop===e.scrollHeight-e.clientHeight,r=[];this.value.rawValue.forEach((function(e){void 0!==e&&r.push(t.formatter_(e))})),e.textContent=r.join("\n"),n&&(e.scrollTop=e.scrollHeight)}},{key:"onValueUpdate_",value:function(){this.update_()}}]),t}(),mi=function t(e,n){u(this,t),this.value=n.value,this.viewProps=n.viewProps,this.view=new fi(e,{formatter:n.formatter,lineCount:n.lineCount,value:this.value,viewProps:this.viewProps})},bi=C("sgl"),_i=function(){function t(e,n){u(this,t),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=e.createElement("div"),this.element.classList.add(bi()),n.viewProps.bindClassModifiers(this.element);var r=e.createElement("input");r.classList.add(bi("i")),r.readOnly=!0,r.type="text",n.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}return m(t,[{key:"update_",value:function(){var t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}},{key:"onValueUpdate_",value:function(){this.update_()}}]),t}(),gi=function t(e,n){u(this,t),this.value=n.value,this.viewProps=n.viewProps,this.view=new _i(e,{formatter:n.formatter,value:this.value,viewProps:this.viewProps})},wi={id:"monitor-bool",type:"monitor",accept:function(t,e){if("boolean"!=typeof t)return null;var n=j(e,{lineCount:z.optional.number});return n?{initialValue:t,params:n}:null},binding:{reader:function(t){return ve}},controller:function(t){var e;return 1===t.value.rawValue.length?new gi(t.document,{formatter:fe,value:t.value,viewProps:t.viewProps}):new mi(t.document,{formatter:fe,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:pi.defaultLineCount,value:t.value,viewProps:t.viewProps})}},yi=function(){function t(){u(this,t),this.emitter=new _,this.index_=-1}return m(t,[{key:"index",get:function(){return this.index_},set:function(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}}]),t}(),xi=C("grl"),Ci=function(){function t(e,n){u(this,t),this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(xi()),n.viewProps.bindClassModifiers(this.element),this.formatter_=n.formatter,this.minValue_=n.minValue,this.maxValue_=n.maxValue,this.cursor_=n.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);var r=e.createElementNS(W,"svg");r.classList.add(xi("g")),r.style.height="calc(var(--bld-us) * ".concat(n.lineCount,")"),this.element.appendChild(r),this.svgElem_=r;var i=e.createElementNS(W,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;var a=e.createElement("div");a.classList.add(xi("t"),C("tt")()),this.element.appendChild(a),this.tooltipElem_=a,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}return m(t,[{key:"graphElement",get:function(){return this.svgElem_}},{key:"update_",value:function(){var t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,n=this.minValue_,r=this.maxValue_,i=[];this.value.rawValue.forEach((function(a,o){if(void 0!==a){var s=$e(o,0,e,0,t.width),u=$e(a,n,r,t.height,0);i.push([s,u].join(","))}})),this.lineElem_.setAttributeNS(null,"points",i.join(" "));var a=this.tooltipElem_,o=this.value.rawValue[this.cursor_.index];if(void 0!==o){var s=$e(this.cursor_.index,0,e,0,t.width),u=$e(o,n,r,t.height,0);a.style.left="".concat(s,"px"),a.style.top="".concat(u,"px"),a.textContent="".concat(this.formatter_(o)),a.classList.contains(xi("t","a"))||(a.classList.add(xi("t","a"),xi("t","in")),q(a),a.classList.remove(xi("t","in")))}else a.classList.remove(xi("t","a"))}},{key:"onValueUpdate_",value:function(){this.update_()}},{key:"onCursorChange_",value:function(){this.update_()}}]),t}(),Ei=function(){function t(e,n){if(u(this,t),this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.cursor_=new yi,this.view=new Ci(e,{cursor:this.cursor_,formatter:n.formatter,lineCount:n.lineCount,maxValue:n.maxValue,minValue:n.minValue,value:this.value,viewProps:this.viewProps}),X(e)){var r=new Ye(this.view.element);r.emitter.on("down",this.onGraphPointerDown_),r.emitter.on("move",this.onGraphPointerMove_),r.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}return m(t,[{key:"onGraphMouseLeave_",value:function(){this.cursor_.index=-1}},{key:"onGraphMouseMove_",value:function(t){var e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor($e(t.offsetX,0,e.width,0,this.value.rawValue.length))}},{key:"onGraphPointerDown_",value:function(t){this.onGraphPointerMove_(t)}},{key:"onGraphPointerMove_",value:function(t){t.data.point?this.cursor_.index=Math.floor($e(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}},{key:"onGraphPointerUp_",value:function(){this.cursor_.index=-1}}]),t}();function ki(t){return"format"in t&&!l(t.format)?t.format:De(2)}function Pi(t){return"view"in t&&"graph"===t.view}var Ti={id:"monitor-number",type:"monitor",accept:function(t,e){if("number"!=typeof t)return null;var n=z,r=j(e,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return r?{initialValue:t,params:r}:null},binding:{defaultBufferSize:function(t){return Pi(t)?64:1},reader:function(t){return Ve}},controller:function(t){return Pi(t.params)?function(t){var e,n,r;return new Ei(t.document,{formatter:ki(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:pi.defaultLineCount,maxValue:null!==(n="max"in t.params?t.params.max:null)&&void 0!==n?n:100,minValue:null!==(r="min"in t.params?t.params.min:null)&&void 0!==r?r:0,value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new gi(t.document,{formatter:ki(t.params),value:t.value,viewProps:t.viewProps}):new mi(t.document,{formatter:ki(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:pi.defaultLineCount,value:t.value,viewProps:t.viewProps})}(t)}},Mi={id:"monitor-string",type:"monitor",accept:function(t,e){if("string"!=typeof t)return null;var n=z,r=j(e,{lineCount:n.optional.number,multiline:n.optional.boolean});return r?{initialValue:t,params:r}:null},binding:{reader:function(t){return Oe}},controller:function(t){var e,n=t.value;return n.rawValue.length>1||"multiline"in t.params&&t.params.multiline?new mi(t.document,{formatter:Ne,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:pi.defaultLineCount,value:n,viewProps:t.viewProps}):new gi(t.document,{formatter:Ne,value:n,viewProps:t.viewProps})}},Ai=function(){function t(e){u(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new _,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}return m(t,[{key:"read",value:function(){var t=this.target.read();void 0!==t&&(this.value.rawValue=this.reader(t))}},{key:"write_",value:function(t){this.writer(this.target,t)}},{key:"onValueChange_",value:function(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}]),t}();var Si=function(){function t(e){u(this,t),this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new _,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}return m(t,[{key:"dispose",value:function(){this.ticker.dispose()}},{key:"read",value:function(){var t=this.target.read();if(void 0!==t){var e=this.value.rawValue,n=this.reader_(t);this.value.rawValue=function(t,e){var n=k(function(t){var e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}(t)).concat([e]);return n.length>t.length?n.splice(0,n.length-t.length):ze(n,t.length),n}(e,n),this.emitter.emit("update",{rawValue:n,sender:this})}}},{key:"onTick_",value:function(t){this.read()}}]),t}();function Ri(t,e){return 0===e?new Zt:new Jt(t,null!=e?e:pi.defaultInterval)}var Fi=function(){function t(){u(this,t),this.pluginsMap_={blades:[],inputs:[],monitors:[]}}return m(t,[{key:"getAll",value:function(){return k(this.pluginsMap_.blades).concat(k(this.pluginsMap_.inputs),k(this.pluginsMap_.monitors))}},{key:"register",value:function(t){"blade"===t.type?this.pluginsMap_.blades.unshift(t):"input"===t.type?this.pluginsMap_.inputs.unshift(t):"monitor"===t.type&&this.pluginsMap_.monitors.unshift(t)}},{key:"createInput",value:function(t,e,n){if(l(e.read()))throw new d({context:{key:e.key},type:"nomatchingcontroller"});var r=this.pluginsMap_.inputs.reduce((function(r,i){return r||function(t,e){var n=t.accept(e.target.read(),e.params);if(l(n))return null;var r=z,i={target:e.target,initialValue:n.initialValue,params:n.params},a=t.binding.reader(i),o=t.binding.constraint?t.binding.constraint(i):void 0,s=U(a(n.initialValue),{constraint:o,equals:t.binding.equals}),u=new Ai({reader:a,target:e.target,value:s,writer:t.binding.writer(i)}),c=r.optional.boolean(e.params.disabled).value,h=r.optional.boolean(e.params.hidden).value,d=t.controller({constraint:o,document:e.document,initialValue:n.initialValue,params:n.params,value:u.value,viewProps:Nt.create({disabled:c,hidden:h})}),p=r.optional.string(e.params.label).value;return new vt(e.document,{binding:u,blade:st(),props:I.fromObject({label:p||e.target.key}),valueController:d})}(i,{document:t,target:e,params:n})}),null);if(r)return r;throw new d({context:{key:e.key},type:"nomatchingcontroller"})}},{key:"createMonitor",value:function(t,e,n){var r=this.pluginsMap_.monitors.reduce((function(r,i){return r||function(t,e){var n,r,i,a=z,o=t.accept(e.target.read(),e.params);if(l(o))return null;var s={target:e.target,initialValue:o.initialValue,params:o.params},u=t.binding.reader(s),c=null!==(r=null!==(n=a.optional.number(e.params.bufferSize).value)&&void 0!==n?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(o.params))&&void 0!==r?r:1,h=a.optional.number(e.params.interval).value,d=new Si({reader:u,target:e.target,ticker:Ri(e.document,h),value:je(c)}),p=a.optional.boolean(e.params.disabled).value,v=a.optional.boolean(e.params.hidden).value,f=t.controller({document:e.document,params:o.params,value:d.value,viewProps:Nt.create({disabled:p,hidden:v})}),m=null!==(i=a.optional.string(e.params.label).value)&&void 0!==i?i:e.target.key;return new mt(e.document,{binding:d,blade:st(),props:I.fromObject({label:m}),valueController:f})}(i,{document:t,params:n,target:e})}),null);if(r)return r;throw new d({context:{key:e.key},type:"nomatchingcontroller"})}},{key:"createBlade",value:function(t,e){var n=this.pluginsMap_.blades.reduce((function(n,r){return n||Qt(r,{document:t,params:e})}),null);if(!n)throw new d({type:"nomatchingview",context:{params:e}});return n}},{key:"createBladeApi",value:function(t){var e=this;if(t instanceof vt)return new pt(t);if(t instanceof mt)return new ft(t);if(t instanceof Tt)return new wt(t,this);var n=this.pluginsMap_.blades.reduce((function(n,r){return n||r.api({controller:t,pool:e})}),null);if(!n)throw d.shouldNeverHappen();return n}}]),t}();var Bi=function(t){x(n,t);var e=T(n);function n(t){var r;return u(this,n),(r=e.call(this,t)).emitter_=new _,r.controller_.valueController.value.emitter.on("change",(function(t){r.emitter_.emit("change",{event:new i(s(r),t.rawValue)})})),r}return m(n,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(t){this.controller_.props.set("label",t)}},{key:"options",get:function(){return this.controller_.valueController.props.get("options")},set:function(t){this.controller_.valueController.props.set("options",t)}},{key:"value",get:function(){return this.controller_.valueController.value.rawValue},set:function(t){this.controller_.valueController.value.rawValue=t}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}}]),n}(n),Vi=function(t){x(n,t);var e=T(n);function n(t){var r;return u(this,n),(r=e.call(this,t)).emitter_=new _,r.controller_.valueController.value.emitter.on("change",(function(t){r.emitter_.emit("change",{event:new i(s(r),t.rawValue)})})),r}return m(n,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(t){this.controller_.props.set("label",t)}},{key:"maxValue",get:function(){return this.controller_.valueController.sliderController.props.get("maxValue")},set:function(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}},{key:"minValue",get:function(){return this.controller_.valueController.sliderController.props.get("minValue")},set:function(t){this.controller_.valueController.sliderController.props.set("minValue",t)}},{key:"value",get:function(){return this.controller_.valueController.value.rawValue},set:function(t){this.controller_.valueController.value.rawValue=t}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}}]),n}(n),Li=function(t){x(n,t);var e=T(n);function n(t){var r;return u(this,n),(r=e.call(this,t)).emitter_=new _,r.controller_.valueController.value.emitter.on("change",(function(t){r.emitter_.emit("change",{event:new i(s(r),t.rawValue)})})),r}return m(n,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(t){this.controller_.props.set("label",t)}},{key:"formatter",get:function(){return this.controller_.valueController.props.get("formatter")},set:function(t){this.controller_.valueController.props.set("formatter",t)}},{key:"value",get:function(){return this.controller_.valueController.value.rawValue},set:function(t){this.controller_.valueController.value.rawValue=t}},{key:"on",value:function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this}}]),n}(n),Di={id:"list",type:"blade",accept:function(t){var e=z,n=j(t,{options:e.required.custom(hn),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return n?{params:n}:null},controller:function(t){var e=new se(t.document,{props:I.fromObject({options:vn(t.params.options)}),value:U(t.params.value),viewProps:t.viewProps});return new Ft(t.document,{blade:t.blade,props:I.fromObject({label:t.params.label}),valueController:e})},api:function(t){return t.controller instanceof Ft&&t.controller.valueController instanceof se?new Bi(t.controller):null}};var Ui=function(t){x(n,t);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,r)}return m(n,[{key:"element",get:function(){return this.controller_.view.element}},{key:"importPreset",value:function(t){!function(t,e){t.forEach((function(t){var n=e[t.presetKey];void 0!==n&&t.write(n)}))}(this.controller_.rackController.rack.find(vt).map((function(t){return t.binding.target})),t),this.refresh()}},{key:"exportPreset",value:function(){return function(t){return t.reduce((function(t,e){return Object.assign(t,b({},e.presetKey,e.read()))}),{})}(this.controller_.rackController.rack.find(vt).map((function(t){return t.binding.target})))}},{key:"refresh",value:function(){this.controller_.rackController.rack.find(vt).forEach((function(t){t.binding.read()})),this.controller_.rackController.rack.find(mt).forEach((function(t){t.binding.read()}))}}]),n}(yt),Ii=function(t){x(n,t);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,{expanded:r.expanded,blade:r.blade,props:r.props,root:!0,viewProps:r.viewProps})}return n}(St),Oi={id:"slider",type:"blade",accept:function(t){var e=z,n=j(t,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return n?{params:n}:null},controller:function(t){var e,n,r=null!==(e=t.params.value)&&void 0!==e?e:0,i=new ln(t.document,{baseStep:1,parser:Be,sliderProps:I.fromObject({maxValue:t.params.max,minValue:t.params.min}),textProps:I.fromObject({draggingScale:gn(void 0,r),formatter:null!==(n=t.params.format)&&void 0!==n?n:Le}),value:U(r),viewProps:t.viewProps});return new Ft(t.document,{blade:t.blade,props:I.fromObject({label:t.params.label}),valueController:i})},api:function(t){return t.controller instanceof Ft&&t.controller.valueController instanceof ln?new Vi(t.controller):null}},Ni={id:"text",type:"blade",accept:function(t){var e=z,n=j(t,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return n?{params:n}:null},controller:function(t){var e,n=new pe(t.document,{parser:t.params.parse,props:I.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:function(t){return String(t)}}),value:U(t.params.value),viewProps:t.viewProps});return new Ft(t.document,{blade:t.blade,props:I.fromObject({label:t.params.label}),valueController:n})},api:function(t){return t.controller instanceof Ft&&t.controller.valueController instanceof pe?new Li(t.controller):null}};function zi(t,e,n){if(!t.querySelector("style[data-tp-style=".concat(e,"]"))){var r=t.createElement("style");r.dataset.tpStyle=e,r.textContent=n,t.head.appendChild(r)}}var ji=function(t){x(n,t);var e=T(n);function n(t){var r,i;u(this,n);var a=t||{},o=null!==(i=a.document)&&void 0!==i?i:Y(),s=function(){var t=new Fi;return[Zr,ai,hi,di,Dr,Ar,Mr,Tr,Cn,wi,Mi,Ti,at,Rt,Ut,$t].forEach((function(e){t.register(e)})),t}(),l=new Ii(o,{expanded:a.expanded,blade:st(),props:I.fromObject({title:a.title}),viewProps:Nt.create()});return(r=e.call(this,l,s)).pool_=s,r.containerElem_=a.container||function(t){var e=t.createElement("div");return e.classList.add(C("dfw")()),t.body&&t.body.appendChild(e),e}(o),r.containerElem_.appendChild(r.element),r.doc_=o,r.usesDefaultWrapper_=!a.container,r.setUpDefaultPlugins_(),r}return m(n,[{key:"document",get:function(){if(!this.doc_)throw d.alreadyDisposed();return this.doc_}},{key:"dispose",value:function(){var t,e,r,i=this.containerElem_;if(!i)throw d.alreadyDisposed();if(this.usesDefaultWrapper_){var a=i.parentElement;a&&a.removeChild(i)}this.containerElem_=null,this.doc_=null,(t=g(n.prototype),e="dispose",r=this,w(t,e,r)).call(this)}},{key:"registerPlugin",value:function(t){var e=this;("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((function(t){e.pool_.register(t),e.embedPluginStyle_(t)}))}},{key:"embedPluginStyle_",value:function(t){t.css&&zi(this.document,"plugin-".concat(t.id),t.css)}},{key:"setUpDefaultPlugins_",value:function(){var t=this;zi(this.document,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187,188,196,0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187,188,196,0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187,188,196,0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187,188,196,0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:'';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}"),this.pool_.getAll().forEach((function(e){t.embedPluginStyle_(e)})),this.registerPlugin({plugins:[Oi,Di,$t,Ni]})}}]),n}(Ui),Hi=new e("3.0.7");t.BladeApi=n,t.ButtonApi=f,t.FolderApi=yt,t.InputBindingApi=pt,t.ListApi=Bi,t.MonitorBindingApi=ft,t.Pane=ji,t.SeparatorApi=Bt,t.SliderApi=Vi,t.TabApi=Wt,t.TabPageApi=Gt,t.TextApi=Li,t.TpChangeEvent=i,t.VERSION=Hi,Object.defineProperty(t,"__esModule",{value:!0})}));
/* @license twgl.js 4.21.2 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */
var M=Float32Array;function A(t,e,n){var r=new M(3);return t&&(r[0]=t),e&&(r[1]=e),n&&(r[2]=n),r}function S(t,e,n){return(n=n||new M(3))[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function R(t,e,n){return(n=n||new M(3))[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function F(t,e,n){n=n||new M(3);var r=t[2]*e[0]-t[0]*e[2],i=t[0]*e[1]-t[1]*e[0];return n[0]=t[1]*e[2]-t[2]*e[1],n[1]=r,n[2]=i,n}function B(t,e){e=e||new M(3);var n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=Math.sqrt(n);return r>1e-5?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=0,e[1]=0,e[2]=0),e}function V(t,e,n){return(n=n||new M(3))[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}var L,D,U,I=Float32Array;function O(t,e){return(e=e||new I(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function N(t){return(t=t||new I(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function z(t,e){e=e||new I(16);var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],p=t[11],v=t[12],f=t[13],m=t[14],b=t[15],_=d*b,g=m*p,w=u*b,y=m*l,x=u*p,C=d*l,E=i*b,k=m*a,P=i*p,T=d*a,M=i*l,A=u*a,S=c*f,R=v*h,F=o*f,B=v*s,V=o*h,L=c*s,D=n*f,U=v*r,O=n*h,N=c*r,z=n*s,j=o*r,H=_*s+y*h+x*f-(g*s+w*h+C*f),K=g*r+E*h+T*f-(_*r+k*h+P*f),G=w*r+k*s+M*f-(y*r+E*s+A*f),W=C*r+P*s+A*h-(x*r+T*s+M*h),q=1/(n*H+o*K+c*G+v*W);return e[0]=q*H,e[1]=q*K,e[2]=q*G,e[3]=q*W,e[4]=q*(g*o+w*c+C*v-(_*o+y*c+x*v)),e[5]=q*(_*n+k*c+P*v-(g*n+E*c+T*v)),e[6]=q*(y*n+E*o+A*v-(w*n+k*o+M*v)),e[7]=q*(x*n+T*o+M*c-(C*n+P*o+A*c)),e[8]=q*(S*l+B*p+V*b-(R*l+F*p+L*b)),e[9]=q*(R*a+D*p+N*b-(S*a+U*p+O*b)),e[10]=q*(F*a+U*l+z*b-(B*a+D*l+j*b)),e[11]=q*(L*a+O*l+j*p-(V*a+N*l+z*p)),e[12]=q*(F*d+L*m+R*u-(V*m+S*u+B*d)),e[13]=q*(O*m+S*i+U*d-(D*d+N*m+R*i)),e[14]=q*(D*u+j*m+B*i-(z*m+F*i+U*u)),e[15]=q*(z*d+V*i+N*u-(O*u+j*d+L*i)),e}function j(t,e,n){n=n||A();var r=e[0],i=e[1],a=e[2],o=r*t[3]+i*t[7]+a*t[11]+t[15];return n[0]=(r*t[0]+i*t[4]+a*t[8]+t[12])/o,n[1]=(r*t[1]+i*t[5]+a*t[9]+t[13])/o,n[2]=(r*t[2]+i*t[6]+a*t[10]+t[14])/o,n}function H(t,e,n){n=n||A();var r=e[0],i=e[1],a=e[2];return n[0]=r*t[0]+i*t[4]+a*t[8],n[1]=r*t[1]+i*t[5]+a*t[9],n[2]=r*t[2]+i*t[6]+a*t[10],n}var K=Object.freeze({__proto__:null,axisRotate:function(t,e,n,r){r=r||new I(16);var i=e[0],a=e[1],o=e[2],s=Math.sqrt(i*i+a*a+o*o),u=(i/=s)*i,l=(a/=s)*a,c=(o/=s)*o,h=Math.cos(n),d=Math.sin(n),p=1-h,v=u+(1-u)*h,f=i*a*p+o*d,m=i*o*p-a*d,b=i*a*p-o*d,_=l+(1-l)*h,g=a*o*p+i*d,w=i*o*p+a*d,y=a*o*p-i*d,x=c+(1-c)*h,C=t[0],E=t[1],k=t[2],P=t[3],T=t[4],M=t[5],A=t[6],S=t[7],R=t[8],F=t[9],B=t[10],V=t[11];return r[0]=v*C+f*T+m*R,r[1]=v*E+f*M+m*F,r[2]=v*k+f*A+m*B,r[3]=v*P+f*S+m*V,r[4]=b*C+_*T+g*R,r[5]=b*E+_*M+g*F,r[6]=b*k+_*A+g*B,r[7]=b*P+_*S+g*V,r[8]=w*C+y*T+x*R,r[9]=w*E+y*M+x*F,r[10]=w*k+y*A+x*B,r[11]=w*P+y*S+x*V,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},axisRotation:function(t,e,n){n=n||new I(16);var r=t[0],i=t[1],a=t[2],o=Math.sqrt(r*r+i*i+a*a),s=(r/=o)*r,u=(i/=o)*i,l=(a/=o)*a,c=Math.cos(e),h=Math.sin(e),d=1-c;return n[0]=s+(1-s)*c,n[1]=r*i*d+a*h,n[2]=r*a*d-i*h,n[3]=0,n[4]=r*i*d-a*h,n[5]=u+(1-u)*c,n[6]=i*a*d+r*h,n[7]=0,n[8]=r*a*d+i*h,n[9]=i*a*d-r*h,n[10]=l+(1-l)*c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},copy:O,frustum:function(t,e,n,r,i,a,o){var s=e-t,u=r-n,l=i-a;return(o=o||new I(16))[0]=2*i/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*i/u,o[6]=0,o[7]=0,o[8]=(t+e)/s,o[9]=(r+n)/u,o[10]=a/l,o[11]=-1,o[12]=0,o[13]=0,o[14]=i*a/l,o[15]=0,o},getAxis:function(t,e,n){var r=4*e;return(n=n||A())[0]=t[r+0],n[1]=t[r+1],n[2]=t[r+2],n},getTranslation:function(t,e){return(e=e||A())[0]=t[12],e[1]=t[13],e[2]=t[14],e},identity:N,inverse:z,lookAt:function(t,e,n,r){return r=r||new I(16),L=L||A(),D=D||A(),B(R(t,e,U=U||A()),U),B(F(n,U,L),L),B(F(U,L,D),D),r[0]=L[0],r[1]=L[1],r[2]=L[2],r[3]=0,r[4]=D[0],r[5]=D[1],r[6]=D[2],r[7]=0,r[8]=U[0],r[9]=U[1],r[10]=U[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},multiply:function(t,e,n){n=n||new I(16);var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],p=t[10],v=t[11],f=t[12],m=t[13],b=t[14],_=t[15],g=e[0],w=e[1],y=e[2],x=e[3],C=e[4],E=e[5],k=e[6],P=e[7],T=e[8],M=e[9],A=e[10],S=e[11],R=e[12],F=e[13],B=e[14],V=e[15];return n[0]=r*g+s*w+h*y+f*x,n[1]=i*g+u*w+d*y+m*x,n[2]=a*g+l*w+p*y+b*x,n[3]=o*g+c*w+v*y+_*x,n[4]=r*C+s*E+h*k+f*P,n[5]=i*C+u*E+d*k+m*P,n[6]=a*C+l*E+p*k+b*P,n[7]=o*C+c*E+v*k+_*P,n[8]=r*T+s*M+h*A+f*S,n[9]=i*T+u*M+d*A+m*S,n[10]=a*T+l*M+p*A+b*S,n[11]=o*T+c*M+v*A+_*S,n[12]=r*R+s*F+h*B+f*V,n[13]=i*R+u*F+d*B+m*V,n[14]=a*R+l*F+p*B+b*V,n[15]=o*R+c*F+v*B+_*V,n},negate:function(t,e){return(e=e||new I(16))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},ortho:function(t,e,n,r,i,a,o){return(o=o||new I(16))[0]=2/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(r-n),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2/(i-a),o[11]=0,o[12]=(e+t)/(t-e),o[13]=(r+n)/(n-r),o[14]=(a+i)/(i-a),o[15]=1,o},perspective:function(t,e,n,r,i){i=i||new I(16);var a=Math.tan(.5*Math.PI-.5*t),o=1/(n-r);return i[0]=a/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(n+r)*o,i[11]=-1,i[12]=0,i[13]=0,i[14]=n*r*o*2,i[15]=0,i},rotateX:function(t,e,n){n=n||new I(16);var r=t[4],i=t[5],a=t[6],o=t[7],s=t[8],u=t[9],l=t[10],c=t[11],h=Math.cos(e),d=Math.sin(e);return n[4]=h*r+d*s,n[5]=h*i+d*u,n[6]=h*a+d*l,n[7]=h*o+d*c,n[8]=h*s-d*r,n[9]=h*u-d*i,n[10]=h*l-d*a,n[11]=h*c-d*o,t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateY:function(t,e,n){n=n||new I(16);var r=t[0],i=t[1],a=t[2],o=t[3],s=t[8],u=t[9],l=t[10],c=t[11],h=Math.cos(e),d=Math.sin(e);return n[0]=h*r-d*s,n[1]=h*i-d*u,n[2]=h*a-d*l,n[3]=h*o-d*c,n[8]=h*s+d*r,n[9]=h*u+d*i,n[10]=h*l+d*a,n[11]=h*c+d*o,t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateZ:function(t,e,n){n=n||new I(16);var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=Math.cos(e),d=Math.sin(e);return n[0]=h*r+d*s,n[1]=h*i+d*u,n[2]=h*a+d*l,n[3]=h*o+d*c,n[4]=h*s-d*r,n[5]=h*u-d*i,n[6]=h*l-d*a,n[7]=h*c-d*o,t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotationX:function(t,e){e=e||new I(16);var n=Math.cos(t),r=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationY:function(t,e){e=e||new I(16);var n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationZ:function(t,e){e=e||new I(16);var n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},scale:function(t,e,n){n=n||new I(16);var r=e[0],i=e[1],a=e[2];return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=r*t[3],n[4]=i*t[4],n[5]=i*t[5],n[6]=i*t[6],n[7]=i*t[7],n[8]=a*t[8],n[9]=a*t[9],n[10]=a*t[10],n[11]=a*t[11],t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},scaling:function(t,e){return(e=e||new I(16))[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},setAxis:function(t,e,n,r){r!==t&&(r=O(t,r));var i=4*n;return r[i+0]=e[0],r[i+1]=e[1],r[i+2]=e[2],r},setDefaultType:function(t){var e=I;return I=t,e},setTranslation:function(t,e,n){return t!==(n=n||N())&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11]),n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},transformDirection:H,transformNormal:function(t,e,n){n=n||A();var r=z(t),i=e[0],a=e[1],o=e[2];return n[0]=i*r[0]+a*r[1]+o*r[2],n[1]=i*r[4]+a*r[5]+o*r[6],n[2]=i*r[8]+a*r[9]+o*r[10],n},transformPoint:j,translate:function(t,e,n){n=n||new I(16);var r=e[0],i=e[1],a=e[2],o=t[0],s=t[1],u=t[2],l=t[3],c=t[4],h=t[5],d=t[6],p=t[7],v=t[8],f=t[9],m=t[10],b=t[11],_=t[12],g=t[13],w=t[14],y=t[15];return t!==n&&(n[0]=o,n[1]=s,n[2]=u,n[3]=l,n[4]=c,n[5]=h,n[6]=d,n[7]=p,n[8]=v,n[9]=f,n[10]=m,n[11]=b),n[12]=o*r+c*i+v*a+_,n[13]=s*r+h*i+f*a+g,n[14]=u*r+d*i+m*a+w,n[15]=l*r+p*i+b*a+y,n},translation:function(t,e){return(e=e||new I(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},transpose:function(t,e){var n;if((e=e||new I(16))===t)return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,e;var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],p=t[10],v=t[11],f=t[12],m=t[13],b=t[14],_=t[15];return e[0]=r,e[1]=s,e[2]=h,e[3]=f,e[4]=i,e[5]=u,e[6]=d,e[7]=m,e[8]=a,e[9]=l,e[10]=p,e[11]=b,e[12]=o,e[13]=c,e[14]=v,e[15]=_,e}}),G=5120,W=5121,q=5122,X=5123,Y=5124,$=5125,Q=5126,Z={},J=Z;function tt(t){if(t instanceof Int8Array)return G;if(t instanceof Uint8Array)return W;if(t instanceof Uint8ClampedArray)return W;if(t instanceof Int16Array)return q;if(t instanceof Uint16Array)return X;if(t instanceof Int32Array)return Y;if(t instanceof Uint32Array)return $;if(t instanceof Float32Array)return Q;throw new Error("unsupported typed array type")}function et(t){if(t===Int8Array)return G;if(t===Uint8Array)return W;if(t===Uint8ClampedArray)return W;if(t===Int16Array)return q;if(t===Uint16Array)return X;if(t===Int32Array)return Y;if(t===Uint32Array)return $;if(t===Float32Array)return Q;throw new Error("unsupported typed array type")}J[5120]=Int8Array,J[5121]=Uint8Array,J[5122]=Int16Array,J[5123]=Uint16Array,J[5124]=Int32Array,J[5125]=Uint32Array,J[5126]=Float32Array,J[32819]=Uint16Array,J[32820]=Uint16Array,J[33635]=Uint16Array,J[5131]=Uint16Array,J[33640]=Uint32Array,J[35899]=Uint32Array,J[35902]=Uint32Array,J[36269]=Uint32Array,J[34042]=Uint32Array;var nt="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function rt(t,e){return"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture}var it=34962,at={attribPrefix:""};function ot(t,e,n,r,i){t.bindBuffer(e,n),t.bufferData(e,r,i||35044)}function st(t,e,n,r){if(i=e,"undefined"!=typeof WebGLBuffer&&i instanceof WebGLBuffer)return e;var i;n=n||it;var a=t.createBuffer();return ot(t,n,a,e,r),a}function ut(t){return"indices"===t}function lt(t){return t.length?t:t.data}var ct=/coord|texture/i,ht=/color|colour/i;function dt(t,e){var n;if(e%(n=ct.test(t)?2:ht.test(t)?4:3)>0)throw new Error("Can not guess numComponents for attribute '".concat(t,"'. Tried ").concat(n," but ").concat(e," values is not evenly divisible by ").concat(n,". You should specify it."));return n}function pt(t,e){return t.numComponents||t.size||dt(e,lt(t).length)}function vt(t,e){if(nt(t))return t;if(nt(t.data))return t.data;Array.isArray(t)&&(t={data:t});var n=t.type;return n||(n=ut(e)?Uint16Array:Float32Array),new n(t.data)}function ft(t,e){var n={};return Object.keys(e).forEach((function(r){if(!ut(r)){var i=e[r],a=i.attrib||i.name||i.attribName||at.attribPrefix+r;if(i.value){if(!Array.isArray(i.value)&&!nt(i.value))throw new Error("array.value is not array or typedarray");n[a]={value:i.value}}else{var o,s,u,l;if(i.buffer&&i.buffer instanceof WebGLBuffer)o=i.buffer,l=i.numComponents||i.size,s=i.type,u=i.normalize;else if("number"==typeof i||"number"==typeof i.data){var c=i.data||i,h=i.type||Float32Array,d=c*h.BYTES_PER_ELEMENT;s=et(h),u=void 0!==i.normalize?i.normalize:(v=h)===Int8Array||v===Uint8Array,l=i.numComponents||i.size||dt(r,c),o=t.createBuffer(),t.bindBuffer(it,o),t.bufferData(it,d,i.drawType||35044)}else{var p=vt(i,r);o=st(t,p,void 0,i.drawType),s=tt(p),u=void 0!==i.normalize?i.normalize:function(t){return t instanceof Int8Array||t instanceof Uint8Array}(p),l=pt(i,r)}n[a]={buffer:o,numComponents:l,type:s,normalize:u,stride:i.stride||0,offset:i.offset||0,divisor:void 0===i.divisor?void 0:i.divisor,drawType:i.drawType}}}var v})),t.bindBuffer(it,null),n}var mt=["position","positions","a_position"];function bt(t,e,n){var r=ft(t,e),i=Object.assign({},n||{});i.attribs=Object.assign({},n?n.attribs:{},r);var a=e.indices;if(a){var o=vt(a,"indices");i.indices=st(t,o,34963),i.numElements=o.length,i.elementType=tt(o)}else i.numElements||(i.numElements=function(t,e){var n,r;for(r=0;r<mt.length&&!((n=mt[r])in e)&&!((n=at.attribPrefix+n)in e);++r);r===mt.length&&(n=Object.keys(e)[0]);var i=e[n];t.bindBuffer(it,i.buffer);var a=t.getBufferParameter(it,34660);t.bindBuffer(it,null);var o,s=a/(5120===(o=i.type)||5121===o?1:5122===o||5123===o?2:5124===o||5125===o||5126===o?4:0),u=i.numComponents||i.size,l=s/u;if(l%1!=0)throw new Error("numComponents ".concat(u," not correct for length ").concat(length));return l}(t,i.attribs));return i}function _t(t,e,n){var r="indices"===n?34963:it;return st(t,vt(e,n),r)}function gt(t,e){var n={};return Object.keys(e).forEach((function(r){n[r]=_t(t,e[r],r)})),e.indices?(n.numElements=e.indices.length,n.elementType=tt(vt(e.indices))):n.numElements=function(t){var e,n;for(n=0;n<mt.length&&!((e=mt[n])in t);++n);n===mt.length&&(e=Object.keys(t)[0]);var r=t[e],i=lt(r).length,a=pt(r,e),o=i/a;if(i%a>0)throw new Error("numComponents ".concat(a," not correct for length ").concat(i));return o}(e),n}var wt=lt,yt=pt;function xt(t,e){var n=0;return t.push=function(){for(var e=0;e<arguments.length;++e){var r=arguments[e];if(r instanceof Array||nt(r))for(var i=0;i<r.length;++i)t[n++]=r[i];else t[n++]=r}},t.reset=function(t){n=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}function Ct(t,e,n){return xt(new(n||Float32Array)(t*e),t)}function Et(t){return"indices"!==t}function kt(t,e,n){for(var r=t.length,i=new Float32Array(3),a=0;a<r;a+=3)n(e,[t[a],t[a+1],t[a+2]],i),t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2]}function Pt(t,e,n){n=n||A();var r=e[0],i=e[1],a=e[2];return n[0]=r*t[0]+i*t[1]+a*t[2],n[1]=r*t[4]+i*t[5]+a*t[6],n[2]=r*t[8]+i*t[9]+a*t[10],n}function Tt(t,e){return kt(t,e,H),t}function Mt(t,e){return kt(t,z(e),Pt),t}function At(t,e){return kt(t,e,j),t}function St(t,e){return Object.keys(t).forEach((function(n){var r=t[n];n.indexOf("pos")>=0?At(r,e):n.indexOf("tan")>=0||n.indexOf("binorm")>=0?Tt(r,e):n.indexOf("norm")>=0&&Mt(r,e)})),t}function Rt(t,e,n){return t=t||2,{position:{numComponents:2,data:[(e=e||0)+-1*(t*=.5),(n=n||0)+-1*t,e+1*t,n+-1*t,e+-1*t,n+1*t,e+1*t,n+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function Ft(t,e,n,r,i){t=t||1,e=e||1,n=n||1,r=r||1,i=i||N();for(var a=(n+1)*(r+1),o=Ct(3,a),s=Ct(3,a),u=Ct(2,a),l=0;l<=r;l++)for(var c=0;c<=n;c++){var h=c/n,d=l/r;o.push(t*h-.5*t,0,e*d-.5*e),s.push(0,1,0),u.push(h,d)}for(var p=n+1,v=Ct(3,n*r*2,Uint16Array),f=0;f<r;f++)for(var m=0;m<n;m++)v.push((f+0)*p+m,(f+1)*p+m,(f+0)*p+m+1),v.push((f+1)*p+m,(f+1)*p+m+1,(f+0)*p+m+1);return St({position:o,normal:s,texcoord:u,indices:v},i)}function Bt(t,e,n,r,i,a,o){if(e<=0||n<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");r=r||0,a=a||0;for(var s=(i=i||Math.PI)-r,u=(o=o||2*Math.PI)-a,l=(e+1)*(n+1),c=Ct(3,l),h=Ct(3,l),d=Ct(2,l),p=0;p<=n;p++)for(var v=0;v<=e;v++){var f=v/e,m=p/n,b=u*f+a,_=s*m+r,g=Math.sin(b),w=Math.cos(b),y=Math.sin(_),x=w*y,C=Math.cos(_),E=g*y;c.push(t*x,t*C,t*E),h.push(x,C,E),d.push(1-f,m)}for(var k=e+1,P=Ct(3,e*n*2,Uint16Array),T=0;T<e;T++)for(var M=0;M<n;M++)P.push((M+0)*k+T,(M+0)*k+T+1,(M+1)*k+T),P.push((M+1)*k+T,(M+0)*k+T+1,(M+1)*k+T+1);return{position:c,normal:h,texcoord:d,indices:P}}var Vt=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function Lt(t){for(var e=(t=t||1)/2,n=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],a=Ct(3,24),o=Ct(3,24),s=Ct(2,24),u=Ct(3,12,Uint16Array),l=0;l<6;++l){for(var c=Vt[l],h=0;h<4;++h){var d=n[c[h]],p=r[l],v=i[h];a.push(d),o.push(p),s.push(v)}var f=4*l;u.push(f+0,f+1,f+2),u.push(f+0,f+2,f+3)}return{position:a,normal:o,texcoord:s,indices:u}}function Dt(t,e,n,r,i,a,o){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(i<1)throw new Error("verticalSubdivisions must be 1 or greater");for(var s=void 0===a||a,u=void 0===o||o,l=(s?2:0)+(u?2:0),c=(r+1)*(i+1+l),h=Ct(3,c),d=Ct(3,c),p=Ct(2,c),v=Ct(3,r*(i+l/2)*2,Uint16Array),f=r+1,m=Math.atan2(t-e,n),b=Math.cos(m),_=Math.sin(m),g=i+(u?2:0),w=s?-2:0;w<=g;++w){var y=w/i,x=n*y,C=void 0;w<0?(x=0,y=1,C=t):w>i?(x=n,y=1,C=e):C=t+w/i*(e-t),-2!==w&&w!==i+2||(C=0,y=0),x-=n/2;for(var E=0;E<f;++E){var k=Math.sin(E*Math.PI*2/r),P=Math.cos(E*Math.PI*2/r);h.push(k*C,x,P*C),w<0?d.push(0,-1,0):w>i?d.push(0,1,0):0===C?d.push(0,0,0):d.push(k*b,_,P*b),p.push(E/r,1-y)}}for(var T=0;T<i+l;++T)if(!(1===T&&s||T===i+l-2&&u))for(var M=0;M<r;++M)v.push(f*(T+0)+0+M,f*(T+0)+1+M,f*(T+1)+1+M),v.push(f*(T+0)+0+M,f*(T+1)+1+M,f*(T+1)+0+M);return{position:h,normal:d,texcoord:p,indices:v}}function Ut(t,e){e=e||[];for(var n=[],r=0;r<t.length;r+=4){var i=t[r],a=t.slice(r+1,r+4);a.push.apply(a,e);for(var o=0;o<i;++o)n.push.apply(n,a)}return n}function It(){var t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=Ut([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=Ut([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),r=t.length/3,i={position:Ct(3,r),texcoord:Ct(2,r),normal:Ct(3,r),color:Ct(4,r,Uint8Array),indices:Ct(3,r/3,Uint16Array)};i.position.push(t),i.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),i.normal.push(e),i.color.push(n);for(var a=0;a<r;++a)i.indices.push(a);return i}function Ot(t,e,n,r,i,a,o){if(i<=0)throw new Error("subdivisionDown must be > 0");var s=(o=o||1)-(a=a||0),u=2*(i+1)*4,l=Ct(3,u),c=Ct(3,u),h=Ct(2,u);function d(t,e,n){return t+(e-t)*n}function p(e,n,o,u,p,v){for(var f=0;f<=i;f++){var m=n/1,b=f/i,_=2*(m-.5),g=(a+b*s)*Math.PI,w=Math.sin(g),y=Math.cos(g),x=d(t,e,w),C=_*r,E=y*t,k=w*x;l.push(C,E,k);var P=S(V([0,w,y],o),u);c.push(P),h.push(m*p+v,b)}}for(var v=0;v<2;v++){var f=2*(v/1-.5);p(e,v,[1,1,1],[0,0,0],1,0),p(e,v,[0,0,0],[f,0,0],0,0),p(n,v,[1,1,1],[0,0,0],1,0),p(n,v,[0,0,0],[f,0,0],0,1)}var m=Ct(3,2*i*4,Uint16Array);function b(t,e){for(var n=0;n<i;++n)m.push(t+n+0,t+n+1,e+n+0),m.push(t+n+1,e+n+1,e+n+0)}var _=i+1;return b(0*_,4*_),b(5*_,7*_),b(6*_,2*_),b(3*_,1*_),{position:l,normal:c,texcoord:h,indices:m}}function Nt(t,e,n,r,i,a){return Dt(t,t,e,n,r,i,a)}function zt(t,e,n,r,i,a){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<3)throw new Error("verticalSubdivisions must be 3 or greater");i=i||0;for(var o=(a=a||2*Math.PI)-i,s=n+1,u=r+1,l=s*u,c=Ct(3,l),h=Ct(3,l),d=Ct(2,l),p=Ct(3,n*r*2,Uint16Array),v=0;v<u;++v)for(var f=v/r,m=f*Math.PI*2,b=Math.sin(m),_=t+b*e,g=Math.cos(m),w=g*e,y=0;y<s;++y){var x=y/n,C=i+x*o,E=Math.sin(C),k=Math.cos(C),P=E*_,T=k*_,M=E*b,A=k*b;c.push(P,w,T),h.push(M,g,A),d.push(x,1-f)}for(var S=0;S<r;++S)for(var R=0;R<n;++R){var F=1+R,B=1+S;p.push(s*S+R,s*B+R,s*S+F),p.push(s*B+R,s*B+F,s*S+F)}return{position:c,normal:h,texcoord:d,indices:p}}function jt(t,e,n,r,i){if(e<3)throw new Error("divisions must be at least 3");i=i||1,r=r||0;for(var a=(e+1)*((n=n||1)+1),o=Ct(3,a),s=Ct(3,a),u=Ct(2,a),l=Ct(3,n*e*2,Uint16Array),c=0,h=t-r,d=e+1,p=0;p<=n;++p){for(var v=r+h*Math.pow(p/n,i),f=0;f<=e;++f){var m=2*Math.PI*f/e,b=v*Math.cos(m),_=v*Math.sin(m);if(o.push(b,0,_),s.push(0,1,0),u.push(1-f/e,p/n),p>0&&f!==e){var g=c+(f+1),w=c+f,y=c+f-d,x=c+(f+1)-d;l.push(g,w,y),l.push(g,y,x)}}c+=e+1}return{position:o,normal:s,texcoord:u,indices:l}}function Ht(t){return function(e){var n=t.apply(this,Array.prototype.slice.call(arguments,1));return gt(e,n)}}function Kt(t){return function(e){var n=t.apply(null,Array.prototype.slice.call(arguments,1));return bt(e,n)}}var Gt=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function Wt(t,e,n,r){r=r||0;for(var i=t.length,a=0;a<i;++a)e[n+a]=t[a]+r}function qt(t,e){var n,r,i=wt(t),a=new i.constructor(e),o=a;return i.numComponents&&i.numElements&&xt(a,i.numComponents),t.data&&(n=t,r=o={data:a},Gt.forEach((function(t){var e=n[t];void 0!==e&&(r[t]=e)}))),o}var Xt=Kt(It),Yt=Ht(It),$t=Kt(Lt),Qt=Ht(Lt),Zt=Kt(Ft),Jt=Ht(Ft),te=Kt(Bt),ee=Ht(Bt),ne=Kt(Dt),re=Ht(Dt),ie=Kt(Rt),ae=Ht(Rt),oe=Kt(Ot),se=Ht(Ot),ue=Kt(Nt),le=Ht(Nt),ce=Kt(zt),he=Ht(zt),de=Kt(jt),pe=Ht(jt),ve=oe,fe=se,me=Ot,be=Object.freeze({__proto__:null,create3DFBufferInfo:Xt,create3DFBuffers:Yt,create3DFVertices:It,createAugmentedTypedArray:Ct,createCubeBufferInfo:$t,createCubeBuffers:Qt,createCubeVertices:Lt,createPlaneBufferInfo:Zt,createPlaneBuffers:Jt,createPlaneVertices:Ft,createSphereBufferInfo:te,createSphereBuffers:ee,createSphereVertices:Bt,createTruncatedConeBufferInfo:ne,createTruncatedConeBuffers:re,createTruncatedConeVertices:Dt,createXYQuadBufferInfo:ie,createXYQuadBuffers:ae,createXYQuadVertices:Rt,createCresentBufferInfo:ve,createCresentBuffers:fe,createCresentVertices:me,createCrescentBufferInfo:oe,createCrescentBuffers:se,createCrescentVertices:Ot,createCylinderBufferInfo:ue,createCylinderBuffers:le,createCylinderVertices:Nt,createTorusBufferInfo:ce,createTorusBuffers:he,createTorusVertices:zt,createDiscBufferInfo:de,createDiscBuffers:pe,createDiscVertices:jt,deindexVertices:function(t){var e=t.indices,n={},r=e.length;return Object.keys(t).filter(Et).forEach((function(i){for(var a=t[i],o=a.numComponents,s=Ct(o,r,a.constructor),u=0;u<r;++u)for(var l=e[u]*o,c=0;c<o;++c)s.push(a[l+c]);n[i]=s})),n},flattenNormals:function(t){if(t.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");for(var e=t.normal,n=e.length,r=0;r<n;r+=9){var i=e[r+0],a=e[r+1],o=e[r+2],s=e[r+3],u=e[r+4],l=e[r+5],c=i+s+e[r+6],h=a+u+e[r+7],d=o+l+e[r+8],p=Math.sqrt(c*c+h*h+d*d);c/=p,h/=p,d/=p,e[r+0]=c,e[r+1]=h,e[r+2]=d,e[r+3]=c,e[r+4]=h,e[r+5]=d,e[r+6]=c,e[r+7]=h,e[r+8]=d}return t},makeRandomVertexColors:function(t,e){e=e||{};var n=t.position.numElements,r=Ct(4,n,Uint8Array),i=e.rand||function(t,e){return e<3?(n=256,Math.random()*n|0):255;var n};if(t.color=r,t.indices)for(var a=0;a<n;++a)r.push(i(a,0),i(a,1),i(a,2),i(a,3));else for(var o=e.vertsPerColor||3,s=n/o,u=0;u<s;++u)for(var l=[i(u,0),i(u,1),i(u,2),i(u,3)],c=0;c<o;++c)r.push(l);return t},reorientDirections:Tt,reorientNormals:Mt,reorientPositions:At,reorientVertices:St,concatVertices:function(t){for(var e,n=function(n){var i=t[n];Object.keys(i).forEach((function(t){r[t]||(r[t]=[]),e||"indices"===t||(e=t);var n=i[t],a=yt(n,t),o=wt(n).length/a;r[t].push(o)}))},r={},i=0;i<t.length;++i)n(i);var a=r[e],o={};return Object.keys(r).forEach((function(e){var n=function(e){for(var n,r=0,i=0;i<t.length;++i){var a=t[i][e];r+=wt(a).length,n&&!a.data||(n=a)}return{length:r,spec:n}}(e),r=qt(n.spec,n.length);!function(e,n,r){for(var i=0,a=0,o=0;o<t.length;++o){var s=t[o][e],u=wt(s);"indices"===e?(Wt(u,r,a,i),i+=n[o]):Wt(u,r,a),a+=u.length}}(e,a,wt(r)),o[e]=r})),o},duplicateVertices:function(t){var e={};return Object.keys(t).forEach((function(n){var r=t[n],i=wt(r),a=qt(r,i.length);Wt(i,wt(a),0),e[n]=a})),e}});function _e(t){return!!t.texStorage2D}ge={},we={},new Uint8Array([128,192,255,255]);var ge,we,ye={},xe=ye;xe[6406]={numColorComponents:1},xe[6409]={numColorComponents:1},xe[6410]={numColorComponents:2},xe[6407]={numColorComponents:3},xe[6408]={numColorComponents:4},xe[6403]={numColorComponents:1},xe[36244]={numColorComponents:1},xe[33319]={numColorComponents:2},xe[33320]={numColorComponents:2},xe[6407]={numColorComponents:3},xe[36248]={numColorComponents:3},xe[6408]={numColorComponents:4},xe[36249]={numColorComponents:4},xe[6402]={numColorComponents:1},xe[34041]={numColorComponents:2};var Ce=33984,Ee=34962,ke=5126,Pe=5124,Te=5125,Me=3553,Ae=34067,Se=32879,Re=35866,Fe={};function Be(t,e){return Fe[e].bindPoint}function Ve(t,e){return function(n){t.uniform1i(e,n)}}function Le(t,e){return function(n){t.uniform1iv(e,n)}}function De(t,e){return function(n){t.uniform2iv(e,n)}}function Ue(t,e){return function(n){t.uniform3iv(e,n)}}function Ie(t,e){return function(n){t.uniform4iv(e,n)}}function Oe(t,e,n,r){var i=Be(0,e);return _e(t)?function(e){var a,o;rt(0,e)?(a=e,o=null):(a=e.texture,o=e.sampler),t.uniform1i(r,n),t.activeTexture(Ce+n),t.bindTexture(i,a),t.bindSampler(n,o)}:function(e){t.uniform1i(r,n),t.activeTexture(Ce+n),t.bindTexture(i,e)}}function Ne(t,e,n,r,i){for(var a=Be(0,e),o=new Int32Array(i),s=0;s<i;++s)o[s]=n+s;return _e(t)?function(e){t.uniform1iv(r,o),e.forEach((function(e,r){var i,s;t.activeTexture(Ce+o[r]),rt(0,e)?(i=e,s=null):(i=e.texture,s=e.sampler),t.bindSampler(n,s),t.bindTexture(a,i)}))}:function(e){t.uniform1iv(r,o),e.forEach((function(e,n){t.activeTexture(Ce+o[n]),t.bindTexture(a,e)}))}}function ze(t,e){return function(n){if(n.value)switch(t.disableVertexAttribArray(e),n.value.length){case 4:t.vertexAttrib4fv(e,n.value);break;case 3:t.vertexAttrib3fv(e,n.value);break;case 2:t.vertexAttrib2fv(e,n.value);break;case 1:t.vertexAttrib1fv(e,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(Ee,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.numComponents||n.size,n.type||ke,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function je(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,n.value)}else t.bindBuffer(Ee,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||Pe,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function He(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,n.value)}else t.bindBuffer(Ee,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||Te,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function Ke(t,e,n){var r=n.size,i=n.count;return function(n){t.bindBuffer(Ee,n.buffer);for(var a=n.size||n.numComponents||r,o=a/i,s=n.type||ke,u=Fe[s].size*a,l=n.normalize||!1,c=n.offset||0,h=u/i,d=0;d<i;++d)t.enableVertexAttribArray(e+d),t.vertexAttribPointer(e+d,o,s,l,u,c+h*d),void 0!==n.divisor&&t.vertexAttribDivisor(e+d,n.divisor)}}Fe[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(n){t.uniform1f(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1fv(e,n)}}},Fe[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(n){t.uniform2fv(e,n)}},cols:2},Fe[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(n){t.uniform3fv(e,n)}},cols:3},Fe[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(n){t.uniform4fv(e,n)}},cols:4},Fe[5124]={Type:Int32Array,size:4,setter:Ve,arraySetter:Le},Fe[35667]={Type:Int32Array,size:8,setter:De,cols:2},Fe[35668]={Type:Int32Array,size:12,setter:Ue,cols:3},Fe[35669]={Type:Int32Array,size:16,setter:Ie,cols:4},Fe[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(n){t.uniform1ui(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1uiv(e,n)}}},Fe[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(n){t.uniform2uiv(e,n)}},cols:2},Fe[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(n){t.uniform3uiv(e,n)}},cols:3},Fe[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(n){t.uniform4uiv(e,n)}},cols:4},Fe[35670]={Type:Uint32Array,size:4,setter:Ve,arraySetter:Le},Fe[35671]={Type:Uint32Array,size:8,setter:De,cols:2},Fe[35672]={Type:Uint32Array,size:12,setter:Ue,cols:3},Fe[35673]={Type:Uint32Array,size:16,setter:Ie,cols:4},Fe[35674]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2fv(e,!1,n)}},rows:2,cols:2},Fe[35675]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3fv(e,!1,n)}},rows:3,cols:3},Fe[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4fv(e,!1,n)}},rows:4,cols:4},Fe[35685]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x3fv(e,!1,n)}},rows:2,cols:3},Fe[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x4fv(e,!1,n)}},rows:2,cols:4},Fe[35687]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x2fv(e,!1,n)}},rows:3,cols:2},Fe[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x4fv(e,!1,n)}},rows:3,cols:4},Fe[35689]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x2fv(e,!1,n)}},rows:4,cols:2},Fe[35690]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x3fv(e,!1,n)}},rows:4,cols:3},Fe[35678]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Me},Fe[35680]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Ae},Fe[35679]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Se},Fe[35682]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Me},Fe[36289]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Re},Fe[36292]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Re},Fe[36293]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Ae},Fe[36298]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Me},Fe[36299]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Se},Fe[36300]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Ae},Fe[36303]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Re},Fe[36306]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Me},Fe[36307]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Se},Fe[36308]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Ae},Fe[36311]={Type:null,size:0,setter:Oe,arraySetter:Ne,bindPoint:Re};var Ge={};Ge[5126]={size:4,setter:ze},Ge[35664]={size:8,setter:ze},Ge[35665]={size:12,setter:ze},Ge[35666]={size:16,setter:ze},Ge[5124]={size:4,setter:je},Ge[35667]={size:8,setter:je},Ge[35668]={size:12,setter:je},Ge[35669]={size:16,setter:je},Ge[5125]={size:4,setter:He},Ge[36294]={size:8,setter:He},Ge[36295]={size:12,setter:He},Ge[36296]={size:16,setter:He},Ge[35670]={size:4,setter:je},Ge[35671]={size:8,setter:je},Ge[35672]={size:12,setter:je},Ge[35673]={size:16,setter:je},Ge[35674]={size:4,setter:Ke,count:2},Ge[35675]={size:9,setter:Ke,count:3},Ge[35676]={size:16,setter:Ke,count:4};var We=36096,qe=33306,Xe={};Xe[34041]=qe,Xe[6401]=36128,Xe[36168]=36128,Xe[6402]=We,Xe[33189]=We,Xe[33190]=We,Xe[36012]=We,Xe[35056]=qe,Xe[36013]=qe;var Ye={};Ye[32854]=!0,Ye[32855]=!0,Ye[36194]=!0,Ye[34041]=!0,Ye[33189]=!0,Ye[6401]=!0,Ye[36168]=!0;var $e={};t($e,"create",(function(){return Jn})),t($e,"identity",(function(){return tr})),t($e,"setAxisAngle",(function(){return er})),t($e,"getAxisAngle",(function(){return nr})),t($e,"getAngle",(function(){return rr})),t($e,"dot",(function(){return Br})),t($e,"multiply",(function(){return ir})),t($e,"rotateX",(function(){return ar})),t($e,"rotateY",(function(){return or})),t($e,"rotateZ",(function(){return sr})),t($e,"calculateW",(function(){return ur})),t($e,"exp",(function(){return lr})),t($e,"ln",(function(){return cr})),t($e,"pow",(function(){return hr})),t($e,"scale",(function(){return Fr})),t($e,"slerp",(function(){return dr})),t($e,"random",(function(){return pr})),t($e,"invert",(function(){return vr})),t($e,"conjugate",(function(){return fr})),t($e,"fromMat3",(function(){return mr})),t($e,"fromEuler",(function(){return br})),t($e,"str",(function(){return _r})),t($e,"clone",(function(){return Pr})),t($e,"fromValues",(function(){return Tr})),t($e,"copy",(function(){return Mr})),t($e,"set",(function(){return Ar})),t($e,"add",(function(){return Sr})),t($e,"mul",(function(){return Rr})),t($e,"lerp",(function(){return Vr})),t($e,"length",(function(){return Lr})),t($e,"len",(function(){return Dr})),t($e,"squaredLength",(function(){return Ur})),t($e,"sqrLen",(function(){return Ir})),t($e,"normalize",(function(){return Or})),t($e,"exactEquals",(function(){return Nr})),t($e,"equals",(function(){return zr})),t($e,"rotationTo",(function(){return jr})),t($e,"sqlerp",(function(){return Hr})),t($e,"setAxes",(function(){return Kr}));var Qe=1e-6,Ze="undefined"!=typeof Float32Array?Float32Array:Array,Je=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var tn={};function en(){var t=new Ze(3);return Ze!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function nn(t){var e=new Ze(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function rn(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function an(t,e,n){var r=new Ze(3);return r[0]=t,r[1]=e,r[2]=n,r}function on(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function sn(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function un(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ln(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function cn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function hn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function dn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function pn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function vn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function fn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function mn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function bn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function _n(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function gn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function wn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function yn(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function xn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Cn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function En(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function kn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Pn(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=i*u-a*s,t[1]=a*o-r*u,t[2]=r*s-i*o,t}function Tn(t,e,n,r){var i=e[0],a=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t}function Mn(t,e,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t}function An(t,e,n,r,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,d=u*a;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*d,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*d,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*d,t}function Sn(t,e){e=e||1;var n=2*Je()*Math.PI,r=2*Je()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function Rn(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function Fn(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function Bn(t,e,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=e[0],u=e[1],l=e[2],c=i*l-a*u,h=a*s-r*l,d=r*u-i*s,p=i*d-a*h,v=a*c-r*d,f=r*h-i*c,m=2*o;return c*=m,h*=m,d*=m,p*=2,v*=2,f*=2,t[0]=s+c+p,t[1]=u+h+v,t[2]=l+d+f,t}function Vn(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function Ln(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function Dn(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function Un(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(a*a+o*o+s*s),l=u&&kn(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function In(t){return t[0]=0,t[1]=0,t[2]=0,t}function On(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Nn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function zn(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=Qe*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=Qe*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Qe*Math.max(1,Math.abs(i),Math.abs(s))}t(tn,"create",(function(){return en})),t(tn,"clone",(function(){return nn})),t(tn,"length",(function(){return rn})),t(tn,"fromValues",(function(){return an})),t(tn,"copy",(function(){return on})),t(tn,"set",(function(){return sn})),t(tn,"add",(function(){return un})),t(tn,"subtract",(function(){return ln})),t(tn,"multiply",(function(){return cn})),t(tn,"divide",(function(){return hn})),t(tn,"ceil",(function(){return dn})),t(tn,"floor",(function(){return pn})),t(tn,"min",(function(){return vn})),t(tn,"max",(function(){return fn})),t(tn,"round",(function(){return mn})),t(tn,"scale",(function(){return bn})),t(tn,"scaleAndAdd",(function(){return _n})),t(tn,"distance",(function(){return gn})),t(tn,"squaredDistance",(function(){return wn})),t(tn,"squaredLength",(function(){return yn})),t(tn,"negate",(function(){return xn})),t(tn,"inverse",(function(){return Cn})),t(tn,"normalize",(function(){return En})),t(tn,"len",(function(){return Xn})),t(tn,"dot",(function(){return kn})),t(tn,"cross",(function(){return Pn})),t(tn,"lerp",(function(){return Tn})),t(tn,"hermite",(function(){return Mn})),t(tn,"bezier",(function(){return An})),t(tn,"random",(function(){return Sn})),t(tn,"transformMat4",(function(){return Rn})),t(tn,"transformMat3",(function(){return Fn})),t(tn,"transformQuat",(function(){return Bn})),t(tn,"rotateX",(function(){return Vn})),t(tn,"rotateY",(function(){return Ln})),t(tn,"rotateZ",(function(){return Dn})),t(tn,"angle",(function(){return Un})),t(tn,"zero",(function(){return In})),t(tn,"str",(function(){return On})),t(tn,"exactEquals",(function(){return Nn})),t(tn,"equals",(function(){return zn})),t(tn,"sub",(function(){return Hn})),t(tn,"mul",(function(){return Kn})),t(tn,"div",(function(){return Gn})),t(tn,"dist",(function(){return Wn})),t(tn,"sqrDist",(function(){return qn})),t(tn,"sqrLen",(function(){return Yn})),t(tn,"forEach",(function(){return $n}));var jn,Hn=ln,Kn=cn,Gn=hn,Wn=gn,qn=wn,Xn=rn,Yn=yn,$n=(jn=en(),function(t,e,n,r,i,a){var o,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,o=n;o<s;o+=e)jn[0]=t[o],jn[1]=t[o+1],jn[2]=t[o+2],i(jn,jn,a),t[o]=jn[0],t[o+1]=jn[1],t[o+2]=jn[2];return t});function Qn(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function Zn(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}!function(){var t,e=(t=new Ze(4),Ze!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function Jn(){var t=new Ze(4);return Ze!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function tr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function er(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function nr(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>Qe?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function rr(t,e){var n=Br(t,e);return Math.acos(2*n*n-1)}function ir(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],u=n[1],l=n[2],c=n[3];return t[0]=r*c+o*s+i*l-a*u,t[1]=i*c+o*u+a*s-r*l,t[2]=a*c+o*l+r*u-i*s,t[3]=o*c-r*s-i*u-a*l,t}function ar(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-r*s,t}function or(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-a*s,t[1]=i*u+o*s,t[2]=a*u+r*s,t[3]=o*u-i*s,t}function sr(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t}function ur(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function lr(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=Math.sqrt(n*n+r*r+i*i),s=Math.exp(a),u=o>0?s*Math.sin(o)/o:0;return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=s*Math.cos(o),t}function cr(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=Math.sqrt(n*n+r*r+i*i),s=o>0?Math.atan2(o,a)/o:0;return t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(n*n+r*r+i*i+a*a),t}function hr(t,e,n){return cr(t,e),Fr(t,t,n),lr(t,t),t}function dr(t,e,n,r){var i,a,o,s,u,l=e[0],c=e[1],h=e[2],d=e[3],p=n[0],v=n[1],f=n[2],m=n[3];return(a=l*p+c*v+h*f+d*m)<0&&(a=-a,p=-p,v=-v,f=-f,m=-m),1-a>Qe?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(s=1-r,u=r),t[0]=s*l+u*p,t[1]=s*c+u*v,t[2]=s*h+u*f,t[3]=s*d+u*m,t}function pr(t){var e=Je(),n=Je(),r=Je(),i=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=a*Math.sin(2*Math.PI*r),t[3]=a*Math.cos(2*Math.PI*r),t}function vr(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=a*s,t}function fr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function mr(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*a+o]-e[3*o+a])*n,t[a]=(e[3*a+i]+e[3*i+a])*n,t[o]=(e[3*o+i]+e[3*i+o])*n}return t}function br(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var a=Math.sin(e),o=Math.cos(e),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return t[0]=a*u*c-o*s*l,t[1]=o*s*c+a*u*l,t[2]=o*u*l-a*s*c,t[3]=o*u*c+a*s*l,t}function _r(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var gr,wr,yr,xr,Cr,Er,kr,Pr=function(t){var e=new Ze(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Tr=function(t,e,n,r){var i=new Ze(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i},Mr=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ar=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},Sr=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Rr=ir,Fr=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Br=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Vr=function(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t[3]=s+r*(n[3]-s),t},Lr=Qn,Dr=Lr,Ur=Zn,Ir=Ur,Or=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o,t},Nr=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},zr=function(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=e[0],s=e[1],u=e[2],l=e[3];return Math.abs(n-o)<=Qe*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=Qe*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=Qe*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=Qe*Math.max(1,Math.abs(a),Math.abs(l))},jr=(gr=en(),wr=an(1,0,0),yr=an(0,1,0),function(t,e,n){var r=kn(e,n);return r<-.999999?(Pn(gr,wr,e),Xn(gr)<1e-6&&Pn(gr,yr,e),En(gr,gr),er(t,gr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Pn(gr,e,n),t[0]=gr[0],t[1]=gr[1],t[2]=gr[2],t[3]=1+r,Or(t,t))}),Hr=(xr=Jn(),Cr=Jn(),function(t,e,n,r,i,a){return dr(xr,e,i,a),dr(Cr,n,r,a),dr(t,xr,Cr,2*a*(1-a)),t}),Kr=(Er=new Ze(9),Ze!=Float32Array&&(Er[1]=0,Er[2]=0,Er[3]=0,Er[5]=0,Er[6]=0,Er[7]=0),Er[0]=1,Er[4]=1,Er[8]=1,kr=Er,function(t,e,n,r){return kr[0]=n[0],kr[3]=n[1],kr[6]=n[2],kr[1]=r[0],kr[4]=r[1],kr[7]=r[2],kr[2]=-e[0],kr[5]=-e[1],kr[8]=-e[2],Or(t,mr(t,kr))});var Gr,Wr=new WeakSet,qr=new WeakSet,Xr=new WeakSet,Yr=new WeakSet,$r=new WeakSet,Qr=new WeakSet,Zr=new WeakSet,Jr=new WeakSet,ti=new WeakSet,ei=new WeakSet,ni=new WeakSet,ri=new WeakSet,ii=new WeakSet,ai=new WeakSet,oi=new WeakSet,si=new WeakSet,ui=new WeakSet,li=new WeakSet;Gr=a("aNJCr").getBundleURL("7EiNB")+a("iE7OH").resolve("aEnLw");var ci=function(){"use strict";function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u(this,t),b(this,"oninit",void 0),hi.set(this,{writable:!0,value:0}),di.set(this,{writable:!0,value:0}),pi.set(this,{writable:!0,value:0}),vi.set(this,{writable:!0,value:!1}),b(this,"enableRegionsPreview",!1),b(this,"enableFarMidPreview",!1),b(this,"enableNearPreview",!1),b(this,"enablePackedPreview",!1),b(this,"enableCoCPreview",!1),b(this,"passPreviewSize",1),b(this,"DOF_TEXTURE_SCALE",.5),b(this,"COMPOSITE_RESULT",0),b(this,"COMPOSITE_REGIONS",1),b(this,"COMPOSITE_NEAR_FIELD",2),b(this,"COMPOSITE_FAR_FIELD",3),b(this,"COMPOSITE_PACKED",4),b(this,"COMPOSITE_COC",5),b(this,"camera",{matrix:K.identity(),near:1,far:500,orbit:$e.create(),up:tn.fromValues(0,1,0),distance:150,position:tn.fromValues(0,0,150),rotation:[0,0,0]}),b(this,"dof",{nearBlurry:40,nearSharp:110,farSharp:130,farBlurry:240,maxCoCRadius:15,radiusScale:2}),b(this,"instances",[]),Wr.add(this),qr.add(this),Xr.add(this),Yr.add(this),$r.add(this),Qr.add(this),Zr.add(this),Jr.add(this),ti.add(this),ei.add(this),ni.add(this),ri.add(this),ii.add(this),ai.add(this),oi.add(this),si.add(this),ui.add(this),li.add(this),this.canvas=e,this.pane=n,this.oninit=r,h(this,$r,gi).call(this)}return m(t,[{key:"resize",value:function(){var t=this.gl;!function(t,e){e=e||1,e=Math.max(0,e);var n=t.clientWidth*e|0,r=t.clientHeight*e|0;(t.width!==n||t.height!==r)&&(t.width=n,t.height=r)}(t.canvas),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),h(this,ai,Mi).call(this,t),h(this,si,Si).call(this,t)}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this;c(this,pi,t-l(this,hi)),c(this,hi,t),c(this,di,l(this,di)+l(this,pi)/16),l(this,vi)||(h(this,Zr,yi).call(this),this.drawUniforms.u_deltaTime=l(this,pi),this.drawUniforms.u_worldInverseTransposeMatrix=K.transpose(K.inverse(this.drawUniforms.u_worldMatrix)),this.instanceMatrices.forEach((function(t,n){var r=e.instances[n],i=K.identity();K.translate(i,r.translation,i),K.rotateX(i,r.rotation[0]+l(e,di)*r.rotationSpeed*.5,i),K.rotateY(i,r.rotation[1]+l(e,di)*r.rotationSpeed,i),K.rotateZ(i,r.rotation[2],i),K.scale(i,r.scale,t)})),h(this,Wr,fi).call(this),requestAnimationFrame((function(t){return e.run(t)})))}},{key:"destroy",value:function(){c(this,vi,!0)}},{key:"initEnvMap",value:function(){var t=this,e=this.gl;this.envMapTexture=h(this,ii,Ti).call(this,e,e.LINEAR,e.LINEAR),e.bindTexture(e.TEXTURE_2D,this.envMapTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2e3,1e3,0,e.RGBA,e.UNSIGNED_BYTE,null);var n=new Image;n.src=new URL(Gr),n.addEventListener("load",(function(){e.bindTexture(e.TEXTURE_2D,t.envMapTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2e3,1e3,0,e.RGBA,e.UNSIGNED_BYTE,n)}))}}]),t}(),hi=new WeakMap,di=new WeakMap,pi=new WeakMap,vi=new WeakMap;function fi(){var t=this.gl;t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),h(this,ri,Pi).call(this,t,this.drawFramebuffer,this.drawFramebufferWidth,this.drawFramebufferHeight),t.useProgram(this.drawProgram),t.bindVertexArray(this.objectVAO),t.bindBuffer(t.ARRAY_BUFFER,this.matrixBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,this.instanceMatricesArray),t.uniformMatrix4fv(this.drawLocations.u_worldMatrix,!1,this.drawUniforms.u_worldMatrix),t.uniformMatrix4fv(this.drawLocations.u_viewMatrix,!1,this.drawUniforms.u_viewMatrix),t.uniformMatrix4fv(this.drawLocations.u_projectionMatrix,!1,this.drawUniforms.u_projectionMatrix),t.uniformMatrix4fv(this.drawLocations.u_worldInverseTransposeMatrix,!1,this.drawUniforms.u_worldInverseTransposeMatrix),t.uniform3f(this.drawLocations.u_cameraPosition,this.camera.position[0],this.camera.position[1],this.camera.position[2]),t.uniform1i(this.drawLocations.u_envMap,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.envMapTexture),t.clearBufferfv(t.COLOR,0,[1,.3,.5,0]),t.clearBufferfv(t.DEPTH,0,[1]),t.drawElementsInstanced(t.TRIANGLES,this.objectBuffers.numElements,t.UNSIGNED_SHORT,0,this.numInstances),h(this,ri,Pi).call(this,t,null,t.drawingBufferWidth,t.drawingBufferHeight),t.bindFramebuffer(t.READ_FRAMEBUFFER,this.drawFramebuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.blitFramebuffer),t.clearBufferfv(t.COLOR,0,[0,0,0,1]),t.clearBufferfv(t.DEPTH,0,[0]),t.blitFramebuffer(0,0,this.drawFramebufferWidth,this.drawFramebufferHeight,0,0,this.drawFramebufferWidth,this.drawFramebufferHeight,t.COLOR_BUFFER_BIT,t.NEAREST),t.blitFramebuffer(0,0,this.drawFramebufferWidth,this.drawFramebufferHeight,0,0,this.drawFramebufferWidth,this.drawFramebufferHeight,t.DEPTH_BUFFER_BIT,t.NEAREST),h(this,ri,Pi).call(this,t,null,t.drawingBufferWidth,t.drawingBufferHeight),h(this,qr,mi).call(this,this.dofPackedFramebuffer,this.drawFramebufferWidth,this.drawFramebufferHeight,this.dofPackProgram,[[this.dofPackLocations.u_depth,this.depthTexture],[this.dofPackLocations.u_color,this.colorTexture]],[[this.dofPackLocations.u_nearBlurry,this.dof.nearBlurry],[this.dofPackLocations.u_nearSharp,this.dof.nearSharp],[this.dofPackLocations.u_farBlurry,this.dof.farBlurry],[this.dofPackLocations.u_farSharp,this.dof.farSharp],[this.dofPackLocations.u_zNear,this.camera.near],[this.dofPackLocations.u_zFar,this.camera.far]]),h(this,qr,mi).call(this,this.dofBlurHFramebuffer,this.dofFramebufferWidth,this.dofFramebufferHeight,this.dofBlurHProgram,[[this.dofBlurHLocations.u_packedTexture,this.dofPackedTexture]],[,[this.dofBlurHLocations.u_radiusScale,this.dof.radiusScale]],[[this.dofBlurHLocations.u_maxCoCRadius,this.dof.maxCoCRadius]]),h(this,qr,mi).call(this,this.dofBlurVFramebuffer,this.dofFramebufferWidth,this.dofFramebufferHeight,this.dofBlurVProgram,[[this.dofBlurVLocations.u_midFarBlurTexture,this.dofBlurHMidFarTexture],[this.dofBlurVLocations.u_nearBlurTexture,this.dofBlurHNearTexture]],[[this.dofBlurVLocations.u_radiusScale,this.dof.radiusScale]],[[this.dofBlurVLocations.u_maxCoCRadius,this.dof.maxCoCRadius]]),h(this,Yr,_i).call(this,this.COMPOSITE_RESULT);var e=0;this.enableRegionsPreview&&(e=h(this,Xr,bi).call(this,0,this.COMPOSITE_REGIONS)),this.enableFarMidPreview&&(e=h(this,Xr,bi).call(this,e,this.COMPOSITE_FAR_FIELD)),this.enableNearPreview&&(e=h(this,Xr,bi).call(this,e,this.COMPOSITE_NEAR_FIELD)),this.enablePackedPreview&&(e=h(this,Xr,bi).call(this,e,this.COMPOSITE_PACKED)),this.enableCoCPreview&&(e=h(this,Xr,bi).call(this,e,this.COMPOSITE_COC))}function mi(t,e,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],s=this.gl;h(this,ri,Pi).call(this,s,t,e,n),s.useProgram(r),s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.bindVertexArray(this.quadVAO),i.forEach((function(t,e){var n=E(t),r=n[0],i=n[1];s.uniform1i(r,e),s.activeTexture(s["TEXTURE".concat(e)]),s.bindTexture(s.TEXTURE_2D,i)})),a.forEach((function(t){var e=E(t),n=e[0],r=e[1];s.uniform1f(n,r)})),o.forEach((function(t){var e=E(t),n=e[0],r=e[1];s.uniform1i(n,r)})),s.drawElements(s.TRIANGLES,this.quadBuffers.numElements,s.UNSIGNED_SHORT,0),h(this,ri,Pi).call(this,s,null,s.drawingBufferWidth,s.drawingBufferHeight)}function bi(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.gl,r=n.canvas.width*this.passPreviewSize,i=n.canvas.height*this.passPreviewSize;return n.enable(n.SCISSOR_TEST),n.scissor(0,t,r,i),n.viewport(0,t,r,i),h(this,Yr,_i).call(this,e),n.disable(n.SCISSOR_TEST),t+i}function _i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.gl;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.useProgram(this.dofCompositeProgram),e.bindVertexArray(this.quadVAO),e.uniform1i(this.dofCompositeLocations.u_packedTexture,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.dofPackedTexture),e.uniform1i(this.dofCompositeLocations.u_midFarBlurTexture,1),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.dofBlurVMidFarTexture),e.uniform1i(this.dofCompositeLocations.u_nearBlurTexture,2),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.dofBlurVNearTexture),e.uniform1i(this.dofCompositeLocations.u_sourceColorTexture,3),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,this.colorTexture),e.uniform1i(this.dofCompositeLocations.u_passIndex,t),e.drawElements(e.TRIANGLES,this.quadBuffers.numElements,e.UNSIGNED_SHORT,0)}function gi(){this.gl=this.canvas.getContext("webgl2",{antialias:!1,alpha:!1});var t=this.gl;if(!t)throw new Error("No WebGL 2 context!");this.drawProgram=h(this,ni,ki).call(this,t,[e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_worldInverseTransposeMatrix;\nuniform vec3 u_cameraPosition;\n\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_uv;\nin mat4 a_instanceMatrix;\n\nflat out vec3 v_normal;\nout vec2 v_uv;\nout vec3 v_surfaceToView;\n\nvoid main() {\n    v_uv = a_uv;\n    v_normal = (a_instanceMatrix * u_worldInverseTransposeMatrix * vec4(a_normal, 0.)).xyz;\n    vec4 worldPosition = a_instanceMatrix * u_worldMatrix * vec4(a_position, 1.);\n    gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;\n    v_surfaceToView = u_cameraPosition - worldPosition.xyz;\n}\n"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_envMap;\nuniform float u_deltaTime;\n\nflat in vec3 v_normal;\nin vec2 v_uv;\nin vec3 v_surfaceToView;\n\nout vec4 outColor;\n\n#define PI 3.1415926535\n\nvec2 directionToEquirectangular(vec3 d) {\n    vec2 p = vec2(0.);\n    vec3 n = normalize(d);\n\n    p.x = acos(n.y);\n\n    d.y = 0.0;\n    n = normalize(d);\n    \n    if(n.x >= 0.)\n        p.y = acos(-n.z);\n    else    \n        p.y = acos(n.z) + PI;\n\n    return p;\n}\n\nvoid main() {\n    //vec3 r = reflect(normalize(v_surfaceToView), normalize(-v_normal));\n    vec3 n = normalize(v_normal);\n    vec3 v = normalize(v_surfaceToView);\n    float nDv = dot(n, v);\n    vec3 r = nDv * n * 2. - v;\n\n    // Convert Cartesian direction vector to spherical coordinates.\n\tfloat phi   = atan(r.z, r.x);\n\tfloat theta = acos(r.y);\n    vec2 equiPos = vec2(phi / (2. * PI), theta / PI);\n\n\t// Sample equirectangular texture.\n    vec4 envMapColor = texture(u_envMap, equiPos);\n\n    float fog = smoothstep(100., 300., length(v_surfaceToView));\n\n    float fresnel = 1. - smoothstep(0.4, .7, nDv);\n\n    outColor = envMapColor + (fog * vec4(1.0, 0.4, 0.6, 1.));\n    outColor *= fresnel;\n    outColor = clamp(vec4(0.), vec4(1.), pow(outColor, vec4(1.2)));\n}\n")],null,{a_position:0,a_normal:1,a_uv:2,a_instanceMatrix:4}),this.dofPackProgram=h(this,ni,ki).call(this,t,[e("#version 300 es\n#define GLSLIFY 1\n\nin vec2 a_position;\nin vec2 a_uv;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    gl_Position = vec4(a_position, 0., 1.);\n}"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_depth;\nuniform sampler2D u_color;\nuniform float u_nearBlurry;\nuniform float u_nearSharp;\nuniform float u_farBlurry;\nuniform float u_farSharp;\nuniform float u_zNear;\nuniform float u_zFar;\n\nin vec2 v_uv;\n\nout vec4 packed;\n\nfloat zFromDepth(float depth, float zNear, float zFar) {\n    float d = 2. * depth - 1.;\n    return (2. * zNear * zFar) / (zFar + zNear - d * (zFar - zNear));\n}\n\nvoid main() {\n    float tmp = u_nearBlurry + u_nearSharp + u_farBlurry + u_farSharp;\n\n    vec4 color = texture(u_color, v_uv);\n\n    // the non-linear depth value [0, 1]\n    float depth = texture(u_depth, v_uv).x;\n\n    // the reconstructed z-value in view space\n    float z = zFromDepth(depth, u_zNear, u_zFar);\n\n    // percent of the maximal CoC [1, -1]\n    float radius = 1.;\n\n    if (z < u_nearSharp) {\n        radius = 1. - (max(z, u_nearBlurry) - u_nearBlurry) / (u_nearSharp - u_nearBlurry);\n    } else if (z > u_farSharp) {\n        radius = - (min(z, u_farBlurry) - u_farSharp) / (u_farBlurry - u_farSharp);\n    } else {\n        radius = 0.;\n    }\n\n    radius = radius * .5 + .5;\n\n    packed = vec4(color.rgb, radius);\n}\n")],null,{a_position:0,a_uv:1}),this.dofBlurHProgram=h(this,ni,ki).call(this,t,[e("#version 300 es\n#define GLSLIFY 1\n\nin vec2 a_position;\nin vec2 a_uv;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    gl_Position = vec4(a_position, 0., 1.);\n}"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_packedTexture;\nuniform int u_maxCoCRadius;\nuniform float u_radiusScale;\n\nin vec2 v_uv;\n\nlayout(location = 0) out vec4 outMidFarColor;\nlayout(location = 1) out vec4 outNearColor;\n\nbool inNearField(float radiusPixels) {\n    return radiusPixels > 0.25;\n}\n\nvoid depthOfFieldBlur(\n    in bool isHorizontal,\n    in vec2 A,\n    in int maxCoCRadius,\n    in float radiusScale,\n    in sampler2D midFarInTexture,\n    in sampler2D nearInTexture,\n    out vec4 midFarOut,\n    out vec4 nearOut\n) {\n    // the resulting g-buffer values\n    vec4 midFarResult = vec4(0.);\n    vec4 nearResult = vec4(0.);\n\n    const int GAUSSIAN_TAPS = 6;\n    float gaussian[GAUSSIAN_TAPS + 1];  \n    // gaussian weights\n    gaussian[6] = 0.00000000000000;\n    gaussian[5] = 0.04153263993208;\n    gaussian[4] = 0.06352050813141;\n    gaussian[3] = 0.08822292796029;\n    gaussian[2] = 0.11143948794984;\n    gaussian[1] = 0.12815541114232;\n    gaussian[0] = 0.13425804976814;\n\n    // position of the current pixel\n    vec2 texelSize = 1. / vec2(textureSize(midFarInTexture, 0));\n    vec4 packedA = texture(midFarInTexture, A);\n    float radiusA = (packedA.a * 2. - 1.);\n    float rA = radiusA * float(maxCoCRadius);\n\n    float midFarWeightSum = 0.;\n    float nearWeightSum = 0.;\n\n    // rapidly goes to 1 when within the near field\n    float nearFieldnessA = clamp(radiusA * 2.0, 0., 1.);\n\n    vec2 direction = vec2(float(isHorizontal), float(!isHorizontal));\n\n    // the blur renders with half of the full resolution (see DOF_TEXTURE_SCALE in app)\n    // this has to be compensated during the blur\n    texelSize /= float(!isHorizontal) + 1.;\n\n    // scatter as you gather loop\n    for(int delta = -maxCoCRadius; delta <= maxCoCRadius; ++delta) {\n\n        // get the CoC radius at this tap\n        vec2 B = A + direction * (float(delta) * radiusScale * texelSize);\n        vec4 packedB = texture(midFarInTexture, B);\n        float rB = (packedB.a * 2. - 1.) * float(maxCoCRadius);\n\n        ///////////////////////////////////////////////////// Mid/Far Field\n\n        // mid/far field: B nearer then A weight\n        float midFarBNearerWeight = clamp(abs(rA) - abs(rB) + 1.5, 0., 1.);\n\n        // get the effect of the CoC at B on the current pixel at A\n        float gaussianWeight = gaussian[clamp(int(float(abs(delta) * (GAUSSIAN_TAPS - 1)) / (0.001 + abs(rB * 0.5))), 0, GAUSSIAN_TAPS)];\n\n        // get the weight for mid and far field values\n        float midFarWeight = float(!inNearField(rB)) * midFarBNearerWeight * gaussianWeight;\n\n        // also blur the near field of the mid far color for composition\n        midFarWeight = mix(midFarWeight, 1., nearFieldnessA);\n\n        // update the mid/far result\n        midFarWeightSum += midFarWeight;\n        midFarResult.rgb += packedB.rgb * midFarWeight;\n\n        ///////////////////////////////////////////////////// Near Field\n\n        // the near field value at this tap\n        vec4 near;\n\n        if (isHorizontal) {\n            // the current tap contributes to the near field coverage\n            float hasNearFieldCoverage = float(abs(float(delta)) <= rB);\n\n            // rapidly move the coverage when tap contributes to the current pixel in near field\n            near.a = hasNearFieldCoverage * clamp((rB / float(maxCoCRadius)) * 4., 0., 1.);\n            near.a *= near.a;\n            near.a *= near.a;\n\n            // premultiplied color\n            near.rgb = packedB.rgb * near.a;\n        } else {\n            near = texture(nearInTexture, B);\n        }\n\n        // simple box blur for the near field\n        float nearWeight = 1.;\n        nearResult += near * nearWeight;\n        nearWeightSum += nearWeight;\n    }\n\n    if (isHorizontal) {\n        // forward the normalized CoC to the next pass\n        midFarResult.a = packedA.a;\n    } else {\n        midFarResult.a = 1.;\n    }\n\n    // apply total weights\n    midFarResult.rgb /= midFarWeightSum;\n    nearResult /= nearWeightSum;\n\n    nearOut = nearResult;\n    midFarOut = midFarResult;\n}\n\nvoid main() {\n    depthOfFieldBlur(\n        true,\n        v_uv,\n        u_maxCoCRadius,\n        u_radiusScale,\n        u_packedTexture,\n        u_packedTexture, // not used in horizontal pass\n        outMidFarColor,\n        outNearColor\n    );\n}")],null,{a_position:0,a_uv:1}),this.dofBlurVProgram=h(this,ni,ki).call(this,t,[e("#version 300 es\n#define GLSLIFY 1\n\nin vec2 a_position;\nin vec2 a_uv;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    gl_Position = vec4(a_position, 0., 1.);\n}"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_midFarBlurTexture;\nuniform sampler2D u_nearBlurTexture;\nuniform int u_maxCoCRadius;\nuniform float u_radiusScale;\n\nin vec2 v_uv;\n\nlayout(location = 0) out vec4 outMidFarColor;\nlayout(location = 1) out vec4 outNearColor;\n\nbool inNearField(float radiusPixels) {\n    return radiusPixels > 0.25;\n}\n\nvoid depthOfFieldBlur(\n    in bool isHorizontal,\n    in vec2 A,\n    in int maxCoCRadius,\n    in float radiusScale,\n    in sampler2D midFarInTexture,\n    in sampler2D nearInTexture,\n    out vec4 midFarOut,\n    out vec4 nearOut\n) {\n    // the resulting g-buffer values\n    vec4 midFarResult = vec4(0.);\n    vec4 nearResult = vec4(0.);\n\n    const int GAUSSIAN_TAPS = 6;\n    float gaussian[GAUSSIAN_TAPS + 1];  \n    // gaussian weights\n    gaussian[6] = 0.00000000000000;\n    gaussian[5] = 0.04153263993208;\n    gaussian[4] = 0.06352050813141;\n    gaussian[3] = 0.08822292796029;\n    gaussian[2] = 0.11143948794984;\n    gaussian[1] = 0.12815541114232;\n    gaussian[0] = 0.13425804976814;\n\n    // position of the current pixel\n    vec2 texelSize = 1. / vec2(textureSize(midFarInTexture, 0));\n    vec4 packedA = texture(midFarInTexture, A);\n    float radiusA = (packedA.a * 2. - 1.);\n    float rA = radiusA * float(maxCoCRadius);\n\n    float midFarWeightSum = 0.;\n    float nearWeightSum = 0.;\n\n    // rapidly goes to 1 when within the near field\n    float nearFieldnessA = clamp(radiusA * 2.0, 0., 1.);\n\n    vec2 direction = vec2(float(isHorizontal), float(!isHorizontal));\n\n    // the blur renders with half of the full resolution (see DOF_TEXTURE_SCALE in app)\n    // this has to be compensated during the blur\n    texelSize /= float(!isHorizontal) + 1.;\n\n    // scatter as you gather loop\n    for(int delta = -maxCoCRadius; delta <= maxCoCRadius; ++delta) {\n\n        // get the CoC radius at this tap\n        vec2 B = A + direction * (float(delta) * radiusScale * texelSize);\n        vec4 packedB = texture(midFarInTexture, B);\n        float rB = (packedB.a * 2. - 1.) * float(maxCoCRadius);\n\n        ///////////////////////////////////////////////////// Mid/Far Field\n\n        // mid/far field: B nearer then A weight\n        float midFarBNearerWeight = clamp(abs(rA) - abs(rB) + 1.5, 0., 1.);\n\n        // get the effect of the CoC at B on the current pixel at A\n        float gaussianWeight = gaussian[clamp(int(float(abs(delta) * (GAUSSIAN_TAPS - 1)) / (0.001 + abs(rB * 0.5))), 0, GAUSSIAN_TAPS)];\n\n        // get the weight for mid and far field values\n        float midFarWeight = float(!inNearField(rB)) * midFarBNearerWeight * gaussianWeight;\n\n        // also blur the near field of the mid far color for composition\n        midFarWeight = mix(midFarWeight, 1., nearFieldnessA);\n\n        // update the mid/far result\n        midFarWeightSum += midFarWeight;\n        midFarResult.rgb += packedB.rgb * midFarWeight;\n\n        ///////////////////////////////////////////////////// Near Field\n\n        // the near field value at this tap\n        vec4 near;\n\n        if (isHorizontal) {\n            // the current tap contributes to the near field coverage\n            float hasNearFieldCoverage = float(abs(float(delta)) <= rB);\n\n            // rapidly move the coverage when tap contributes to the current pixel in near field\n            near.a = hasNearFieldCoverage * clamp((rB / float(maxCoCRadius)) * 4., 0., 1.);\n            near.a *= near.a;\n            near.a *= near.a;\n\n            // premultiplied color\n            near.rgb = packedB.rgb * near.a;\n        } else {\n            near = texture(nearInTexture, B);\n        }\n\n        // simple box blur for the near field\n        float nearWeight = 1.;\n        nearResult += near * nearWeight;\n        nearWeightSum += nearWeight;\n    }\n\n    if (isHorizontal) {\n        // forward the normalized CoC to the next pass\n        midFarResult.a = packedA.a;\n    } else {\n        midFarResult.a = 1.;\n    }\n\n    // apply total weights\n    midFarResult.rgb /= midFarWeightSum;\n    nearResult /= nearWeightSum;\n\n    nearOut = nearResult;\n    midFarOut = midFarResult;\n}\n\nvoid main() {\n    depthOfFieldBlur(\n        false,\n        v_uv,\n        u_maxCoCRadius,\n        u_radiusScale,\n        u_midFarBlurTexture,\n        u_nearBlurTexture,\n        outMidFarColor,\n        outNearColor\n    );\n}")],null,{a_position:0,a_uv:1}),this.dofCompositeProgram=h(this,ni,ki).call(this,t,[e("#version 300 es\n#define GLSLIFY 1\n\nin vec2 a_position;\nin vec2 a_uv;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    gl_Position = vec4(a_position, 0., 1.);\n}"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_sourceColorTexture;\nuniform sampler2D u_packedTexture;\nuniform sampler2D u_midFarBlurTexture;\nuniform sampler2D u_nearBlurTexture;\nuniform int u_passIndex;\n\nin vec2 v_uv;\n\nout vec4 compositeColor;\n\nfloat grayscale(vec3 c) {\n    return (c.r + c.g + c.b) / 3.0;\n}\n\nvoid main() {\n    const int COMPOSITE_RESULT       = 0;\n    const int COMPOSITE_REGIONS      = 1;\n    const int COMPOSITE_NEAR_FIELD   = 2;\n    const int COMPOSITE_FAR_FIELD    = 3;\n    const int COMPOSITE_PACKED       = 4;\n    const int COMPOSITE_COC          = 5;\n    \n    vec4 sourceColor = texture(u_sourceColorTexture, v_uv);\n    vec4 packedColor = texture(u_packedTexture, v_uv);\n    vec4 midFarBlurColor = texture(u_midFarBlurTexture, v_uv);\n    vec4 nearBlurColor = texture(u_nearBlurTexture, v_uv);\n\n    // find the normalized CoC\n    vec2 texelSize = 1. / vec2(textureSize(u_packedTexture, 0)); \n    float normCoCRadius = (packedColor.a * 2. - 1.);\n\n    // boost the coverage of near field\n    float nearCoverageBoost = 4.;\n    float a = clamp(0., 1., nearCoverageBoost * nearBlurColor.a);\n    nearBlurColor.rgb = nearBlurColor.rgb * (a / max(nearBlurColor.a, 0.001));\n    nearBlurColor.a = a;\n\n    // increase influence of the near field\n    if (normCoCRadius > 0.1) {\n        normCoCRadius = min(normCoCRadius * 1.4, 1.0);\n    }\n\n    // mix the blurred near and mid/far with the original image\n    compositeColor = mix(sourceColor, midFarBlurColor, abs(normCoCRadius)) * (1. - nearBlurColor.a) + nearBlurColor;\n\n    switch(u_passIndex) {\n        case COMPOSITE_REGIONS:\n            float radius = packedColor.a;\n            float gray = grayscale(packedColor.rgb);\n            gray = packedColor.a * 2.;\n            vec3 midColor = vec3(.3) * gray;\n            compositeColor = vec4(1.);\n\n            if (radius > 0.51) {\n                // near field\n                float strength = (radius - 0.5) * 2.;\n                compositeColor.rgb = strength * vec3(0.0, 0.5, 1.) * vec3(gray) + (1. - strength) * midColor;\n            } else if (radius >= 0.49) {\n                // mid field\n                compositeColor.rgb = midColor;\n            } else {\n                // far field\n                float strength = (.5 - radius) * 2.;\n                compositeColor.rgb = strength * vec3(1.0, 0.1, 0.1) * vec3(gray) + (1. - strength) * midColor;\n            }\n            break;\n        case COMPOSITE_COC:\n            compositeColor = vec4(packedColor.a);\n            break;\n        case COMPOSITE_NEAR_FIELD:\n            compositeColor = nearBlurColor;\n            break;\n        case COMPOSITE_FAR_FIELD:\n            compositeColor = midFarBlurColor;\n            break;\n        case COMPOSITE_PACKED:\n            compositeColor = packedColor;\n        default:\n            compositeColor = compositeColor;\n    }\n}")],null,{a_position:0,a_uv:1}),this.drawLocations={a_position:t.getAttribLocation(this.drawProgram,"a_position"),a_normal:t.getAttribLocation(this.drawProgram,"a_normal"),a_uv:t.getAttribLocation(this.drawProgram,"a_uv"),a_instanceMatrix:t.getAttribLocation(this.drawProgram,"a_instanceMatrix"),u_worldMatrix:t.getUniformLocation(this.drawProgram,"u_worldMatrix"),u_viewMatrix:t.getUniformLocation(this.drawProgram,"u_viewMatrix"),u_projectionMatrix:t.getUniformLocation(this.drawProgram,"u_projectionMatrix"),u_worldInverseTransposeMatrix:t.getUniformLocation(this.drawProgram,"u_worldInverseTransposeMatrix"),u_envMap:t.getUniformLocation(this.drawProgram,"u_envMap"),u_cameraPosition:t.getUniformLocation(this.drawProgram,"u_cameraPosition")},this.dofPackLocations={a_position:t.getAttribLocation(this.dofPackProgram,"a_position"),a_uv:t.getAttribLocation(this.dofPackProgram,"a_uv"),u_depth:t.getUniformLocation(this.dofPackProgram,"u_depth"),u_color:t.getUniformLocation(this.dofPackProgram,"u_color"),u_nearBlurry:t.getUniformLocation(this.dofPackProgram,"u_nearBlurry"),u_nearSharp:t.getUniformLocation(this.dofPackProgram,"u_nearSharp"),u_farBlurry:t.getUniformLocation(this.dofPackProgram,"u_farBlurry"),u_farSharp:t.getUniformLocation(this.dofPackProgram,"u_farSharp"),u_zNear:t.getUniformLocation(this.dofPackProgram,"u_zNear"),u_zFar:t.getUniformLocation(this.dofPackProgram,"u_zFar")},this.dofBlurHLocations={a_position:t.getAttribLocation(this.dofBlurHProgram,"a_position"),a_uv:t.getAttribLocation(this.dofBlurHProgram,"a_uv"),u_packedTexture:t.getUniformLocation(this.dofBlurHProgram,"u_packedTexture"),u_maxCoCRadius:t.getUniformLocation(this.dofBlurHProgram,"u_maxCoCRadius"),u_radiusScale:t.getUniformLocation(this.dofBlurHProgram,"u_radiusScale")},this.dofBlurVLocations={a_position:t.getAttribLocation(this.dofBlurVProgram,"a_position"),a_uv:t.getAttribLocation(this.dofBlurVProgram,"a_uv"),u_midFarBlurTexture:t.getUniformLocation(this.dofBlurVProgram,"u_midFarBlurTexture"),u_nearBlurTexture:t.getUniformLocation(this.dofBlurVProgram,"u_nearBlurTexture"),u_maxCoCRadius:t.getUniformLocation(this.dofBlurVProgram,"u_maxCoCRadius"),u_radiusScale:t.getUniformLocation(this.dofBlurVProgram,"u_radiusScale")},this.dofCompositeLocations={a_position:t.getAttribLocation(this.dofCompositeProgram,"a_position"),a_uv:t.getAttribLocation(this.dofCompositeProgram,"a_uv"),u_packedTexture:t.getUniformLocation(this.dofCompositeProgram,"u_packedTexture"),u_midFarBlurTexture:t.getUniformLocation(this.dofCompositeProgram,"u_midFarBlurTexture"),u_nearBlurTexture:t.getUniformLocation(this.dofCompositeProgram,"u_nearBlurTexture"),u_passIndex:t.getUniformLocation(this.dofCompositeProgram,"u_passIndex"),u_sourceColorTexture:t.getUniformLocation(this.dofCompositeProgram,"u_sourceColorTexture")},this.drawUniforms={u_worldMatrix:K.translate(K.scaling([13,13,13]),[0,0,0]),u_viewMatrix:K.identity(),u_projectionMatrix:K.identity(),u_worldInverseTransposeMatrix:K.identity()},this.objectBuffers=be.createTorusBuffers(t,1.7,.25,64,16),this.objectVAO=h(this,ti,Ci).call(this,t,[[this.objectBuffers.position,this.drawLocations.a_position,3],[this.objectBuffers.normal,this.drawLocations.a_normal,3],[this.objectBuffers.texcoord,this.drawLocations.a_uv,2]],this.objectBuffers.indices),this.quadBuffers=be.createXYQuadBuffers(t),this.quadVAO=h(this,ti,Ci).call(this,t,[[this.quadBuffers.position,this.dofPackLocations.a_position,2],[this.quadBuffers.texcoord,this.dofPackLocations.a_uv,2]],this.quadBuffers.indices),t.bindVertexArray(this.objectVAO),this.gridSize=2,this.numInstances=this.gridSize*this.gridSize*this.gridSize,this.instanceMatricesArray=new Float32Array(16*this.numInstances),this.instanceMatrices=[];for(var n=this.gridSize*this.gridSize,r=80,i=Math.floor(this.gridSize/2),a=r/1.5,o=0;o<this.numInstances;++o){var s=o%this.gridSize-i,u=Math.floor(o/n)-i,l=Math.floor(o%n/this.gridSize)-i,c=K.translation([s*r,l*r,u*r]),d=new Float32Array(this.instanceMatricesArray.buffer,64*o,16);d.set(c),this.instanceMatrices.push(d);var p=3*(Math.random()+.5);this.instances.push({translation:[s*r+(Math.random()*a-a/2),l*r+(Math.random()*a-a/2),u*r+(Math.random()*a-a/2)],scale:[p,p,p],rotation:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2],rotationSpeed:.001*(2*Math.random()-1)})}this.matrixBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.matrixBuffer),t.bufferData(t.ARRAY_BUFFER,this.instanceMatricesArray.byteLength,t.DYNAMIC_DRAW);for(var v=0;v<4;++v){var f=this.drawLocations.a_instanceMatrix+v;t.enableVertexAttribArray(f),t.vertexAttribPointer(f,4,t.FLOAT,!1,64,16*v),t.vertexAttribDivisor(f,1)}t.bindVertexArray(null);var m=t.canvas.clientWidth,b=t.canvas.clientHeight;this.drawFramebufferWidth=m,this.drawFramebufferHeight=b,this.drawFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.drawFramebuffer),this.depthRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.depthRenderbuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,4,t.DEPTH_COMPONENT32F,this.drawFramebufferWidth,this.drawFramebufferHeight),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthRenderbuffer),this.colorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.colorRenderbuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,t.getParameter(t.MAX_SAMPLES),t.RGBA8,this.drawFramebufferWidth,this.drawFramebufferHeight),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this.colorRenderbuffer),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("could not complete render framebuffer setup"),this.blitFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.blitFramebuffer),this.depthTexture=h(this,ii,Ti).call(this,t,t.NEAREST,t.NEAREST),t.bindTexture(t.TEXTURE_2D,this.depthTexture),t.texImage2D(this.gl.TEXTURE_2D,0,t.DEPTH_COMPONENT32F,this.drawFramebufferWidth,this.drawFramebufferHeight,0,t.DEPTH_COMPONENT,t.FLOAT,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.depthTexture,0),this.colorTexture=h(this,ii,Ti).call(this,t,t.LINEAR,t.LINEAR),t.bindTexture(t.TEXTURE_2D,this.colorTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.drawFramebufferWidth,this.drawFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.colorTexture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("could not complete render framebuffer setup"),this.dofPackedTexture=h(this,ii,Ti).call(this,t,t.LINEAR,t.LINEAR),t.bindTexture(t.TEXTURE_2D,this.dofPackedTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.drawFramebufferWidth,this.drawFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),this.dofPackedFramebuffer=h(this,Jr,xi).call(this,t,[this.dofPackedTexture]),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("could not complete dof pack framebuffer setup"),this.dofFramebufferWidth=m*this.DOF_TEXTURE_SCALE,this.dofFramebufferHeight=b*this.DOF_TEXTURE_SCALE,this.dofBlurHMidFarTexture=h(this,ii,Ti).call(this,t,t.LINEAR,t.LINEAR),t.bindTexture(t.TEXTURE_2D,this.dofBlurHMidFarTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),this.dofBlurHNearTexture=h(this,ii,Ti).call(this,t,t.LINEAR,t.LINEAR),t.bindTexture(t.TEXTURE_2D,this.dofBlurHNearTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),this.dofBlurHFramebuffer=h(this,Jr,xi).call(this,t,[this.dofBlurHMidFarTexture,this.dofBlurHNearTexture]),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("could not complete dof blur horizontal framebuffer setup"),this.dofBlurVMidFarTexture=h(this,ii,Ti).call(this,t,t.LINEAR,t.LINEAR),t.bindTexture(t.TEXTURE_2D,this.dofBlurVMidFarTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),this.dofBlurVNearTexture=h(this,ii,Ti).call(this,t,t.LINEAR,t.LINEAR),t.bindTexture(t.TEXTURE_2D,this.dofBlurVNearTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),this.dofBlurVFramebuffer=h(this,Jr,xi).call(this,t,[this.dofBlurVMidFarTexture,this.dofBlurVNearTexture]),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("could not complete blur vertical framebuffer setup"),this.resize(),h(this,oi,Ai).call(this),h(this,si,Si).call(this,t),this.initEnvMap(),h(this,Qr,wi).call(this),h(this,ui,Ri).call(this),this.oninit&&this.oninit(this)}function wi(){var t=this;this.pointerDown=!1,this.pointerDownPos={x:0,y:0},this.pointerPos={x:0,y:0},this.pointerFollowPos={x:0,y:0},this.prevPointerPos={x:0,y:0},this.phi=0,this.theta=0,this.canvas.style.touchAction="none",this.canvas.addEventListener("pointerdown",(function(e){t.pointerDownPos={x:e.clientX,y:e.clientY},t.pointerFollowPos={x:e.clientX,y:e.clientY},t.pointerPos={x:e.clientX,y:e.clientY},t.prevPointerPos={x:e.clientX,y:e.clientY},t.pointerDownCameraUp=k(t.camera.up),t.pointerDownRotation=k(t.camera.rotation),t.pointerDown=!0})),this.canvas.addEventListener("pointerup",(function(e){t.pointerDown=!1})),this.canvas.addEventListener("pointermove",(function(e){t.pointerDown&&(t.pointerPos={x:e.clientX,y:e.clientY})}))}function yi(){if(this.pointerDown){this.pointerFollowPos.x+=(this.pointerPos.x-this.pointerFollowPos.x)/10,this.pointerFollowPos.y+=(this.pointerPos.y-this.pointerFollowPos.y)/10;var t={x:this.pointerFollowPos.x-this.prevPointerPos.x,y:this.pointerFollowPos.y-this.prevPointerPos.y};this.prevPointerPos=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){b(t,e,n[e])}))}return t}({},this.pointerFollowPos);this.phi=.2*t.x,this.theta=.2*t.y}else this.phi*=.96,this.theta*=.96;this.camera.rotation[0]-=this.theta,this.camera.rotation[1]-=this.phi;this.camera.rotation[0]>90?this.camera.rotation[0]=90:this.camera.rotation[0]<-90&&(this.camera.rotation[0]=-90),$e.fromEuler(this.camera.orbit,this.camera.rotation[0],this.camera.rotation[1],this.camera.rotation[2]),tn.transformQuat(this.camera.position,[0,0,this.camera.distance],this.camera.orbit),tn.transformQuat(this.camera.up,[0,1,0],this.camera.orbit),h(this,oi,Ai).call(this)}function xi(t,e){var n=t.createFramebuffer(),r=[];return t.bindFramebuffer(t.FRAMEBUFFER,n),e.forEach((function(e,n){var i=t["COLOR_ATTACHMENT".concat(n)];t.framebufferTexture2D(t.FRAMEBUFFER,i,t.TEXTURE_2D,e,0),r.push(i)})),t.drawBuffers(r),t.bindFramebuffer(t.FRAMEBUFFER,null),n}function Ci(t,e,n){var r=t.createVertexArray();t.bindVertexArray(r);var i=!0,a=!1,o=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=E(s.value),c=l[0],h=l[1],d=l[2];t.bindBuffer(t.ARRAY_BUFFER,c),t.enableVertexAttribArray(h),t.vertexAttribPointer(h,d,t.FLOAT,!1,0,0)}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return n&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bindVertexArray(null),r}function Ei(t,e,n){var r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))return r;console.error(t.getShaderInfoLog(r)),t.deleteShader(r)}function ki(t,e,n,r){var i=this,a=t.createProgram();if([t.VERTEX_SHADER,t.FRAGMENT_SHADER].forEach((function(n,r){var o=h(i,ei,Ei).call(i,t,n,e[r]);t.attachShader(a,o)})),n&&t.transformFeedbackVaryings(a,n,t.SEPARATE_ATTRIBS),r)for(var o in r)t.bindAttribLocation(a,r[o],o);if(t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS))return a;console.error(t.getProgramInfoLog(a)),t.deleteProgram(a)}function Pi(t,e,n,r){t.bindFramebuffer(t.FRAMEBUFFER,e),t.viewport(0,0,n,r)}function Ti(t,e,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),r}function Mi(t){var e=t.canvas.clientWidth,n=t.canvas.clientHeight;this.drawFramebufferWidth=e,this.drawFramebufferHeight=n,this.dofFramebufferWidth=e*this.DOF_TEXTURE_SCALE,this.dofFramebufferHeight=n*this.DOF_TEXTURE_SCALE,t.bindRenderbuffer(t.RENDERBUFFER,this.depthRenderbuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,4,t.DEPTH_COMPONENT32F,e,n),t.bindRenderbuffer(t.RENDERBUFFER,this.colorRenderbuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,t.getParameter(t.MAX_SAMPLES),t.RGBA8,e,n),t.bindTexture(t.TEXTURE_2D,this.depthTexture),t.texImage2D(this.gl.TEXTURE_2D,0,t.DEPTH_COMPONENT32F,e,n,0,t.DEPTH_COMPONENT,t.FLOAT,null),t.bindTexture(t.TEXTURE_2D,this.colorTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,this.dofPackedTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.drawFramebufferWidth,this.drawFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,this.dofBlurHNearTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,this.dofBlurHMidFarTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,this.dofBlurVNearTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,this.dofBlurVMidFarTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.dofFramebufferWidth,this.dofFramebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}function Ai(){K.lookAt(this.camera.position,[0,0,0],this.camera.up,this.camera.matrix),K.inverse(this.camera.matrix,this.drawUniforms.u_viewMatrix)}function Si(t){var e=t.canvas.clientWidth/t.canvas.clientHeight;K.perspective(Math.PI/4,e,this.camera.near,this.camera.far,this.drawUniforms.u_projectionMatrix)}function Ri(){if(this.pane){var t=this,e=700,n=this.pane.addFolder({title:"Camera"});h(this,li,Fi).call(this,n,this.camera,"near","near",1,e,null,(function(){return h(t,si,Si).call(t,t.gl)})),h(this,li,Fi).call(this,n,this.camera,"far","far",1,e,null,(function(){return h(t,si,Si).call(t,t.gl)}));var r=this.pane.addFolder({title:"DoF Settings"});h(this,li,Fi).call(this,r,this.dof,"maxCoCRadius","radius",0,30,1),h(this,li,Fi).call(this,r,this.dof,"radiusScale","radius scale",1,5,.1),h(this,li,Fi).call(this,r,this.dof,"nearBlurry","near blur",0,e),h(this,li,Fi).call(this,r,this.dof,"nearSharp","near sharp",0,e),h(this,li,Fi).call(this,r,this.dof,"farSharp","far sharp",0,e),h(this,li,Fi).call(this,r,this.dof,"farBlurry","far blur",0,e);var i=this.pane.addFolder({title:"Render Passes"});i.addInput(this,"enableRegionsPreview",{label:"regions"}),i.addInput(this,"enableFarMidPreview",{label:"far/mid"}),i.addInput(this,"enableNearPreview",{label:"near"}),i.addInput(this,"enablePackedPreview",{label:"packed"}),i.addInput(this,"enableCoCPreview",{label:"coc"}),h(this,li,Fi).call(this,i,this,"passPreviewSize","size",0,1)}}function Fi(t,e,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0,u=t.addBlade({view:"slider",label:r,min:i,max:a,step:o,value:e[n]});u.on("change",(function(t){e[n]=t.value,s&&s()}))}var Bi,Vi,Li=window.location.search,Di=null!==new URLSearchParams(Li).get("debug");window.addEventListener("load",(function(){var t,e=document.body.querySelector("#c");Di&&(t=new o.Pane({title:"Settings"})),Bi=new ci(e,t,(function(t){t.run()}))})),window.addEventListener("resize",(function(){Bi&&(Vi&&clearTimeout(Vi),Vi=setTimeout((function(){Vi=null,Bi.resize()}),300))}))}();
//# sourceMappingURL=index.c3d00fbe.js.map
